module.exports=[76993,63212,a=>{"use strict";var b=a.i(44373);class c{static init(a){Object.defineProperty(this,"resizeTo",{configurable:!0,set(a){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=a,a&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this._cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this._cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{let a,b;if(this._resizeTo){if(this._cancelResize(),this._resizeTo===globalThis.window)a=globalThis.innerWidth,b=globalThis.innerHeight;else{let{clientWidth:c,clientHeight:d}=this._resizeTo;a=c,b=d}this.renderer.resize(a,b),this.render()}},this._resizeId=null,this._resizeTo=null,this.resizeTo=a.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this._cancelResize(),this._cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}c.extension=b.ExtensionType.Application,a.s(["ResizePlugin",()=>c],76993);var d=a.i(83019),e=a.i(83717);class f{static init(a){a=Object.assign({autoStart:!0,sharedTicker:!1},a),Object.defineProperty(this,"ticker",{configurable:!0,set(a){this._ticker&&this._ticker.remove(this.render,this),this._ticker=a,a&&a.add(this.render,this,d.UPDATE_PRIORITY.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=a.sharedTicker?e.Ticker.shared:new e.Ticker,a.autoStart&&this.start()}static destroy(){if(this._ticker){let a=this._ticker;this.ticker=null,a.destroy()}}}f.extension=b.ExtensionType.Application,a.s(["TickerPlugin",()=>f],63212)},26925,60025,a=>{"use strict";var b,c=((b=c||{})[b.Low=0]="Low",b[b.Normal=1]="Normal",b[b.High=2]="High",b);a.s(["LoaderParserPriority",()=>c],26925);var d=a.i(58422);function e(a){if("string"!=typeof a)throw TypeError(`Path must be a string. Received ${JSON.stringify(a)}`)}function f(a){return a.split("?")[0].split("#")[0]}let g={toPosix:a=>{var b,c;return b=0,c=0,a.replace(RegExp("\\".replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),"/")},isUrl(a){return/^https?:/.test(this.toPosix(a))},isDataUrl:a=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(a),isBlobUrl:a=>a.startsWith("blob:"),hasProtocol(a){return/^[^/:]+:/.test(this.toPosix(a))},getProtocol(a){e(a),a=this.toPosix(a);let b=/^file:\/\/\//.exec(a);if(b)return b[0];let c=/^[^/:]+:\/{0,2}/.exec(a);return c?c[0]:""},toAbsolute(a,b,c){if(e(a),this.isDataUrl(a)||this.isBlobUrl(a))return a;let h=f(this.toPosix(b??d.DOMAdapter.get().getBaseUrl())),i=f(this.toPosix(c??this.rootname(h)));return(a=this.toPosix(a)).startsWith("/")?g.join(i,a.slice(1)):this.isAbsolute(a)?a:this.join(h,a)},normalize(a){if(e(a),0===a.length)return".";if(this.isDataUrl(a)||this.isBlobUrl(a))return a;a=this.toPosix(a);let b="",c=a.startsWith("/");this.hasProtocol(a)&&(b=this.rootname(a),a=a.slice(b.length));let d=a.endsWith("/");return((a=function(a,b){let c="",d=0,e=-1,f=0,g=-1;for(let h=0;h<=a.length;++h){if(h<a.length)g=a.charCodeAt(h);else if(47===g)break;else g=47;if(47===g){if(e===h-1||1===f);else if(e!==h-1&&2===f){if(c.length<2||2!==d||46!==c.charCodeAt(c.length-1)||46!==c.charCodeAt(c.length-2)){if(c.length>2){let a=c.lastIndexOf("/");if(a!==c.length-1){-1===a?(c="",d=0):d=(c=c.slice(0,a)).length-1-c.lastIndexOf("/"),e=h,f=0;continue}}else if(2===c.length||1===c.length){c="",d=0,e=h,f=0;continue}}b&&(c.length>0?c+="/..":c="..",d=2)}else c.length>0?c+=`/${a.slice(e+1,h)}`:c=a.slice(e+1,h),d=h-e-1;e=h,f=0}else 46===g&&-1!==f?++f:f=-1}return c}(a,!1)).length>0&&d&&(a+="/"),c)?`/${a}`:b+a},isAbsolute(a){return e(a),a=this.toPosix(a),!!this.hasProtocol(a)||a.startsWith("/")},join(...a){let b;if(0===a.length)return".";for(let c=0;c<a.length;++c){let d=a[c];if(e(d),d.length>0)if(void 0===b)b=d;else{let e=a[c-1]??"";this.joinExtensions.includes(this.extname(e).toLowerCase())?b+=`/../${d}`:b+=`/${d}`}}return void 0===b?".":this.normalize(b)},dirname(a){if(e(a),0===a.length)return".";let b=(a=this.toPosix(a)).charCodeAt(0),c=47===b,d=-1,f=!0,g=this.getProtocol(a),h=a;a=a.slice(g.length);for(let c=a.length-1;c>=1;--c)if(47===(b=a.charCodeAt(c))){if(!f){d=c;break}}else f=!1;return -1===d?c?"/":this.isUrl(h)?g+a:g:c&&1===d?"//":g+a.slice(0,d)},rootname(a){e(a);let b="";if(b=(a=this.toPosix(a)).startsWith("/")?"/":this.getProtocol(a),this.isUrl(a)){let c=a.indexOf("/",b.length);(b=-1!==c?a.slice(0,c):a).endsWith("/")||(b+="/")}return b},basename(a,b){let c;e(a),b&&e(b),a=f(this.toPosix(a));let d=0,g=-1,h=!0;if(void 0!==b&&b.length>0&&b.length<=a.length){if(b.length===a.length&&b===a)return"";let e=b.length-1,f=-1;for(c=a.length-1;c>=0;--c){let i=a.charCodeAt(c);if(47===i){if(!h){d=c+1;break}}else -1===f&&(h=!1,f=c+1),e>=0&&(i===b.charCodeAt(e)?-1==--e&&(g=c):(e=-1,g=f))}return d===g?g=f:-1===g&&(g=a.length),a.slice(d,g)}for(c=a.length-1;c>=0;--c)if(47===a.charCodeAt(c)){if(!h){d=c+1;break}}else -1===g&&(h=!1,g=c+1);return -1===g?"":a.slice(d,g)},extname(a){e(a),a=f(this.toPosix(a));let b=-1,c=0,d=-1,g=!0,h=0;for(let e=a.length-1;e>=0;--e){let f=a.charCodeAt(e);if(47===f){if(!g){c=e+1;break}continue}-1===d&&(g=!1,d=e+1),46===f?-1===b?b=e:1!==h&&(h=1):-1!==b&&(h=-1)}return -1===b||-1===d||0===h||1===h&&b===d-1&&b===c+1?"":a.slice(b,d)},parse(a){let b;e(a);let c={root:"",dir:"",base:"",ext:"",name:""};if(0===a.length)return c;let d=(a=f(this.toPosix(a))).charCodeAt(0),g=this.isAbsolute(a);c.root=this.rootname(a),b=g||this.hasProtocol(a)?1:0;let h=-1,i=0,j=-1,k=!0,l=a.length-1,m=0;for(;l>=b;--l){if(47===(d=a.charCodeAt(l))){if(!k){i=l+1;break}continue}-1===j&&(k=!1,j=l+1),46===d?-1===h?h=l:1!==m&&(m=1):-1!==h&&(m=-1)}return -1===h||-1===j||0===m||1===m&&h===j-1&&h===i+1?-1!==j&&(0===i&&g?c.base=c.name=a.slice(1,j):c.base=c.name=a.slice(i,j)):(0===i&&g?(c.name=a.slice(1,h),c.base=a.slice(1,j)):(c.name=a.slice(i,h),c.base=a.slice(i,j)),c.ext=a.slice(h,j)),c.dir=this.dirname(a),c},sep:"/",delimiter:":",joinExtensions:[".html"]};a.s(["path",()=>g],60025)},68464,a=>{"use strict";let b=(a,b,c=!1)=>(Array.isArray(a)||(a=[a]),b)?a.map(a=>"string"==typeof a||c?b(a):a):a;a.s(["convertToList",()=>b])},91540,69778,87070,97884,87760,23414,85901,a=>{"use strict";var b=a.i(44373),c=a.i(26925),d=a.i(51983),e=a.i(60025),f=a.i(68464);function g(a){let b=a.match(/\{(.*?)\}/g),c=[];if(b){let d=[];b.forEach(a=>{let b=a.substring(1,a.length-1).split(",");d.push(b)}),function a(b,c,d,e,f){let g=c[d];for(let h=0;h<g.length;h++){let i=g[h];d<c.length-1?a(b.replace(e[d],i),c,d+1,e,f):f.push(b.replace(e[d],i))}}(a,d,0,b,c)}else c.push(a);return c}a.s(["createStringVariations",()=>g],69778);let h=a=>!Array.isArray(a);a.s(["isSingleItem",()=>h],87070);class i{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(a,b)=>`${a}${this._bundleIdConnector}${b}`,extractAssetIdFromBundle:(a,b)=>b.replace(`${a}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(a){if(this._bundleIdConnector=a.connector??this._bundleIdConnector,this._createBundleAssetId=a.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=a.extractAssetIdFromBundle??this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...a){a.forEach(a=>{this._preferredOrder.push(a),a.priority||(a.priority=Object.keys(a.params))}),this._resolverHash={}}set basePath(a){this._basePath=a}get basePath(){return this._basePath}set rootPath(a){this._rootPath=a}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(a){"string"==typeof a?this._defaultSearchParams=a:this._defaultSearchParams=Object.keys(a).map(b=>`${encodeURIComponent(b)}=${encodeURIComponent(a[b])}`).join("&")}getAlias(a){let{alias:b,src:c}=a;return(0,f.convertToList)(b||c,a=>"string"==typeof a?a:Array.isArray(a)?a.map(a=>a?.src??a):a?.src?a.src:a,!0)}addManifest(a){this._manifest&&(0,d.warn)("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=a,a.bundles.forEach(a=>{this.addBundle(a.name,a.assets)})}addBundle(a,b){let c=[],d=b;Array.isArray(b)||(d=Object.entries(b).map(([a,b])=>"string"==typeof b||Array.isArray(b)?{alias:a,src:b}:{alias:a,...b})),d.forEach(b=>{let d,e=b.src,f=b.alias;if("string"==typeof f){let b=this._createBundleAssetId(a,f);c.push(b),d=[f,b]}else{let b=f.map(b=>this._createBundleAssetId(a,b));c.push(...b),d=[...f,...b]}this.add({...b,alias:d,src:e})}),this._bundles[a]=c}add(a){let b,c=[];Array.isArray(a)?c.push(...a):c.push(a),b=a=>{this.hasKey(a)&&(0,d.warn)(`[Resolver] already has key: ${a} overwriting`)},(0,f.convertToList)(c).forEach(a=>{let{src:c}=a,{data:d,format:e,loadParser:h,parser:i}=a,j=(0,f.convertToList)(c).map(a=>"string"==typeof a?g(a):Array.isArray(a)?a:[a]),k=this.getAlias(a);Array.isArray(k)?k.forEach(b):b(k);let l=[],m=a=>{let b=this._parsers.find(b=>b.test(a));return{...b?.parse(a),src:a}};j.forEach(b=>{b.forEach(b=>{let c={};if("object"!=typeof b?c=m(b):(d=b.data??d,e=b.format??e,(b.loadParser||b.parser)&&(h=b.loadParser??h,i=b.parser??i),c={...m(b.src),...b}),!k)throw Error(`[Resolver] alias is undefined for this asset: ${c.src}`);c=this._buildResolvedAsset(c,{aliases:k,data:d,format:e,loadParser:h,parser:i,progressSize:a.progressSize}),l.push(c)})}),k.forEach(a=>{this._assetMap[a]=l})})}resolveBundle(a){let b=h(a);a=(0,f.convertToList)(a);let c={};return a.forEach(a=>{let b=this._bundles[a];if(b){let d=this.resolve(b),e={};for(let b in d){let c=d[b];e[this._extractAssetIdFromBundle(a,b)]=c}c[a]=e}}),b?c[a[0]]:c}resolveUrl(a){let b=this.resolve(a);if("string"!=typeof a){let a={};for(let c in b)a[c]=b[c].src;return a}return b.src}resolve(a){let b=h(a);a=(0,f.convertToList)(a);let c={};return a.forEach(a=>{if(!this._resolverHash[a])if(this._assetMap[a]){let b=this._assetMap[a],c=this._getPreferredOrder(b);c?.priority.forEach(a=>{c.params[a].forEach(c=>{let d=b.filter(b=>!!b[a]&&b[a]===c);d.length&&(b=d)})}),this._resolverHash[a]=b[0]}else this._resolverHash[a]=this._buildResolvedAsset({alias:[a],src:a},{});c[a]=this._resolverHash[a]}),b?c[a[0]]:c}hasKey(a){return!!this._assetMap[a]}hasBundle(a){return!!this._bundles[a]}_getPreferredOrder(a){for(let b=0;b<a.length;b++){let c=a[b],d=this._preferredOrder.find(a=>a.params.format.includes(c.format));if(d)return d}return this._preferredOrder[0]}_appendDefaultSearchParams(a){if(!this._defaultSearchParams)return a;let b=/\?/.test(a)?"&":"?";return`${a}${b}${this._defaultSearchParams}`}_buildResolvedAsset(a,b){let{aliases:c,data:d,loadParser:f,parser:g,format:h,progressSize:i}=b;return(this._basePath||this._rootPath)&&(a.src=e.path.toAbsolute(a.src,this._basePath,this._rootPath)),a.alias=c??a.alias??[a.src],a.src=this._appendDefaultSearchParams(a.src),a.data={...d||{},...a.data},a.loadParser=f??a.loadParser,a.parser=g??a.parser,a.format=h??a.format??j(a.src),void 0!==i&&(a.progressSize=i),a}}function j(a){return a.split(".").pop().split("?").shift().split("#").shift()}i.RETINA_PREFIX=/@([0-9\.]+)x/,a.s(["Resolver",()=>i,"getUrlExtension",()=>j],97884);let k=(a,b)=>{let c=b.split("?")[1];return c&&(a+=`?${c}`),a};a.s(["copySearchParams",()=>k],87760);var l=a.i(71805),m=a.i(31023),n=a.i(31394);let o=class a{constructor(a,b){this.linkedSheets=[];let c=a;a?.source instanceof n.TextureSource&&(c={texture:a,data:b});const{texture:d,data:e,cachePrefix:f=""}=c;this.cachePrefix=f,this._texture=d instanceof l.Texture?d:null,this.textureSource=d.source,this.textures={},this.animations={},this.data=e;const g=parseFloat(e.meta.scale);g?(this.resolution=g,d.source.resolution=this.resolution):this.resolution=d.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(b=>{this._callback=b,this._batchIndex=0,this._frameKeys.length<=a.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(b){let c=b,d=a.BATCH_SIZE;for(;c-b<d&&c<this._frameKeys.length;){let a=this._frameKeys[c],b=this._frames[a],d=b.frame;if(d){let c=null,e=null,f=!1!==b.trimmed&&b.sourceSize?b.sourceSize:b.frame,g=new m.Rectangle(0,0,Math.floor(f.w)/this.resolution,Math.floor(f.h)/this.resolution);c=b.rotated?new m.Rectangle(Math.floor(d.x)/this.resolution,Math.floor(d.y)/this.resolution,Math.floor(d.h)/this.resolution,Math.floor(d.w)/this.resolution):new m.Rectangle(Math.floor(d.x)/this.resolution,Math.floor(d.y)/this.resolution,Math.floor(d.w)/this.resolution,Math.floor(d.h)/this.resolution),!1!==b.trimmed&&b.spriteSourceSize&&(e=new m.Rectangle(Math.floor(b.spriteSourceSize.x)/this.resolution,Math.floor(b.spriteSourceSize.y)/this.resolution,Math.floor(d.w)/this.resolution,Math.floor(d.h)/this.resolution)),this.textures[a]=new l.Texture({source:this.textureSource,frame:c,orig:g,trim:e,rotate:2*!!b.rotated,defaultAnchor:b.anchor,defaultBorders:b.borders,label:a.toString()})}c++}}_processAnimations(){let a=this.data.animations||{};for(let b in a){this.animations[b]=[];for(let c=0;c<a[b].length;c++){let d=a[b][c];this.animations[b].push(this.textures[d])}}}_parseComplete(){let a=this._callback;this._callback=null,this._batchIndex=0,a.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*a.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*a.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(a=!1){for(let a in this.textures)this.textures[a].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,a&&(this._texture?.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};o.BATCH_SIZE=1e3,a.s(["Spritesheet",()=>o],23414);let p=["jpg","png","jpeg","avif","webp","basis","etc2","bc7","bc6h","bc5","bc4","bc3","bc2","bc1","eac","astc"],q={extension:b.ExtensionType.Asset,cache:{test:a=>a instanceof o,getCacheableAssets:(a,b)=>(function a(b,c,d){let f={};if(b.forEach(a=>{f[a]=c}),Object.keys(c.textures).forEach(a=>{f[`${c.cachePrefix}${a}`]=c.textures[a]}),!d){let d=e.path.dirname(b[0]);c.linkedSheets.forEach((b,e)=>{Object.assign(f,a([`${d}/${c.data.meta.related_multi_packs[e]}`],b,!0))})}return f})(a,b,!1)},resolver:{extension:{type:b.ExtensionType.ResolveParser,name:"resolveSpritesheet"},test:a=>{let b=a.split("?")[0].split("."),c=b.pop(),d=b.pop();return"json"===c&&p.includes(d)},parse:a=>{let b=a.split(".");return{resolution:parseFloat(i.RETINA_PREFIX.exec(a)?.[1]??"1"),format:b[b.length-2],src:a}}},loader:{name:"spritesheetLoader",id:"spritesheet",extension:{type:b.ExtensionType.LoadParser,priority:c.LoaderParserPriority.Normal,name:"spritesheetLoader"},testParse:async(a,b)=>".json"===e.path.extname(b.src).toLowerCase()&&!!a.frames,async parse(a,b,c){let d,{texture:f,imageFilename:g,textureOptions:h,cachePrefix:i}=b?.data??{},j=e.path.dirname(b.src);if(j&&j.lastIndexOf("/")!==j.length-1&&(j+="/"),f instanceof l.Texture)d=f;else{let e=k(j+(g??a.meta.image),b.src);d=(await c.load([{src:e,data:h}]))[e]}let m=new o({texture:d.source,data:a,cachePrefix:i});await m.parse();let n=a?.meta?.related_multi_packs;if(Array.isArray(n)){let a=[];for(let d of n){if("string"!=typeof d)continue;let e=j+d;b.data?.ignoreMultiPack||(e=k(e,b.src),a.push(c.load({src:e,data:{textureOptions:h,ignoreMultiPack:!0}})))}let d=await Promise.all(a);m.linkedSheets=d,d.forEach(a=>{a.linkedSheets=[m].concat(m.linkedSheets.filter(b=>b!==a))})}return m},async unload(a,b,c){await c.unload(a.textureSource._sourceOrigin),a.destroy(!1)}}};a.s(["spritesheetAsset",()=>q],85901),b.extensions.add(q),a.s([],91540)},48406,5609,56696,95318,85863,19548,31136,55609,a=>{"use strict";let b;var c=a.i(44373),d=a.i(66184),e=a.i(83813),f=a.i(89341);let g=new e.Bounds;function h(a,b,c){a.measurable=!0,(0,f.getGlobalBounds)(a,c,g),b.addBoundsMask(g),a.measurable=!1}a.s(["addMaskBounds",()=>h],5609);var i=a.i(62959),j=a.i(1344),k=a.i(51983);function l(a,b,c){let d=j.boundsPool.get();a.measurable=!0;let e=j.matrixPool.get().identity(),f=function a(b,c,d){return b?b!==c&&(a(b.parent,c,d),b.updateLocalTransform(),d.append(b.localTransform)):(0,k.warn)("Mask bounds, renderable is not inside the root container"),d}(a,c,e);(0,i.getLocalBounds)(a,d,f),a.measurable=!1,b.addBoundsMask(d),j.matrixPool.return(e),j.boundsPool.return(d)}a.s(["addMaskLocalBounds",()=>l],56696);class m{constructor(a){this.priority=0,this.inverse=!1,this.pipe="alphaMask",a?.mask&&this.init(a.mask)}init(a){this.mask=a,this.renderMaskToTexture=!(a instanceof d.Sprite),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){null!==this.mask&&(this.mask.measurable=!0,this.mask=null)}addBounds(a,b){this.inverse||h(this.mask,a,b)}addLocalBounds(a,b){l(this.mask,a,b)}containsPoint(a,b){return b(this.mask,a)}destroy(){this.reset()}static test(a){return a instanceof d.Sprite}}m.extension=c.ExtensionType.MaskEffect,a.s(["AlphaMask",()=>m],48406);class n{constructor(a){this.priority=0,this.pipe="colorMask",a?.mask&&this.init(a.mask)}init(a){this.mask=a}destroy(){}static test(a){return"number"==typeof a}}n.extension=c.ExtensionType.MaskEffect,a.s(["ColorMask",()=>n],95318);var o=a.i(84764);class p{constructor(a){this.priority=0,this.pipe="stencilMask",a?.mask&&this.init(a.mask)}init(a){this.mask=a,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){null!==this.mask&&(this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null)}addBounds(a,b){h(this.mask,a,b)}addLocalBounds(a,b){l(this.mask,a,b)}containsPoint(a,b){return b(this.mask,a)}destroy(){this.reset()}static test(a){return a instanceof o.Container}}p.extension=c.ExtensionType.MaskEffect,a.s(["StencilMask",()=>p],85863);var q=a.i(31394);class r extends q.TextureSource{constructor(a){super(a),this.uploadMethodId="image",this.autoGarbageCollect=!0}static test(a){return globalThis.HTMLImageElement&&a instanceof HTMLImageElement||"undefined"!=typeof ImageBitmap&&a instanceof ImageBitmap||globalThis.VideoFrame&&a instanceof VideoFrame}}r.extension=c.ExtensionType.TextureSource,a.s(["ImageSource",()=>r],19548);var s=a.i(83717),t=a.i(58422);async function u(){return b??(b=(async()=>{let a=t.DOMAdapter.get().createCanvas(1,1).getContext("webgl");if(!a)return"premultiply-alpha-on-upload";let b=await new Promise(a=>{let b=document.createElement("video");b.onloadeddata=()=>a(b),b.onerror=()=>a(null),b.autoplay=!1,b.crossOrigin="anonymous",b.preload="auto",b.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",b.load()});if(!b)return"premultiply-alpha-on-upload";let c=a.createTexture();a.bindTexture(a.TEXTURE_2D,c);let d=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,d),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,c,0),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.NONE),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,b);let e=new Uint8Array(4);return a.readPixels(0,0,1,1,a.RGBA,a.UNSIGNED_BYTE,e),a.deleteFramebuffer(d),a.deleteTexture(c),a.getExtension("WEBGL_lose_context")?.loseContext(),e[0]<=e[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),b}a.s(["detectVideoAlphaMode",()=>u],31136);var v=q;let w=class a extends v.TextureSource{constructor(b){super(b),this.isReady=!1,this.uploadMethodId="video",b={...a.defaultOptions,...b},this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=b.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==b.autoPlay,this.alphaMode=b.alphaMode??"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),!1!==b.autoLoad&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){let a=s.Ticker.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-a)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;let a=this.resource,b=this.options;return(a.readyState===a.HAVE_ENOUGH_DATA||a.readyState===a.HAVE_FUTURE_DATA)&&a.width&&a.height&&(a.complete=!0),a.addEventListener("play",this._onPlayStart),a.addEventListener("pause",this._onPlayStop),a.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._mediaReady():(b.preload||a.addEventListener("canplay",this._onCanPlay),a.addEventListener("canplaythrough",this._onCanPlayThrough),a.addEventListener("error",this._onError,!0)),this.alphaMode=await u(),this._load=new Promise((c,d)=>{this.isValid?c(this):(this._resolve=c,this._reject=d,void 0!==b.preloadTimeoutMs&&(this._preloadTimeout=setTimeout(()=>{this._onError(new ErrorEvent(`Preload exceeded timeout of ${b.preloadTimeoutMs}ms`))})),a.load())}),this._load}_onError(a){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",a),this._reject&&(this._reject(a),this._reject=null,this._resolve=null)}_isSourcePlaying(){let a=this.resource;return!a.paused&&!a.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._mediaReady(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){this.resource.removeEventListener("canplay",this._onCanPlay),this._mediaReady()}_onCanPlayThrough(){this.resource.removeEventListener("canplaythrough",this._onCanPlay),this._preloadTimeout&&(clearTimeout(this._preloadTimeout),this._preloadTimeout=void 0),this._mediaReady()}_mediaReady(){let a=this.resource;this.isValid&&(this.isReady=!0,this.resize(a.videoWidth,a.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();let a=this.resource;a&&(a.removeEventListener("play",this._onPlayStart),a.removeEventListener("pause",this._onPlayStop),a.removeEventListener("seeked",this._onSeeked),a.removeEventListener("canplay",this._onCanPlay),a.removeEventListener("canplaythrough",this._onCanPlayThrough),a.removeEventListener("error",this._onError,!0),a.pause(),a.src="",a.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(a){a!==this._autoUpdate&&(this._autoUpdate=a,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(a){a!==this._updateFPS&&(this._updateFPS=a,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.resource.requestVideoFrameCallback?(this._isConnectedToTicker&&(s.Ticker.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),null===this._videoFrameRequestCallbackHandle&&(this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback))):(null!==this._videoFrameRequestCallbackHandle&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(s.Ticker.shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(null!==this._videoFrameRequestCallbackHandle&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(s.Ticker.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(a){return globalThis.HTMLVideoElement&&a instanceof HTMLVideoElement}};w.extension=c.ExtensionType.TextureSource,w.defaultOptions={...v.TextureSource.defaultOptions,autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1},w.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},a.s(["VideoSource",()=>w],55609)},28755,33221,68087,a=>{"use strict";var b=a.i(44373),c=a.i(48406),d=a.i(95318),e=a.i(85863),f=a.i(85942),g=a.i(39238),h=a.i(19548),i=a.i(55609),j=a.i(51983),k=a.i(68464);let l=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(a){return this._cache.has(a)}get(a){let b=this._cache.get(a);return b||(0,j.warn)(`[Assets] Asset id ${a} was not found in the Cache`),b}set(a,b){let c,d=(0,k.convertToList)(a);for(let a=0;a<this.parsers.length;a++){let e=this.parsers[a];if(e.test(b)){c=e.getCacheableAssets(d,b);break}}let e=new Map(Object.entries(c||{}));c||d.forEach(a=>{e.set(a,b)});let f=[...e.keys()],g={cacheKeys:f,keys:d};d.forEach(a=>{this._cacheMap.set(a,g)}),f.forEach(a=>{let d=c?c[a]:b;this._cache.has(a)&&this._cache.get(a)!==d&&(0,j.warn)("[Cache] already has key:",a),this._cache.set(a,e.get(a))})}remove(a){if(!this._cacheMap.has(a))return void(0,j.warn)(`[Assets] Asset id ${a} was not found in the Cache`);let b=this._cacheMap.get(a);b.cacheKeys.forEach(a=>{this._cache.delete(a)}),b.keys.forEach(a=>{this._cacheMap.delete(a)})}get parsers(){return this._parsers}};a.s(["Cache",()=>l],33221);var m=a.i(31394),n=a.i(71805);let o=[];function p(a={}){return q(a)}function q(a={}){let b=a&&a.resource,c=b?a.resource:a,d=b?a:{resource:a};for(let a=0;a<o.length;a++){let b=o[a];if(b.test(c))return new b(d)}throw Error(`Could not find a source type for resource: ${d.resource}`)}function r(a={},b=!1){let c=a&&a.resource,d=c?a.resource:a,e=c?a:{resource:a};if(!b&&l.has(d))return l.get(d);let f=new n.Texture({source:q(e)});return f.on("destroy",()=>{l.has(d)&&l.remove(d)}),b||l.set(d,f),f}function s(a,b=!1){return"string"==typeof a?l.get(a):a instanceof m.TextureSource?new n.Texture({source:a}):r(a,b)}b.extensions.handleByList(b.ExtensionType.TextureSource,o),n.Texture.from=s,m.TextureSource.from=q,a.s(["autoDetectSource",()=>p,"resourceToTexture",()=>r,"textureFrom",()=>s],68087),b.extensions.add(c.AlphaMask,d.ColorMask,e.StencilMask,i.VideoSource,h.ImageSource,g.CanvasSource,f.BufferImageSource),a.s([],28755)},75594,98183,48957,17487,92254,61489,2048,82285,12336,8300,83332,47295,77270,a=>{"use strict";function b(a,c,d,e,f,g,h,i=null){let j=0;d*=c,f*=g;let k=i.a,l=i.b,m=i.c,n=i.d,o=i.tx,p=i.ty;for(;j<h;){let b=a[d],h=a[d+1];e[f]=k*b+m*h+o,e[f+1]=l*b+n*h+p,f+=g,d+=c,j++}}function c(a,b,c,d){let e=0;for(b*=c;e<d;)a[b]=0,a[b+1]=0,b+=c,e++}function d(a,b,c,d,e){let f=b.a,g=b.b,h=b.c,i=b.d,j=b.tx,k=b.ty;c||(c=0),d||(d=2),e||(e=a.length/d-c);let l=c*d;for(let b=0;b<e;b++){let b=a[l],c=a[l+1];a[l]=f*b+h*c+j,a[l+1]=g*b+i*c+k,l+=d}}a.s(["buildSimpleUvs",()=>c,"buildUvs",()=>b],75594),a.s(["transformVertices",()=>d],98183);var e=a.i(67309),f=a.i(7062);let g=new e.Matrix;class h{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.renderable&&this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){let a=this.baseColor,b=a>>16|65280&a|(255&a)<<16,c=this.renderable;return c?(0,f.multiplyHexColors)(b,c.groupColor)+(this.alpha*c.groupAlpha*255<<24):b+(255*this.alpha<<24)}get transform(){return this.renderable?.groupTransform||g}copyTo(a){a.indexOffset=this.indexOffset,a.indexSize=this.indexSize,a.attributeOffset=this.attributeOffset,a.attributeSize=this.attributeSize,a.baseColor=this.baseColor,a.alpha=this.alpha,a.texture=this.texture,a.geometryData=this.geometryData,a.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}destroy(){this.renderable=null,this.texture=null,this.geometryData=null,this._batcher=null,this._batch=null}}a.s(["BatchableGraphics",()=>h],48957);var i=a.i(44373);let j={extension:{type:i.ExtensionType.ShapeBuilder,name:"circle"},build(a,b){let c,d,e,f,g,h;if("circle"===a.type){if((g=h=a.radius)<=0)return!1;c=a.x,d=a.y,e=f=0}else if("ellipse"===a.type){if(g=a.halfWidth,h=a.halfHeight,g<=0||h<=0)return!1;c=a.x,d=a.y,e=f=0}else{let b=a.width/2,i=a.height/2;c=a.x+b,d=a.y+i,g=h=Math.max(0,Math.min(a.radius,Math.min(b,i))),e=b-g,f=i-h}if(e<0||f<0)return!1;let i=Math.ceil(2.3*Math.sqrt(g+h)),j=8*i+4*!!e+4*!!f;if(0===j)return!1;if(0===i)return b[0]=b[6]=c+e,b[1]=b[3]=d+f,b[2]=b[4]=c-e,b[5]=b[7]=d-f,!0;let k=0,l=4*i+2*!!e+2,m=l,n=j,o=e+g,p=f,q=c+o,r=c-o,s=d+p;if(b[k++]=q,b[k++]=s,b[--l]=s,b[--l]=r,f){let a=d-p;b[m++]=r,b[m++]=a,b[--n]=a,b[--n]=q}for(let a=1;a<i;a++){let j=Math.PI/2*(a/i),o=e+Math.cos(j)*g,p=f+Math.sin(j)*h,q=c+o,r=c-o,s=d+p,t=d-p;b[k++]=q,b[k++]=s,b[--l]=s,b[--l]=r,b[m++]=r,b[m++]=t,b[--n]=t,b[--n]=q}o=e,p=f+h,q=c+o,r=c-o,s=d+p;let t=d-p;return b[k++]=q,b[k++]=s,b[--n]=t,b[--n]=q,e&&(b[k++]=r,b[k++]=s,b[--n]=t,b[--n]=r),!0},triangulate(a,b,c,d,e,f){if(0===a.length)return;let g=0,h=0;for(let b=0;b<a.length;b+=2)g+=a[b],h+=a[b+1];g/=a.length/2,h/=a.length/2;let i=d;b[i*c]=g,b[i*c+1]=h;let j=i++;for(let d=0;d<a.length;d+=2)b[i*c]=a[d],b[i*c+1]=a[d+1],d>0&&(e[f++]=i,e[f++]=j,e[f++]=i-1),i++;e[f++]=j+1,e[f++]=j,e[f++]=i-1}},k={...j,extension:{...j.extension,name:"ellipse"}},l={...j,extension:{...j.extension,name:"roundedRectangle"}};a.s(["buildCircle",()=>j,"buildEllipse",()=>k,"buildRoundedRectangle",()=>l],17487);var m=a.i(47790);function n(a){let b=a.length;if(b<6)return 1;let c=0;for(let d=0,e=a[b-2],f=a[b-1];d<b;d+=2){let b=a[d],g=a[d+1];c+=(b-e)*(g+f),e=b,f=g}return c<0?-1:1}function o(a,b,c,d,e,f,g,h){let i,j;g?(i=d,j=-c):(i=-d,j=c);let k=a-c*e+i,l=b-d*e+j,m=a+c*f+i,n=b+d*f+j;return h.push(k,l),h.push(m,n),2}function p(a,b,c,d,e,f,g,h){let i=c-a,j=d-b,k=Math.atan2(i,j),l=Math.atan2(e-a,f-b);h&&k<l?k+=2*Math.PI:!h&&k>l&&(l+=2*Math.PI);let m=k,n=l-k,o=Math.sqrt(i*i+j*j),p=(15*Math.abs(n)*Math.sqrt(o)/Math.PI|0)+1,q=n/p;if(m+=q,h){g.push(a,b),g.push(c,d);for(let c=1,d=m;c<p;c++,d+=q)g.push(a,b),g.push(a+Math.sin(d)*o,b+Math.cos(d)*o);g.push(a,b),g.push(e,f)}else{g.push(c,d),g.push(a,b);for(let c=1,d=m;c<p;c++,d+=q)g.push(a+Math.sin(d)*o,b+Math.cos(d)*o),g.push(a,b);g.push(e,f),g.push(a,b)}return 2*p}function q(a,b,c,d,e,f){if(0===a.length)return;let g=b.alignment;if(.5!==b.alignment){let b=n(a);c&&(b*=-1),g=(g-.5)*b+.5}let h=new m.Point(a[0],a[1]),i=new m.Point(a[a.length-2],a[a.length-1]),j=1e-4>Math.abs(h.x-i.x)&&1e-4>Math.abs(h.y-i.y);if(d){a=a.slice(),j&&(a.pop(),a.pop(),i.set(a[a.length-2],a[a.length-1]));let b=(h.x+i.x)*.5,c=(i.y+h.y)*.5;a.unshift(b,c),a.push(b,c)}let k=a.length/2,l=a.length,q=e.length/2,r=b.width/2,s=r*r,t=b.miterLimit*b.miterLimit,u=a[0],v=a[1],w=a[2],x=a[3],y=0,z=0,A=-(v-x),B=u-w,C=0,D=0,E=Math.sqrt(A*A+B*B);A/=E,B/=E,A*=r,B*=r;let F=g,G=(1-F)*2,H=2*F;d||("round"===b.cap?l+=p(u-A*(G-H)*.5,v-B*(G-H)*.5,u-A*G,v-B*G,u+A*H,v+B*H,e,!0)+2:"square"===b.cap&&(l+=o(u,v,A,B,G,H,!0,e))),e.push(u-A*G,v-B*G),e.push(u+A*H,v+B*H);for(let c=1;c<k-1;++c){u=a[(c-1)*2],v=a[(c-1)*2+1],w=a[2*c],x=a[2*c+1],y=a[(c+1)*2],z=a[(c+1)*2+1],E=Math.sqrt((A=-(v-x))*A+(B=u-w)*B),A/=E,B/=E,A*=r,B*=r,E=Math.sqrt((C=-(x-z))*C+(D=w-y)*D),C/=E,D/=E,C*=r,D*=r;let d=w-u,f=v-x,g=w-y,h=z-x,i=d*g+f*h,j=f*g-h*d,k=j<0;if(Math.abs(j)<.001*Math.abs(i)){e.push(w-A*G,x-B*G),e.push(w+A*H,x+B*H),i>=0&&("round"===b.join?l+=p(w,x,w-A*G,x-B*G,w-C*G,x-D*G,e,!1)+4:l+=2,e.push(w-C*H,x-D*H),e.push(w+C*G,x+D*G));continue}let m=(-A+u)*(-B+x)-(-A+w)*(-B+v),n=(-C+y)*(-D+x)-(-C+w)*(-D+z),o=(d*n-g*m)/j,q=(h*m-f*n)/j,F=(o-w)*(o-w)+(q-x)*(q-x),I=w+(o-w)*G,J=x+(q-x)*G,K=w-(o-w)*H,L=x-(q-x)*H,M=k?G:H;F<=Math.min(d*d+f*f,g*g+h*h)+M*M*s?"bevel"===b.join||F/s>t?(k?(e.push(I,J),e.push(w+A*H,x+B*H),e.push(I,J),e.push(w+C*H,x+D*H)):(e.push(w-A*G,x-B*G),e.push(K,L),e.push(w-C*G,x-D*G),e.push(K,L)),l+=2):"round"===b.join?k?(e.push(I,J),e.push(w+A*H,x+B*H),l+=p(w,x,w+A*H,x+B*H,w+C*H,x+D*H,e,!0)+4,e.push(I,J),e.push(w+C*H,x+D*H)):(e.push(w-A*G,x-B*G),e.push(K,L),l+=p(w,x,w-A*G,x-B*G,w-C*G,x-D*G,e,!1)+4,e.push(w-C*G,x-D*G),e.push(K,L)):(e.push(I,J),e.push(K,L)):(e.push(w-A*G,x-B*G),e.push(w+A*H,x+B*H),"round"===b.join?k?l+=p(w,x,w+A*H,x+B*H,w+C*H,x+D*H,e,!0)+2:l+=p(w,x,w-A*G,x-B*G,w-C*G,x-D*G,e,!1)+2:"miter"===b.join&&F/s<=t&&(k?(e.push(K,L),e.push(K,L)):(e.push(I,J),e.push(I,J)),l+=2),e.push(w-C*G,x-D*G),e.push(w+C*H,x+D*H),l+=2)}u=a[(k-2)*2],v=a[(k-2)*2+1],w=a[(k-1)*2],E=Math.sqrt((A=-(v-(x=a[(k-1)*2+1])))*A+(B=u-w)*B),A/=E,B/=E,A*=r,B*=r,e.push(w-A*G,x-B*G),e.push(w+A*H,x+B*H),d||("round"===b.cap?l+=p(w-A*(G-H)*.5,x-B*(G-H)*.5,w-A*G,x-B*G,w+A*H,x+B*H,e,!1)+2:"square"===b.cap&&(l+=o(w,x,A,B,G,H,!1,e)));let I=1e-4*1e-4;for(let a=q;a<l+q-2;++a)u=e[2*a],v=e[2*a+1],w=e[(a+1)*2],x=e[(a+1)*2+1],y=e[(a+2)*2],Math.abs(u*(x-(z=e[(a+2)*2+1]))+w*(z-v)+y*(v-x))<I||f.push(a,a+1,a+2)}function r(a,b,c,d){if(0===a.length)return;let e=a[0],f=a[1],g=a[a.length-2],h=a[a.length-1],i=b||1e-4>Math.abs(e-g)&&1e-4>Math.abs(f-h),j=a.length/2,k=c.length/2;for(let b=0;b<j;b++)c.push(a[2*b]),c.push(a[2*b+1]);for(let a=0;a<j-1;a++)d.push(k+a,k+a+1);i&&d.push(k+j-1,k)}function s(a,b,c=2){let d,e,f,g=b&&b.length,h=g?b[0]*c:a.length,i=t(a,0,h,c,!0),j=[];if(!i||i.next===i.prev)return j;if(g&&(i=function(a,b,c,d){let e=[];for(let c=0,f=b.length;c<f;c++){let g=b[c]*d,h=c<f-1?b[c+1]*d:a.length,i=t(a,g,h,d,!1);i===i.next&&(i.steiner=!0),e.push(function(a){let b=a,c=a;do(b.x<c.x||b.x===c.x&&b.y<c.y)&&(c=b),b=b.next;while(b!==a)return c}(i))}e.sort(v);for(let a=0;a<e.length;a++)c=function(a,b){let c=function(a,b){let c,d=b,e=a.x,f=a.y,g=-1/0;if(A(a,d))return d;do{if(A(a,d.next))return d.next;if(f<=d.y&&f>=d.next.y&&d.next.y!==d.y){let a=d.x+(f-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(a<=e&&a>g&&(g=a,c=d.x<d.next.x?d:d.next,a===e))return c}d=d.next}while(d!==b)if(!c)return null;let h=c,i=c.x,j=c.y,k=1/0;d=c;do{if(e>=d.x&&d.x>=i&&e!==d.x&&x(f<j?e:g,f,i,j,f<j?g:e,f,d.x,d.y)){var l,m;let b=Math.abs(f-d.y)/(e-d.x);E(d,a)&&(b<k||b===k&&(d.x>c.x||d.x===c.x&&(l=c,m=d,0>z(l.prev,l,m.prev)&&0>z(m.next,l,l.next))))&&(c=d,k=b)}d=d.next}while(d!==h)return c}(a,b);if(!c)return b;let d=F(c,a);return u(d,d.next),u(c,c.next)}(e[a],c);return c}(a,b,i,c)),a.length>80*c){d=a[0],e=a[1];let b=d,g=e;for(let f=c;f<h;f+=c){let c=a[f],h=a[f+1];c<d&&(d=c),h<e&&(e=h),c>b&&(b=c),h>g&&(g=h)}f=0!==(f=Math.max(b-d,g-e))?32767/f:0}return function a(b,c,d,e,f,g,h){if(!b)return;!h&&g&&function(a,b,c,d){let e=a;do 0===e.z&&(e.z=w(e.x,e.y,b,c,d)),e.prevZ=e.prev,e.nextZ=e.next,e=e.next;while(e!==a)e.prevZ.nextZ=null,e.prevZ=null,function(a){let b,c=1;do{let d,e=a;a=null;let f=null;for(b=0;e;){b++;let g=e,h=0;for(let a=0;a<c&&(h++,g=g.nextZ);a++);let i=c;for(;h>0||i>0&&g;)0!==h&&(0===i||!g||e.z<=g.z)?(d=e,e=e.nextZ,h--):(d=g,g=g.nextZ,i--),f?f.nextZ=d:a=d,d.prevZ=f,f=d;e=g}f.nextZ=null,c*=2}while(b>1)}(e)}(b,e,f,g);let i=b;for(;b.prev!==b.next;){let j=b.prev,k=b.next;if(g?function(a,b,c,d){let e=a.prev,f=a.next;if(z(e,a,f)>=0)return!1;let g=e.x,h=a.x,i=f.x,j=e.y,k=a.y,l=f.y,m=Math.min(g,h,i),n=Math.min(j,k,l),o=Math.max(g,h,i),p=Math.max(j,k,l),q=w(m,n,b,c,d),r=w(o,p,b,c,d),s=a.prevZ,t=a.nextZ;for(;s&&s.z>=q&&t&&t.z<=r;){if(s.x>=m&&s.x<=o&&s.y>=n&&s.y<=p&&s!==e&&s!==f&&y(g,j,h,k,i,l,s.x,s.y)&&z(s.prev,s,s.next)>=0||(s=s.prevZ,t.x>=m&&t.x<=o&&t.y>=n&&t.y<=p&&t!==e&&t!==f&&y(g,j,h,k,i,l,t.x,t.y)&&z(t.prev,t,t.next)>=0))return!1;t=t.nextZ}for(;s&&s.z>=q;){if(s.x>=m&&s.x<=o&&s.y>=n&&s.y<=p&&s!==e&&s!==f&&y(g,j,h,k,i,l,s.x,s.y)&&z(s.prev,s,s.next)>=0)return!1;s=s.prevZ}for(;t&&t.z<=r;){if(t.x>=m&&t.x<=o&&t.y>=n&&t.y<=p&&t!==e&&t!==f&&y(g,j,h,k,i,l,t.x,t.y)&&z(t.prev,t,t.next)>=0)return!1;t=t.nextZ}return!0}(b,e,f,g):function(a){let b=a.prev,c=a.next;if(z(b,a,c)>=0)return!1;let d=b.x,e=a.x,f=c.x,g=b.y,h=a.y,i=c.y,j=Math.min(d,e,f),k=Math.min(g,h,i),l=Math.max(d,e,f),m=Math.max(g,h,i),n=c.next;for(;n!==b;){if(n.x>=j&&n.x<=l&&n.y>=k&&n.y<=m&&y(d,g,e,h,f,i,n.x,n.y)&&z(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}(b)){c.push(j.i,b.i,k.i),H(b),b=k.next,i=k.next;continue}if((b=k)===i){h?1===h?a(b=function(a,b){let c=a;do{let d=c.prev,e=c.next.next;!A(d,e)&&B(d,c,c.next,e)&&E(d,e)&&E(e,d)&&(b.push(d.i,c.i,e.i),H(c),H(c.next),c=a=e),c=c.next}while(c!==a)return u(c)}(u(b),c),c,d,e,f,g,2):2===h&&function(b,c,d,e,f,g){let h=b;do{let b=h.next.next;for(;b!==h.prev;){var i,j;if(h.i!==b.i&&(i=h,j=b,i.next.i!==j.i&&i.prev.i!==j.i&&!function(a,b){let c=a;do{if(c.i!==a.i&&c.next.i!==a.i&&c.i!==b.i&&c.next.i!==b.i&&B(c,c.next,a,b))return!0;c=c.next}while(c!==a)return!1}(i,j)&&(E(i,j)&&E(j,i)&&function(a,b){let c=a,d=!1,e=(a.x+b.x)/2,f=(a.y+b.y)/2;do c.y>f!=c.next.y>f&&c.next.y!==c.y&&e<(c.next.x-c.x)*(f-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next;while(c!==a)return d}(i,j)&&(z(i.prev,i,j.prev)||z(i,j.prev,j))||A(i,j)&&z(i.prev,i,i.next)>0&&z(j.prev,j,j.next)>0))){let i=F(h,b);h=u(h,h.next),i=u(i,i.next),a(h,c,d,e,f,g,0),a(i,c,d,e,f,g,0);return}b=b.next}h=h.next}while(h!==b)}(b,c,d,e,f,g):a(u(b),c,d,e,f,g,1);break}}}(i,j,c,d,e,f,0),j}function t(a,b,c,d,e){let f;if(e===function(a,b,c,d){let e=0;for(let f=b,g=c-d;f<c;f+=d)e+=(a[g]-a[f])*(a[f+1]+a[g+1]),g=f;return e}(a,b,c,d)>0)for(let e=b;e<c;e+=d)f=G(e/d|0,a[e],a[e+1],f);else for(let e=c-d;e>=b;e-=d)f=G(e/d|0,a[e],a[e+1],f);return f&&A(f,f.next)&&(H(f),f=f.next),f}function u(a,b){if(!a)return a;b||(b=a);let c=a,d;do if(d=!1,!c.steiner&&(A(c,c.next)||0===z(c.prev,c,c.next))){if(H(c),(c=b=c.prev)===c.next)break;d=!0}else c=c.next;while(d||c!==b)return b}a.s(["closePointEps",()=>1e-4,"curveEps",()=>1e-4],92254),a.s(["getOrientationOfPoints",()=>n],61489),a.s(["buildLine",()=>q],2048),a.s(["buildPixelLine",()=>r],82285);function v(a,b){let c=a.x-b.x;return 0===c&&0==(c=a.y-b.y)&&(c=(a.next.y-a.y)/(a.next.x-a.x)-(b.next.y-b.y)/(b.next.x-b.x)),c}function w(a,b,c,d,e){return(a=((a=((a=((a=((a=(a-c)*e|0)|a<<8)&0xff00ff)|a<<4)&0xf0f0f0f)|a<<2)&0x33333333)|a<<1)&0x55555555)|(b=((b=((b=((b=((b=(b-d)*e|0)|b<<8)&0xff00ff)|b<<4)&0xf0f0f0f)|b<<2)&0x33333333)|b<<1)&0x55555555)<<1}function x(a,b,c,d,e,f,g,h){return(e-g)*(b-h)>=(a-g)*(f-h)&&(a-g)*(d-h)>=(c-g)*(b-h)&&(c-g)*(f-h)>=(e-g)*(d-h)}function y(a,b,c,d,e,f,g,h){return(a!==g||b!==h)&&x(a,b,c,d,e,f,g,h)}function z(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)}function A(a,b){return a.x===b.x&&a.y===b.y}function B(a,b,c,d){let e=D(z(a,b,c)),f=D(z(a,b,d)),g=D(z(c,d,a)),h=D(z(c,d,b));return!!(e!==f&&g!==h||0===e&&C(a,c,b)||0===f&&C(a,d,b)||0===g&&C(c,a,d)||0===h&&C(c,b,d))}function C(a,b,c){return b.x<=Math.max(a.x,c.x)&&b.x>=Math.min(a.x,c.x)&&b.y<=Math.max(a.y,c.y)&&b.y>=Math.min(a.y,c.y)}function D(a){return a>0?1:a<0?-1:0}function E(a,b){return 0>z(a.prev,a,a.next)?z(a,b,a.next)>=0&&z(a,a.prev,b)>=0:0>z(a,b,a.prev)||0>z(a,a.next,b)}function F(a,b){let c=I(a.i,a.x,a.y),d=I(b.i,b.x,b.y),e=a.next,f=b.prev;return a.next=b,b.prev=a,c.next=e,e.prev=c,d.next=c,c.prev=d,f.next=d,d.prev=f,d}function G(a,b,c,d){let e=I(a,b,c);return d?(e.next=d.next,e.prev=d,d.next.prev=e,d.next=e):(e.prev=e,e.next=e),e}function H(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function I(a,b,c){return{i:a,x:b,y:c,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}a.i(61607);let J=s.default||s;function K(a,b,c,d,e,f,g){let h=J(a,b,2);if(!h)return;for(let a=0;a<h.length;a+=3)f[g++]=h[a]+e,f[g++]=h[a+1]+e,f[g++]=h[a+2]+e;let i=e*d;for(let b=0;b<a.length;b+=2)c[i]=a[b],c[i+1]=a[b+1],i+=d}a.s(["earcut",()=>J],12336),a.s(["triangulateWithHoles",()=>K],8300);let L=[],M={extension:{type:i.ExtensionType.ShapeBuilder,name:"polygon"},build(a,b){for(let c=0;c<a.points.length;c++)b[c]=a.points[c];return!0},triangulate(a,b,c,d,e,f){K(a,L,b,c,d,e,f)}};a.s(["buildPolygon",()=>M],83332);let N={extension:{type:i.ExtensionType.ShapeBuilder,name:"rectangle"},build(a,b){let c=a.x,d=a.y,e=a.width,f=a.height;return!!(e>0&&f>0)&&(b[0]=c,b[1]=d,b[2]=c+e,b[3]=d,b[4]=c+e,b[5]=d+f,b[6]=c,b[7]=d+f,!0)},triangulate(a,b,c,d,e,f){let g=0;b[(d*=c)+g]=a[0],b[d+g+1]=a[1],g+=c,b[d+g]=a[2],b[d+g+1]=a[3],g+=c,b[d+g]=a[6],b[d+g+1]=a[7],g+=c,b[d+g]=a[4],b[d+g+1]=a[5],g+=c;let h=d/c;e[f++]=h,e[f++]=h+1,e[f++]=h+2,e[f++]=h+1,e[f++]=h+3,e[f++]=h+2}};a.s(["buildRectangle",()=>N],47295);let O={extension:{type:i.ExtensionType.ShapeBuilder,name:"triangle"},build:(a,b)=>(b[0]=a.x,b[1]=a.y,b[2]=a.x2,b[3]=a.y2,b[4]=a.x3,b[5]=a.y3,!0),triangulate(a,b,c,d,e,f){let g=0;b[(d*=c)+g]=a[0],b[d+g+1]=a[1],g+=c,b[d+g]=a[2],b[d+g+1]=a[3],g+=c,b[d+g]=a[4],b[d+g+1]=a[5];let h=d/c;e[f++]=h,e[f++]=h+1,e[f++]=h+2}};a.s(["buildTriangle",()=>O],77270)},13753,a=>{"use strict";var b=a.i(98063),c=a.i(58422),d=a.i(67309),e=a.i(19548),f=a.i(71805),g=a.i(90423),h=a.i(2897),i=a.i(43925);let j=[{offset:0,color:"white"},{offset:1,color:"black"}],k=class a{constructor(...b){this.uid=(0,g.uid)("fillGradient"),this._tick=0,this.type="linear",this.colorStops=[];let c=function(a){let b=a[0]??{};return("number"==typeof b||a[1])&&((0,h.deprecation)("8.5.2","use options object instead"),b={type:"linear",start:{x:a[0],y:a[1]},end:{x:a[2],y:a[3]},textureSpace:a[4],textureSize:a[5]??k.defaultLinearOptions.textureSize}),b}(b);c={..."radial"===c.type?a.defaultRadialOptions:a.defaultLinearOptions,...(0,i.definedProps)(c)},this._textureSize=c.textureSize,this._wrapMode=c.wrapMode,"radial"===c.type?(this.center=c.center,this.outerCenter=c.outerCenter??this.center,this.innerRadius=c.innerRadius,this.outerRadius=c.outerRadius,this.scale=c.scale,this.rotation=c.rotation):(this.start=c.start,this.end=c.end),this.textureSpace=c.textureSpace,this.type=c.type,c.colorStops.forEach(a=>{this.addColorStop(a.offset,a.color)})}addColorStop(a,c){return this.colorStops.push({offset:a,color:b.Color.shared.setValue(c).toHexa()}),this}buildLinearGradient(){if(this.texture)return;let{x:a,y:b}=this.start,{x:c,y:g}=this.end,h=c-a,i=g-b,k=h<0||i<0;if("clamp-to-edge"===this._wrapMode){if(h<0){let b=a;a=c,c=b,h*=-1}if(i<0){let a=b;b=g,g=a,i*=-1}}let n=this.colorStops.length?this.colorStops:j,o=this._textureSize,{canvas:p,context:q}=m(o,1),r=k?q.createLinearGradient(this._textureSize,0,0,0):q.createLinearGradient(0,0,this._textureSize,0);l(r,n),q.fillStyle=r,q.fillRect(0,0,o,1),this.texture=new f.Texture({source:new e.ImageSource({resource:p,addressMode:this._wrapMode})});let s=Math.sqrt(h*h+i*i),t=Math.atan2(i,h),u=new d.Matrix;u.scale(s/o,1),u.rotate(t),u.translate(a,b),"local"===this.textureSpace&&u.scale(o,o),this.transform=u}buildGradient(){!this.texture&&this._tick++,"linear"===this.type?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;let a=this.colorStops.length?this.colorStops:j,b=this._textureSize,{canvas:c,context:g}=m(b,b),{x:h,y:i}=this.center,{x:k,y:n}=this.outerCenter,o=this.innerRadius,p=this.outerRadius,q=k-p,r=n-p,s=b/(2*p),t=(h-q)*s,u=(i-r)*s,v=g.createRadialGradient(t,u,o*s,(k-q)*s,(n-r)*s,p*s);l(v,a),g.fillStyle=a[a.length-1].color,g.fillRect(0,0,b,b),g.fillStyle=v,g.translate(t,u),g.rotate(this.rotation),g.scale(1,this.scale),g.translate(-t,-u),g.fillRect(0,0,b,b),this.texture=new f.Texture({source:new e.ImageSource({resource:c,addressMode:this._wrapMode})});let w=new d.Matrix;w.scale(1/s,1/s),w.translate(q,r),"local"===this.textureSpace&&w.scale(b,b),this.transform=w}destroy(){this.texture?.destroy(!0),this.texture=null,this.transform=null,this.colorStops=[],this.start=null,this.end=null,this.center=null,this.outerCenter=null}get styleKey(){return`fill-gradient-${this.uid}-${this._tick}`}};function l(a,b){for(let c=0;c<b.length;c++){let d=b[c];a.addColorStop(d.offset,d.color)}}function m(a,b){let d=c.DOMAdapter.get().createCanvas(a,b),e=d.getContext("2d");return{canvas:d,context:e}}k.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256,wrapMode:"clamp-to-edge"},k.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256,wrapMode:"clamp-to-edge"},a.s(["FillGradient",()=>k])},68667,45914,43817,a=>{"use strict";var b=a.i(44373),c=a.i(2780),d=a.i(28277),e=a.i(33502),f=a.i(46629),g=a.i(2897),h=a.i(3832),i=a.i(67309),j=a.i(31023),k=a.i(75594),l=a.i(98183),m=a.i(71805),n=a.i(48957),o=a.i(17487),p=a.i(2048),q=a.i(82285),r=a.i(83332),s=a.i(47295),t=a.i(77270),u=a.i(13753);let v=new i.Matrix,w=new j.Rectangle;function x(a,b,c,d){let e=b.matrix?a.copyFrom(b.matrix).invert():a.identity();if("local"===b.textureSpace){let a=c.getBounds(w);b.width&&a.pad(b.width);let{x:d,y:f}=a,g=1/a.width,h=1/a.height,i=-d*g,j=-f*h,k=e.a,l=e.b,m=e.c,n=e.d;e.a*=g,e.b*=g,e.c*=h,e.d*=h,e.tx=i*k+j*m+e.tx,e.ty=i*l+j*n+e.ty}else e.translate(b.texture.frame.x,b.texture.frame.y),e.scale(1/b.texture.source.width,1/b.texture.source.height);let f=b.texture.source.style;return b.fill instanceof u.FillGradient||"clamp-to-edge"!==f.addressMode||(f.addressMode="repeat",f.update()),d&&e.append(v.copyFrom(d).invert()),e}a.s(["generateTextureMatrix",()=>x],45914);var y=a.i(8300);let z={};b.extensions.handleByMap(b.ExtensionType.ShapeBuilder,z),b.extensions.add(s.buildRectangle,r.buildPolygon,t.buildTriangle,o.buildCircle,o.buildEllipse,o.buildRoundedRectangle);let A=new j.Rectangle,B=new i.Matrix;function C(a,b){let{geometryData:c,batches:d}=b;d.length=0,c.indices.length=0,c.vertices.length=0,c.uvs.length=0;for(let b=0;b<a.instructions.length;b++){let e=a.instructions[b];if("texture"===e.action)!function(a,b,c){let d=[],e=z.rectangle;A.x=a.dx,A.y=a.dy,A.width=a.dw,A.height=a.dh;let f=a.transform;if(!e.build(A,d))return;let{vertices:g,uvs:i,indices:j}=c,k=j.length,m=g.length/2;f&&(0,l.transformVertices)(d,f),e.triangulate(d,g,2,m,j,k);let o=a.image,p=o.uvs;i.push(p.x0,p.y0,p.x1,p.y1,p.x3,p.y3,p.x2,p.y2);let q=h.BigPool.get(n.BatchableGraphics);q.indexOffset=k,q.indexSize=j.length-k,q.attributeOffset=m,q.attributeSize=g.length/2-m,q.baseColor=a.style,q.alpha=a.alpha,q.texture=o,q.geometryData=c,b.push(q)}(e.data,d,c);else if("fill"===e.action||"stroke"===e.action){let a="stroke"===e.action,b=e.data.path.shapePath,f=e.data.style,g=e.data.hole;a&&g&&D(g.shapePath,f,!0,d,c),g&&(b.shapePrimitives[b.shapePrimitives.length-1].holes=g.shapePath.shapePrimitives),D(b,f,a,d,c)}}}function D(a,b,c,d,e){let{vertices:f,uvs:g,indices:i}=e;a.shapePrimitives.forEach(({shape:a,transform:j,holes:o})=>{let r=[],s=z[a.type];if(!s.build(a,r))return;let t=i.length,u=f.length/2,v="triangle-list";if(j&&(0,l.transformVertices)(r,j),c){let c=a.closePath??!0;b.pixelLine?((0,q.buildPixelLine)(r,c,f,i),v="line-list"):(0,p.buildLine)(r,b,!1,c,f,i)}else if(o){let a=[],b=r.slice();(function(a){let b=[];for(let c=0;c<a.length;c++){let d=a[c].shape,e=[];z[d.type].build(d,e)&&b.push(e)}return b})(o).forEach(c=>{a.push(b.length/2),b.push(...c)}),(0,y.triangulateWithHoles)(b,a,f,2,u,i,t)}else s.triangulate(r,f,2,u,i,t);let w=g.length/2,A=b.texture;if(A!==m.Texture.WHITE){let c=x(B,b,a,j);(0,k.buildUvs)(f,2,u,g,w,2,f.length/2-u,c)}else(0,k.buildSimpleUvs)(g,w,2,f.length/2-u);let C=h.BigPool.get(n.BatchableGraphics);C.indexOffset=t,C.indexSize=i.length-t,C.attributeOffset=u,C.attributeSize=f.length/2-u,C.baseColor=b.color,C.alpha=b.alpha,C.texture=A,C.geometryData=e,C.topology=v,d.push(C)})}a.s(["buildContextBatches",()=>C,"shapeBuilders",()=>z],43817);class E{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}reset(){this.batches&&this.batches.forEach(a=>{h.BigPool.return(a)}),this.graphicsData&&h.BigPool.return(this.graphicsData),this.isBatchable=!1,this.context=null,this.batches.length=0,this.geometryData.indices.length=0,this.geometryData.vertices.length=0,this.geometryData.uvs.length=0,this.graphicsData=null}destroy(){this.reset(),this.batches=null,this.geometryData=null}}class F{constructor(){this.instructions=new e.InstructionSet}init(a){let b=a.maxTextures;this.batcher?this.batcher._updateMaxTextures(b):this.batcher=new d.DefaultBatcher({maxTextures:b}),this.instructions.reset()}get geometry(){return(0,g.deprecation)(g.v8_3_4,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}destroy(){this.batcher.destroy(),this.instructions.destroy(),this.batcher=null,this.instructions=null}}let G=class a{constructor(a){this._renderer=a,this._managedContexts=new f.GCManagedHash({renderer:a,type:"resource",name:"graphicsContext"})}init(b){a.defaultOptions.bezierSmoothness=b?.bezierSmoothness??a.defaultOptions.bezierSmoothness}getContextRenderData(a){return a._gpuData[this._renderer.uid].graphicsData||this._initContextRenderData(a)}updateGpuContext(a){let b=!!a._gpuData[this._renderer.uid],c=a._gpuData[this._renderer.uid]||this._initContext(a);if(a.dirty||!b){b&&c.reset(),C(a,c);let d=a.batchMode;a.customShader||"no-batch"===d?c.isBatchable=!1:"auto"===d?c.isBatchable=c.geometryData.vertices.length<400:c.isBatchable=!0,a.dirty=!1}return c}getGpuContext(a){return a._gpuData[this._renderer.uid]||this._initContext(a)}_initContextRenderData(a){let b=h.BigPool.get(F,{maxTextures:this._renderer.limits.maxBatchableTextures}),d=a._gpuData[this._renderer.uid],{batches:e,geometryData:f}=d;d.graphicsData=b;let g=f.vertices.length,i=f.indices.length;for(let a=0;a<e.length;a++)e[a].applyTransform=!1;let j=b.batcher;j.ensureAttributeBuffer(g),j.ensureIndexBuffer(i),j.begin();for(let a=0;a<e.length;a++){let b=e[a];j.add(b)}j.finish(b.instructions);let k=j.geometry;k.indexBuffer.setDataWithSize(j.indexBuffer,j.indexSize,!0),k.buffers[0].setDataWithSize(j.attributeBuffer.float32View,j.attributeSize,!0);let l=j.batches;for(let a=0;a<l.length;a++){let b=l[a];b.bindGroup=(0,c.getTextureBatchBindGroup)(b.textures.textures,b.textures.count,this._renderer.limits.maxBatchableTextures)}return b}_initContext(a){let b=new E;return b.context=a,a._gpuData[this._renderer.uid]=b,this._managedContexts.add(a),b}destroy(){this._managedContexts.destroy(),this._renderer=null}};G.extension={type:[b.ExtensionType.WebGLSystem,b.ExtensionType.WebGPUSystem,b.ExtensionType.CanvasSystem],name:"graphicsContext"},G.defaultOptions={bezierSmoothness:.5},a.s(["GpuGraphicsContext",()=>E,"GraphicsContextRenderData",()=>F,"GraphicsContextSystem",()=>G],68667)},74165,a=>{"use strict";var b=a.i(44373),c=a.i(45287),d=a.i(46629),e=a.i(3832),f=a.i(12874),g=a.i(48957);class h{constructor(){this.batches=[],this.batched=!1}destroy(){this.batches.forEach(a=>{e.BigPool.return(a)}),this.batches.length=0}}class i{constructor(a,b){this.state=c.State.for2d(),this.renderer=a,this._adaptor=b,this.renderer.runners.contextChange.add(this),this._managedGraphics=new d.GCManagedHash({renderer:a,type:"renderable",priority:-1,name:"graphics"})}contextChange(){this._adaptor.contextChange(this.renderer)}validateRenderable(a){let b=a.context,c=!!a._gpuData,d=this.renderer.graphicsContext.updateGpuContext(b);return!!d.isBatchable||c!==d.isBatchable}addRenderable(a,b){let c=this.renderer.graphicsContext.updateGpuContext(a.context);a.didViewUpdate&&this._rebuild(a),c.isBatchable?this._addToBatcher(a,b):(this.renderer.renderPipes.batch.break(b),b.add(a))}updateRenderable(a){let b=this._getGpuDataForRenderable(a).batches;for(let a=0;a<b.length;a++){let c=b[a];c._batcher.updateElement(c)}}execute(a){if(!a.isRenderable)return;let b=this.renderer,c=a.context;if(!b.graphicsContext.getGpuContext(c).batches.length)return;let d=c.customShader||this._adaptor.shader;this.state.blendMode=a.groupBlendMode;let e=d.resources.localUniforms.uniforms;e.uTransformMatrix=a.groupTransform,e.uRound=b._roundPixels|a._roundPixels,(0,f.color32BitToUniform)(a.groupColorAlpha,e.uColor,0),this._adaptor.execute(this,a)}_rebuild(a){let b=this._getGpuDataForRenderable(a),c=this.renderer.graphicsContext.updateGpuContext(a.context);b.destroy(),c.isBatchable&&this._updateBatchesForRenderable(a,b)}_addToBatcher(a,b){let c=this.renderer.renderPipes.batch,d=this._getGpuDataForRenderable(a).batches;for(let a=0;a<d.length;a++){let e=d[a];c.addToBatch(e,b)}}_getGpuDataForRenderable(a){return a._gpuData[this.renderer.uid]||this._initGpuDataForRenderable(a)}_initGpuDataForRenderable(a){let b=new h;return a._gpuData[this.renderer.uid]=b,this._managedGraphics.add(a),b}_updateBatchesForRenderable(a,b){let c=a.context,d=this.renderer.graphicsContext.getGpuContext(c),f=this.renderer._roundPixels|a._roundPixels;b.batches=d.batches.map(b=>{let c=e.BigPool.get(g.BatchableGraphics);return b.copyTo(c),c.renderable=a,c.roundPixels=f,c})}destroy(){this._managedGraphics.destroy(),this.renderer=null,this._adaptor.destroy(),this._adaptor=null,this.state=null}}i.extension={type:[b.ExtensionType.WebGLPipes,b.ExtensionType.WebGPUPipes,b.ExtensionType.CanvasPipes],name:"graphics"},a.s(["GraphicsGpuData",()=>h,"GraphicsPipe",()=>i])},7013,58346,48231,a=>{"use strict";var b=a.i(44373),c=a.i(67309),d=a.i(74395),e=a.i(96335),f=a.i(11276),g=a.i(12874);class h{constructor(){this.batcherName="default",this.packAsQuad=!1,this.indexOffset=0,this.attributeOffset=0,this.roundPixels=0,this._batcher=null,this._batch=null,this._textureMatrixUpdateId=-1,this._uvUpdateId=-1}get blendMode(){return this.renderable.groupBlendMode}get topology(){return this._topology||this.geometry.topology}set topology(a){this._topology=a}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.geometry=null,this._uvUpdateId=-1,this._textureMatrixUpdateId=-1}setTexture(a){this.texture!==a&&(this.texture=a,this._textureMatrixUpdateId=-1)}get uvs(){let a=this.geometry.getBuffer("aUV"),b=a.data,c=b,d=this.texture.textureMatrix;return d.isSimple||(c=this._transformedUvs,(this._textureMatrixUpdateId!==d._updateID||this._uvUpdateId!==a._updateID)&&((!c||c.length<b.length)&&(c=this._transformedUvs=new Float32Array(b.length)),this._textureMatrixUpdateId=d._updateID,this._uvUpdateId=a._updateID,d.multiplyUvs(b,c))),c}get positions(){return this.geometry.positions}get indices(){return this.geometry.indices}get color(){return this.renderable.groupColorAlpha}get groupTransform(){return this.renderable.groupTransform}get attributeSize(){return this.geometry.positions.length/2}get indexSize(){return this.geometry.indices.length}}a.s(["BatchableMesh",()=>h],58346);class i{destroy(){}}class j{constructor(a,b){this.localUniforms=new e.UniformGroup({uTransformMatrix:{value:new c.Matrix,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),this.localUniformsBindGroup=new d.BindGroup({0:this.localUniforms}),this.renderer=a,this._adaptor=b,this._adaptor.init()}validateRenderable(a){let b=this._getMeshData(a),c=b.batched,d=a.batched;if(b.batched=d,c!==d)return!0;if(d){let c=a._geometry;if(c.indices.length!==b.indexSize||c.positions.length!==b.vertexSize)return b.indexSize=c.indices.length,b.vertexSize=c.positions.length,!0;let d=this._getBatchableMesh(a);return d.texture.uid!==a._texture.uid&&(d._textureMatrixUpdateId=-1),!d._batcher.checkAndUpdateTexture(d,a._texture)}return!1}addRenderable(a,b){let c=this.renderer.renderPipes.batch,d=this._getMeshData(a);if(a.didViewUpdate&&(d.indexSize=a._geometry.indices?.length,d.vertexSize=a._geometry.positions?.length),d.batched){let d=this._getBatchableMesh(a);d.setTexture(a._texture),d.geometry=a._geometry,c.addToBatch(d,b)}else c.break(b),b.add(a)}updateRenderable(a){if(a.batched){let b=this._getBatchableMesh(a);b.setTexture(a._texture),b.geometry=a._geometry,b._batcher.updateElement(b)}}execute(a){if(!a.isRenderable)return;a.state.blendMode=(0,f.getAdjustedBlendModeBlend)(a.groupBlendMode,a.texture._source);let b=this.localUniforms;b.uniforms.uTransformMatrix=a.groupTransform,b.uniforms.uRound=this.renderer._roundPixels|a._roundPixels,b.update(),(0,g.color32BitToUniform)(a.groupColorAlpha,b.uniforms.uColor,0),this._adaptor.execute(this,a)}_getMeshData(a){var b,c;return(b=a._gpuData)[c=this.renderer.uid]||(b[c]=new i),a._gpuData[this.renderer.uid].meshData||this._initMeshData(a)}_initMeshData(a){return a._gpuData[this.renderer.uid].meshData={batched:a.batched,indexSize:0,vertexSize:0},a._gpuData[this.renderer.uid].meshData}_getBatchableMesh(a){var b,c;return(b=a._gpuData)[c=this.renderer.uid]||(b[c]=new i),a._gpuData[this.renderer.uid].batchableMesh||this._initBatchableMesh(a)}_initBatchableMesh(a){let b=new h;return b.renderable=a,b.setTexture(a._texture),b.transform=a.groupTransform,b.roundPixels=this.renderer._roundPixels|a._roundPixels,a._gpuData[this.renderer.uid].batchableMesh=b,b}destroy(){this.localUniforms=null,this.localUniformsBindGroup=null,this._adaptor.destroy(),this._adaptor=null,this.renderer=null}}j.extension={type:[b.ExtensionType.WebGLPipes,b.ExtensionType.WebGPUPipes,b.ExtensionType.CanvasPipes],name:"mesh"},a.s(["MeshGpuData",()=>i,"MeshPipe",()=>j],7013);class k{execute(a,b){let c=a.state,d=a.renderer,e=b.shader||a.defaultShader;e.resources.uTexture=b.texture._source,e.resources.uniforms=a.localUniforms;let f=d.gl,g=a.getBuffers(b);d.shader.bind(e),d.state.set(c),d.geometry.bind(g.geometry,e.glProgram);let h=2===g.geometry.indexBuffer.data.BYTES_PER_ELEMENT?f.UNSIGNED_SHORT:f.UNSIGNED_INT;f.drawElements(f.TRIANGLES,6*b.particleChildren.length,h,0)}}a.s(["GlParticleContainerAdaptor",()=>k],48231)},43947,41445,2811,a=>{"use strict";var b=a.i(42682),c=a.i(52776),d=a.i(54676),e=a.i(70770),f=a.i(29938);function g(a,b=null){let c=6*a;if(c>65535?b||(b=new Uint32Array(c)):b||(b=new Uint16Array(c)),b.length!==c)throw Error(`Out buffer length is incorrect, got ${b.length} and expected ${c}`);for(let a=0,d=0;a<c;a+=6,d+=4)b[a+0]=d+0,b[a+1]=d+1,b[a+2]=d+2,b[a+3]=d+0,b[a+4]=d+2,b[a+5]=d+3;return b}function h(a){return{dynamicUpdate:i(a,!0),staticUpdate:i(a,!1)}}function i(a,b){let c=[];c.push(`

        var index = 0;

        for (let i = 0; i < ps.length; ++i)
        {
            const p = ps[i];

            `);let d=0;for(let f in a){let g=a[f];b===g.dynamic&&(c.push(`offset = index + ${d}`),c.push(g.code),d+=(0,e.getAttributeInfoFromFormat)(g.format).stride/4)}return c.push(`
            index += stride * 4;
        }
    `),c.unshift(`
        var stride = ${d};
    `),Function("ps","f32v","u32v",c.join("\n"))}a.s(["createIndicesForQuads",()=>g],41445),a.s(["generateParticleUpdateFunction",()=>h],2811);class j{constructor(a){this._size=0,this._generateParticleUpdateCache={};const h=this._size=a.size??1e3,i=a.properties;let j=0,k=0;for(const a in i){const b=i[a],c=(0,e.getAttributeInfoFromFormat)(b.format);b.dynamic?k+=c.stride:j+=c.stride}this._dynamicStride=k/4,this._staticStride=j/4,this.staticAttributeBuffer=new f.ViewableBuffer(4*h*j),this.dynamicAttributeBuffer=new f.ViewableBuffer(4*h*k),this.indexBuffer=g(h);const l=new d.Geometry;let m=0,n=0;for(const a in this._staticBuffer=new b.Buffer({data:new Float32Array(1),label:"static-particle-buffer",shrinkToFit:!1,usage:c.BufferUsage.VERTEX|c.BufferUsage.COPY_DST}),this._dynamicBuffer=new b.Buffer({data:new Float32Array(1),label:"dynamic-particle-buffer",shrinkToFit:!1,usage:c.BufferUsage.VERTEX|c.BufferUsage.COPY_DST}),i){const b=i[a],c=(0,e.getAttributeInfoFromFormat)(b.format);b.dynamic?(l.addAttribute(b.attributeName,{buffer:this._dynamicBuffer,stride:4*this._dynamicStride,offset:4*m,format:b.format}),m+=c.size):(l.addAttribute(b.attributeName,{buffer:this._staticBuffer,stride:4*this._staticStride,offset:4*n,format:b.format}),n+=c.size)}l.addIndex(this.indexBuffer);const o=this.getParticleUpdate(i);this._dynamicUpload=o.dynamicUpdate,this._staticUpload=o.staticUpdate,this.geometry=l}getParticleUpdate(a){let b=function(a){let b=[];for(let c in a){let d=a[c];b.push(c,d.code,d.dynamic?"d":"s")}return b.join("_")}(a);return this._generateParticleUpdateCache[b]||(this._generateParticleUpdateCache[b]=this.generateParticleUpdate(a)),this._generateParticleUpdateCache[b]}generateParticleUpdate(a){return h(a)}update(a,b){a.length>this._size&&(b=!0,this._size=Math.max(a.length,1.5*this._size|0),this.staticAttributeBuffer=new f.ViewableBuffer(this._size*this._staticStride*16),this.dynamicAttributeBuffer=new f.ViewableBuffer(this._size*this._dynamicStride*16),this.indexBuffer=g(this._size),this.geometry.indexBuffer.setDataWithSize(this.indexBuffer,this.indexBuffer.byteLength,!0));let c=this.dynamicAttributeBuffer;if(this._dynamicUpload(a,c.float32View,c.uint32View),this._dynamicBuffer.setDataWithSize(this.dynamicAttributeBuffer.float32View,a.length*this._dynamicStride*4,!0),b){let b=this.staticAttributeBuffer;this._staticUpload(a,b.float32View,b.uint32View),this._staticBuffer.setDataWithSize(b.float32View,a.length*this._staticStride*4,!0)}}destroy(){this._staticBuffer.destroy(),this._dynamicBuffer.destroy(),this.geometry.destroy()}}a.s(["ParticleBuffer",()=>j],43947)},88059,85768,74573,a=>{"use strict";a.s(["default",()=>"varying vec2 vUV;\nvarying vec4 vColor;\n\nuniform sampler2D uTexture;\n\nvoid main(void){\n    vec4 color = texture2D(uTexture, vUV) * vColor;\n    gl_FragColor = color;\n}"],88059),a.s(["default",()=>"attribute vec2 aVertex;\nattribute vec2 aUV;\nattribute vec4 aColor;\n\nattribute vec2 aPosition;\nattribute float aRotation;\n\nuniform mat3 uTranslationMatrix;\nuniform float uRound;\nuniform vec2 uResolution;\nuniform vec4 uColor;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n\nvec2 roundPixels(vec2 position, vec2 targetSize)\n{       \n    return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n}\n\nvoid main(void){\n    float cosRotation = cos(aRotation);\n    float sinRotation = sin(aRotation);\n    float x = aVertex.x * cosRotation - aVertex.y * sinRotation;\n    float y = aVertex.x * sinRotation + aVertex.y * cosRotation;\n\n    vec2 v = vec2(x, y);\n    v = v + aPosition;\n\n    gl_Position = vec4((uTranslationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    if(uRound == 1.0)\n    {\n        gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n    }\n\n    vUV = aUV;\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uColor;\n}\n"],85768),a.s(["default",()=>"\nstruct ParticleUniforms {\n  uTranslationMatrix:mat3x3<f32>,\n  uColor:vec4<f32>,\n  uRound:f32,\n  uResolution:vec2<f32>,\n};\n\nfn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32>\n{\n  return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n}\n\n@group(0) @binding(0) var<uniform> uniforms: ParticleUniforms;\n\n@group(1) @binding(0) var uTexture: texture_2d<f32>;\n@group(1) @binding(1) var uSampler : sampler;\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>,\n    @location(1) color : vec4<f32>,\n  };\n@vertex\nfn mainVertex(\n  @location(0) aVertex: vec2<f32>,\n  @location(1) aPosition: vec2<f32>,\n  @location(2) aUV: vec2<f32>,\n  @location(3) aColor: vec4<f32>,\n  @location(4) aRotation: f32,\n) -> VSOutput {\n  \n   let v = vec2(\n       aVertex.x * cos(aRotation) - aVertex.y * sin(aRotation),\n       aVertex.x * sin(aRotation) + aVertex.y * cos(aRotation)\n   ) + aPosition;\n\n   var position = vec4((uniforms.uTranslationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n   if(uniforms.uRound == 1.0) {\n       position = vec4(roundPixels(position.xy, uniforms.uResolution), position.zw);\n   }\n\n    let vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uniforms.uColor;\n\n  return VSOutput(\n   position,\n   aUV,\n   vColor,\n  );\n}\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @location(1) color: vec4<f32>,\n  @builtin(position) position: vec4<f32>,\n) -> @location(0) vec4<f32> {\n\n    var sample = textureSample(uTexture, uSampler, uv) * color;\n   \n    return sample;\n}"],74573)},17215,90815,69274,a=>{"use strict";var b=a.i(44373),c=a.i(48231),d=a.i(67309),e=a.i(96335),f=a.i(11276),g=a.i(45287),h=a.i(46629),i=a.i(12874),j=a.i(43947),k=a.i(98063),l=a.i(53229),m=a.i(66722),n=a.i(56312),o=a.i(71805),p=a.i(94214),q=a.i(88059),r=a.i(85768),s=a.i(74573);class t extends n.Shader{constructor(){super({glProgram:l.GlProgram.from({vertex:r.default,fragment:q.default}),gpuProgram:m.GpuProgram.from({fragment:{source:s.default,entryPoint:"mainFragment"},vertex:{source:s.default,entryPoint:"mainVertex"}}),resources:{uTexture:o.Texture.WHITE.source,uSampler:new p.TextureStyle({}),uniforms:{uTranslationMatrix:{value:new d.Matrix,type:"mat3x3<f32>"},uColor:{value:new k.Color(0xffffff),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}}})}}a.s(["ParticleShader",()=>t],90815);class u{constructor(a,b){this.state=g.State.for2d(),this.localUniforms=new e.UniformGroup({uTranslationMatrix:{value:new d.Matrix,type:"mat3x3<f32>"},uColor:{value:new Float32Array(4),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}),this.renderer=a,this.adaptor=b,this.defaultShader=new t,this.state=g.State.for2d(),this._managedContainers=new h.GCManagedHash({renderer:a,type:"renderable",name:"particleContainer"})}validateRenderable(a){return!1}addRenderable(a,b){this.renderer.renderPipes.batch.break(b),b.add(a)}getBuffers(a){return a._gpuData[this.renderer.uid]||this._initBuffer(a)}_initBuffer(a){return a._gpuData[this.renderer.uid]=new j.ParticleBuffer({size:a.particleChildren.length,properties:a._properties}),this._managedContainers.add(a),a._gpuData[this.renderer.uid]}updateRenderable(a){}execute(a){let b=a.particleChildren;if(0===b.length)return;let c=this.renderer,d=this.getBuffers(a);a.texture||(a.texture=b[0].texture);let e=this.state;d.update(b,a._childrenDirty),a._childrenDirty=!1,e.blendMode=(0,f.getAdjustedBlendModeBlend)(a.blendMode,a.texture._source);let g=this.localUniforms.uniforms,h=g.uTranslationMatrix;a.worldTransform.copyTo(h),h.prepend(c.globalUniforms.globalUniformData.projectionMatrix),g.uResolution=c.globalUniforms.globalUniformData.resolution,g.uRound=c._roundPixels|a._roundPixels,(0,i.color32BitToUniform)(a.groupColorAlpha,g.uColor,0),this.adaptor.execute(this,a)}destroy(){this._managedContainers.destroy(),this.renderer=null,this.defaultShader&&(this.defaultShader.destroy(),this.defaultShader=null)}}a.s(["ParticleContainerPipe",()=>u],69274);class v extends u{constructor(a){super(a,new c.GlParticleContainerAdaptor)}}v.extension={type:[b.ExtensionType.WebGLPipes],name:"particle"},a.s(["GlParticleContainerPipe",()=>v],17215)},21424,a=>{"use strict";class b{execute(a,b){let c=a.renderer,d=b.shader||a.defaultShader;d.groups[0]=c.renderPipes.uniformBatch.getUniformBindGroup(a.localUniforms,!0),d.groups[1]=c.texture.getTextureBindGroup(b.texture);let e=a.state,f=a.getBuffers(b);c.encoder.draw({geometry:f.geometry,shader:b.shader||a.defaultShader,state:e,size:6*b.particleChildren.length})}}a.s(["GpuParticleContainerAdaptor",()=>b])},70098,a=>{"use strict";var b=a.i(44373),c=a.i(21424),d=a.i(69274);class e extends d.ParticleContainerPipe{constructor(a){super(a,new c.GpuParticleContainerAdaptor)}}e.extension={type:[b.ExtensionType.WebGPUPipes],name:"particle"},a.s(["GpuParticleContainerPipe",()=>e])},55937,a=>{"use strict";var b=a.i(98803);function c(a,c){let{texture:d,bounds:e}=a,f=c._style._getFinalPadding();(0,b.updateQuadBounds)(e,c._anchor,d);let g=c._anchor._x*f*2,h=c._anchor._y*f*2;e.minX-=f-g,e.minY-=f-h,e.maxX-=f-g,e.maxY-=f-h}a.s(["updateTextBounds",()=>c])},10820,7028,a=>{"use strict";var b=a.i(44373),c=a.i(46629),d=a.i(55937),e=a.i(28343);class f extends e.BatchableSprite{}a.s(["BatchableText",()=>f],7028);class g{constructor(a){this._renderer=a,a.runners.resolutionChange.add(this),this._managedTexts=new c.GCManagedHash({renderer:a,type:"renderable",onUnload:this.onTextUnload.bind(this),name:"canvasText"})}resolutionChange(){for(let a in this._managedTexts.items){let b=this._managedTexts.items[a];b?._autoResolution&&b.onViewUpdate()}}validateRenderable(a){let b=this._getGpuText(a),c=a.styleKey;return b.currentKey!==c||a._didTextUpdate}addRenderable(a,b){let c=this._getGpuText(a);if(a._didTextUpdate){let b=a._autoResolution?this._renderer.resolution:a.resolution;(c.currentKey!==a.styleKey||a.resolution!==b)&&this._updateGpuText(a),a._didTextUpdate=!1,(0,d.updateTextBounds)(c,a)}this._renderer.renderPipes.batch.addToBatch(c,b)}updateRenderable(a){let b=this._getGpuText(a);b._batcher.updateElement(b)}_updateGpuText(a){let b=this._getGpuText(a);b.texture&&this._renderer.canvasText.decreaseReferenceCount(b.currentKey),a._resolution=a._autoResolution?this._renderer.resolution:a.resolution,b.texture=this._renderer.canvasText.getManagedTexture(a),b.currentKey=a.styleKey}_getGpuText(a){return a._gpuData[this._renderer.uid]||this.initGpuText(a)}initGpuText(a){let b=new f;return b.currentKey="--",b.renderable=a,b.transform=a.groupTransform,b.bounds={minX:0,maxX:1,minY:0,maxY:0},b.roundPixels=this._renderer._roundPixels|a._roundPixels,a._gpuData[this._renderer.uid]=b,this._managedTexts.add(a),b}onTextUnload(a){let b=a._gpuData[this._renderer.uid];if(!b)return;let{canvasText:c}=this._renderer;c.getReferenceCount(b.currentKey)>0?c.decreaseReferenceCount(b.currentKey):b.texture&&c.returnTexture(b.texture)}destroy(){this._managedTexts.destroy(),this._renderer=null}}g.extension={type:[b.ExtensionType.WebGLPipes,b.ExtensionType.WebGPUPipes,b.ExtensionType.CanvasPipes],name:"text"},a.s(["CanvasTextPipe",()=>g],10820)},81716,(a,b,c)=>{b.exports=function(a){var b=[];return a.replace(e,function(a,c,e){var g,h=c.toLowerCase();for(e=(g=e.match(f))?g.map(Number):[],"m"==h&&e.length>2&&(b.push([c].concat(e.splice(0,2))),h="l",c="m"==c?"l":"L");;){if(e.length==d[h])return e.unshift(c),b.push(e);if(e.length<d[h])throw Error("malformed path data");b.push([c].concat(e.splice(0,d[h])))}}),b};var d={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},e=/([astvzqmhlc])([^astvzqmhlc]*)/ig,f=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig},89376,77851,77473,42172,35057,2638,37013,a=>{"use strict";let b,c;var d=a.i(67309),e=a.i(90423);let f={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class g{constructor(a,b){this.uid=(0,e.uid)("fillPattern"),this._tick=0,this.transform=new d.Matrix,this.texture=a,this.transform.scale(1/a.frame.width,1/a.frame.height),b&&(a.source.style.addressModeU=f[b].addressModeU,a.source.style.addressModeV=f[b].addressModeV)}setTransform(a){let b=this.texture;this.transform.copyFrom(a),this.transform.invert(),this.transform.scale(1/b.frame.width,1/b.frame.height),this._tick++}get texture(){return this._texture}set texture(a){this._texture!==a&&(this._texture=a,this._tick++)}get styleKey(){return`fill-pattern-${this.uid}-${this._tick}`}destroy(){this.texture.destroy(!0),this.texture=null}}a.s(["FillPattern",()=>g],89376);var h=a.i(81716),i=a.i(51983);function j(a,b){let c=(0,h.default)(a),d=[],e=null,f=0,g=0;for(let a=0;a<c.length;a++){let h=c[a],j=h[0];switch(j){case"M":f=h[1],g=h[2],b.moveTo(f,g);break;case"m":f+=h[1],g+=h[2],b.moveTo(f,g);break;case"H":f=h[1],b.lineTo(f,g);break;case"h":f+=h[1],b.lineTo(f,g);break;case"V":g=h[1],b.lineTo(f,g);break;case"v":g+=h[1],b.lineTo(f,g);break;case"L":f=h[1],g=h[2],b.lineTo(f,g);break;case"l":f+=h[1],g+=h[2],b.lineTo(f,g);break;case"C":f=h[5],g=h[6],b.bezierCurveTo(h[1],h[2],h[3],h[4],f,g);break;case"c":b.bezierCurveTo(f+h[1],g+h[2],f+h[3],g+h[4],f+h[5],g+h[6]),f+=h[5],g+=h[6];break;case"S":f=h[3],g=h[4],b.bezierCurveToShort(h[1],h[2],f,g);break;case"s":b.bezierCurveToShort(f+h[1],g+h[2],f+h[3],g+h[4]),f+=h[3],g+=h[4];break;case"Q":f=h[3],g=h[4],b.quadraticCurveTo(h[1],h[2],f,g);break;case"q":b.quadraticCurveTo(f+h[1],g+h[2],f+h[3],g+h[4]),f+=h[3],g+=h[4];break;case"T":f=h[1],g=h[2],b.quadraticCurveToShort(f,g);break;case"t":f+=h[1],g+=h[2],b.quadraticCurveToShort(f,g);break;case"A":f=h[6],g=h[7],b.arcToSvg(h[1],h[2],h[3],h[4],h[5],f,g);break;case"a":f+=h[6],g+=h[7],b.arcToSvg(h[1],h[2],h[3],h[4],h[5],f,g);break;case"Z":case"z":b.closePath(),d.length>0&&((e=d.pop())?(f=e.startX,g=e.startY):(f=0,g=0)),e=null;break;default:(0,i.warn)(`Unknown SVG path command: ${j}`)}"Z"!==j&&"z"!==j&&null===e&&(e={startX:f,startY:g},d.push(e))}return b}a.s(["parseSVGPath",()=>j],77851);var k=a.i(31023);class l{constructor(a=0,b=0,c=0){this.type="circle",this.x=a,this.y=b,this.radius=c}clone(){return new l(this.x,this.y,this.radius)}contains(a,b){if(this.radius<=0)return!1;let c=this.radius*this.radius,d=this.x-a,e=this.y-b;return d*=d,e*=e,d+e<=c}strokeContains(a,b,c,d=.5){if(0===this.radius)return!1;let e=this.x-a,f=this.y-b,g=this.radius,h=(1-d)*c,i=Math.sqrt(e*e+f*f);return i<=g+h&&i>g-(c-h)}getBounds(a){return a||(a=new k.Rectangle),a.x=this.x-this.radius,a.y=this.y-this.radius,a.width=2*this.radius,a.height=2*this.radius,a}copyFrom(a){return this.x=a.x,this.y=a.y,this.radius=a.radius,this}copyTo(a){return a.copyFrom(this),a}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}a.s(["Circle",()=>l],77473);class m{constructor(a=0,b=0,c=0,d=0){this.type="ellipse",this.x=a,this.y=b,this.halfWidth=c,this.halfHeight=d}clone(){return new m(this.x,this.y,this.halfWidth,this.halfHeight)}contains(a,b){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let c=(a-this.x)/this.halfWidth,d=(b-this.y)/this.halfHeight;return c*=c,d*=d,c+d<=1}strokeContains(a,b,c,d=.5){let{halfWidth:e,halfHeight:f}=this;if(e<=0||f<=0)return!1;let g=c*(1-d),h=c-g,i=e-h,j=f-h,k=e+g,l=f+g,m=a-this.x,n=b-this.y;return m*m/(i*i)+n*n/(j*j)>1&&m*m/(k*k)+n*n/(l*l)<=1}getBounds(a){return a||(a=new k.Rectangle),a.x=this.x-this.halfWidth,a.y=this.y-this.halfHeight,a.width=2*this.halfWidth,a.height=2*this.halfHeight,a}copyFrom(a){return this.x=a.x,this.y=a.y,this.halfWidth=a.halfWidth,this.halfHeight=a.halfHeight,this}copyTo(a){return a.copyFrom(this),a}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}a.s(["Ellipse",()=>m],42172);var n=a.i(2897);function o(a,b,c,d,e,f){let g,h,i=e-c,j=f-d,k=i*i+j*j,l=-1;0!==k&&(l=((a-c)*i+(b-d)*j)/k),l<0?(g=c,h=d):l>1?(g=e,h=f):(g=c+l*i,h=d+l*j);let m=a-g,n=b-h;return m*m+n*n}a.s(["squaredDistanceToLineSegment",()=>o],35057);class p{constructor(...a){this.type="polygon";let b=Array.isArray(a[0])?a[0]:a;if("number"!=typeof b[0]){const a=[];for(let c=0,d=b.length;c<d;c++)a.push(b[c].x,b[c].y);b=a}this.points=b,this.closePath=!0}isClockwise(){let a=0,b=this.points,c=b.length;for(let d=0;d<c;d+=2){let e=b[d],f=b[d+1];a+=(b[(d+2)%c]-e)*(b[(d+3)%c]+f)}return a<0}containsPolygon(a){let d=this.getBounds(b),e=a.getBounds(c);if(!d.containsRect(e))return!1;let f=a.points;for(let a=0;a<f.length;a+=2){let b=f[a],c=f[a+1];if(!this.contains(b,c))return!1}return!0}clone(){let a=new p(this.points.slice());return a.closePath=this.closePath,a}contains(a,b){let c=!1,d=this.points.length/2;for(let e=0,f=d-1;e<d;f=e++){let d=this.points[2*e],g=this.points[2*e+1],h=this.points[2*f],i=this.points[2*f+1];g>b!=i>b&&a<(b-g)/(i-g)*(h-d)+d&&(c=!c)}return c}strokeContains(a,b,c,d=.5){let e=c*c,f=e*(1-d),g=e-f,{points:h}=this,i=h.length-2*!this.closePath;for(let c=0;c<i;c+=2){let d=h[c],e=h[c+1],i=h[(c+2)%h.length],j=h[(c+3)%h.length];if(o(a,b,d,e,i,j)<=(0>Math.sign((i-d)*(b-e)-(j-e)*(a-d))?g:f))return!0}return!1}getBounds(a){a||(a=new k.Rectangle);let b=this.points,c=1/0,d=-1/0,e=1/0,f=-1/0;for(let a=0,g=b.length;a<g;a+=2){let g=b[a],h=b[a+1];c=g<c?g:c,d=g>d?g:d,e=h<e?h:e,f=h>f?h:f}return a.x=c,a.width=d-c,a.y=e,a.height=f-e,a}copyFrom(a){return this.points=a.points.slice(),this.closePath=a.closePath,this}copyTo(a){return a.copyFrom(this),a}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((a,b)=>`${a}, ${b}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return(0,n.deprecation)("8.11.0","Polygon.lastX is deprecated, please use Polygon.lastX instead."),this.points[this.points.length-2]}get y(){return(0,n.deprecation)("8.11.0","Polygon.y is deprecated, please use Polygon.lastY instead."),this.points[this.points.length-1]}get startX(){return this.points[0]}get startY(){return this.points[1]}}a.s(["Polygon",()=>p],2638);let q=(a,b,c,d,e,f,g)=>{let h=a-c,i=b-d,j=Math.sqrt(h*h+i*i);return j>=e-f&&j<=e+g};class r{constructor(a=0,b=0,c=0,d=0,e=20){this.type="roundedRectangle",this.x=a,this.y=b,this.width=c,this.height=d,this.radius=e}getBounds(a){return a||(a=new k.Rectangle),a.x=this.x,a.y=this.y,a.width=this.width,a.height=this.height,a}clone(){return new r(this.x,this.y,this.width,this.height,this.radius)}copyFrom(a){return this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height,this}copyTo(a){return a.copyFrom(this),a}contains(a,b){if(this.width<=0||this.height<=0)return!1;if(a>=this.x&&a<=this.x+this.width&&b>=this.y&&b<=this.y+this.height){let c=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(b>=this.y+c&&b<=this.y+this.height-c||a>=this.x+c&&a<=this.x+this.width-c)return!0;let d=a-(this.x+c),e=b-(this.y+c),f=c*c;if(d*d+e*e<=f||(d=a-(this.x+this.width-c))*d+e*e<=f||d*d+(e=b-(this.y+this.height-c))*e<=f||(d=a-(this.x+c))*d+e*e<=f)return!0}return!1}strokeContains(a,b,c,d=.5){let{x:e,y:f,width:g,height:h,radius:i}=this,j=c*(1-d),k=c-j,l=e+i,m=f+i,n=g-2*i,o=h-2*i,p=e+g,r=f+h;return(a>=e-j&&a<=e+k||a>=p-k&&a<=p+j)&&b>=m&&b<=m+o||(b>=f-j&&b<=f+k||b>=r-k&&b<=r+j)&&a>=l&&a<=l+n||a<l&&b<m&&q(a,b,l,m,i,k,j)||a>p-i&&b<m&&q(a,b,p-i,m,i,k,j)||a>p-i&&b>r-i&&q(a,b,p-i,r-i,i,k,j)||a<l&&b>r-i&&q(a,b,l,r-i,i,k,j)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}a.s(["RoundedRectangle",()=>r],37013)},25974,75508,20743,69358,33081,59038,83005,55286,10586,2395,72128,3669,75128,85550,11419,35611,52820,96781,a=>{"use strict";var b=a.i(61607),c=a.i(98063),d=a.i(90423),e=a.i(2897),f=a.i(51983),g=a.i(13753),h=a.i(89376),i=b,j=a.i(67309),k=a.i(47790),l=a.i(71805),m=a.i(83813),n=a.i(77851),o=a.i(77473),p=a.i(42172),q=a.i(2638),r=a.i(31023),s=a.i(37013),t=a.i(68667);function u(a,b,c,d,e,f,g,h,i,j){var k,l,m;let n=(1-Math.min(.99,Math.max(0,j??t.GraphicsContextSystem.defaultOptions.bezierSmoothness)))/1;return n*=n,function a(b,c,d,e,f,g,h,i,j,k,l){if(l>8)return;let m=(b+d)/2,n=(c+e)/2,o=(d+f)/2,p=(e+g)/2,q=(f+h)/2,r=(g+i)/2,s=(m+o)/2,t=(n+p)/2,u=(o+q)/2,v=(p+r)/2,w=(s+u)/2,x=(t+v)/2;if(l>0){let a=h-b,l=i-c,m=Math.abs((d-h)*l-(e-i)*a),n=Math.abs((f-h)*l-(g-i)*a);if(m>11920929e-14&&n>11920929e-14){if((m+n)*(m+n)<=k*(a*a+l*l))return void j.push(w,x)}else if(m>11920929e-14){if(m*m<=k*(a*a+l*l))return void j.push(w,x)}else if(n>11920929e-14){if(n*n<=k*(a*a+l*l))return void j.push(w,x)}else if((a=w-(b+h)/2)*a+(l=x-(c+i)/2)*l<=k)return void j.push(w,x)}a(b,c,m,n,s,t,w,x,j,k,l+1),a(w,x,u,v,q,r,h,i,j,k,l+1)}(b,c,d,e,f,g,k=h,l=i,m=a,n,0),m.push(k,l),a}function v(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o;let p=(1-Math.min(.99,Math.max(0,h??t.GraphicsContextSystem.defaultOptions.bezierSmoothness)))/1;return p*=p,i=b,j=c,k=d,l=e,m=f,n=g,function a(b,c,d,e,f,g,h,i,j){if(j>8)return;let k=(c+e)/2,l=(d+f)/2,m=(e+g)/2,n=(f+h)/2,o=(k+m)/2,p=(l+n)/2,q=g-c,r=h-d,s=Math.abs((e-g)*r-(f-h)*q);if(s>11920929e-14){if(s*s<=i*(q*q+r*r))return void b.push(o,p)}else if((q=o-(c+g)/2)*q+(r=p-(d+h)/2)*r<=i)return void b.push(o,p);a(b,c,d,k,l,o,p,i,j+1),a(b,o,p,m,n,g,h,i,j+1)}(o=a,i,j,k,l,m,n,p,0),o.push(m,n),a}function w(a,b,c,d,e,f,g,h){let i=Math.abs(e-f);!g&&e>f?i=2*Math.PI-i:g&&f>e&&(i=2*Math.PI-i),h||(h=Math.max(6,Math.floor(6*Math.pow(d,1/3)*(i/Math.PI))));let j=i/(h=Math.max(h,3)),k=e;j*=g?-1:1;for(let e=0;e<h+1;e++){let e=b+Math.cos(k)*d,f=c+Math.sin(k)*d;a.push(e,f),k+=j}}function x(a,b,c,d,e,f){let g=a[a.length-2],h=a[a.length-1]-c,i=g-b,j=e-c,k=d-b,l=Math.abs(h*k-i*j);if(l<1e-8||0===f){(a[a.length-2]!==b||a[a.length-1]!==c)&&a.push(b,c);return}let m=h*h+i*i,n=j*j+k*k,o=h*j+i*k,p=f*Math.sqrt(m)/l,q=f*Math.sqrt(n)/l,r=p*o/m,s=q*o/n,t=p*k+q*i,u=p*j+q*h,v=Math.atan2(h*(q+r)-u,i*(q+r)-t),x=Math.atan2(j*(p+s)-u,k*(p+s)-t);w(a,t+b,u+c,f,v,x,i*j>k*h)}a.s(["buildAdaptiveBezier",()=>u],75508),a.s(["buildAdaptiveQuadratic",()=>v],20743),a.s(["buildArc",()=>w],69358),a.s(["buildArcTo",()=>x],33081);let y=2*Math.PI,z={centerX:0,centerY:0,ang1:0,ang2:0},A=({x:a,y:b},c,d,e,f,g,h,i)=>{let j=e*(a*=c)-f*(b*=d),k=f*a+e*b;return i.x=j+g,i.y=k+h,i},B=(a,b,c,d)=>{let e=a*c+b*d;return e>1&&(e=1),e<-1&&(e=-1),(a*d-b*c<0?-1:1)*Math.acos(e)};function C(a,b,c,d,e,f,g,h=0,i=0,j=0){var k,l;let m,n,o,p,q,r,s,t,v,w,x;if(0===f||0===g)return;let D=Math.sin(h*y/360),E=Math.cos(h*y/360),F=E*(b-d)/2+D*(c-e)/2,G=-D*(b-d)/2+E*(c-e)/2;if(0===F&&0===G)return;let H=Math.pow(F,2)/Math.pow(f=Math.abs(f),2)+Math.pow(G,2)/Math.pow(g=Math.abs(g),2);H>1&&(f*=Math.sqrt(H),g*=Math.sqrt(H)),k=f,l=g,m=Math.pow(k,2),n=Math.pow(l,2),o=Math.pow(F,2),(q=m*n-m*(p=Math.pow(G,2))-n*o)<0&&(q=0),q/=m*p+n*o,r=(q=Math.sqrt(q)*(i===j?-1:1))*k/l*G,s=-(q*l)/k*F,w=B(1,0,t=(F-r)/k,v=(G-s)/l),x=B(t,v,(-F-r)/k,(-G-s)/l),0===j&&x>0&&(x-=y),1===j&&x<0&&(x+=y),z.centerX=E*r-D*s+(b+d)/2,z.centerY=D*r+E*s+(c+e)/2,z.ang1=w,z.ang2=x;let{ang1:I,ang2:J}=z,{centerX:K,centerY:L}=z,M=Math.abs(J)/(y/4);1e-7>Math.abs(1-M)&&(M=1);let N=Math.max(Math.ceil(M),1);J/=N;let O=a[a.length-2],P=a[a.length-1],Q={x:0,y:0};for(let b=0;b<N;b++){let b=function(a,b){let c=-1.5707963267948966===b?-.551915024494:4/3*Math.tan(b/4),d=1.5707963267948966===b?.551915024494:c,e=Math.cos(a),f=Math.sin(a),g=Math.cos(a+b),h=Math.sin(a+b);return[{x:e-f*d,y:f+e*d},{x:g+h*d,y:h-g*d},{x:g,y:h}]}(I,J),{x:c,y:d}=A(b[0],f,g,E,D,K,L,Q),{x:e,y:h}=A(b[1],f,g,E,D,K,L,Q),{x:i,y:j}=A(b[2],f,g,E,D,K,L,Q);u(a,O,P,c,d,e,h,i,j),O=i,P=j,I+=J}}function D(a,b,c){let d=(a,b)=>{let c=b.x-a.x,d=b.y-a.y,e=Math.sqrt(c*c+d*d);return{len:e,nx:c/e,ny:d/e}},e=(b,c)=>{0===b?a.moveTo(c.x,c.y):a.lineTo(c.x,c.y)},f=b[b.length-1];for(let g=0;g<b.length;g++){let h,i=b[g%b.length],j=i.radius??c;if(j<=0){e(g,i),f=i;continue}let k=b[(g+1)%b.length],l=d(i,f),m=d(i,k);if(l.len<1e-4||m.len<1e-4){e(g,i),f=i;continue}let n=Math.asin(l.nx*m.ny-l.ny*m.nx),o=1,p=!1;l.nx*m.nx- -(l.ny*m.ny)<0?n<0?n=Math.PI+n:(n=Math.PI-n,o=-1,p=!0):n>0&&(o=-1,p=!0);let q=n/2,r=Math.abs(Math.cos(q)*j/Math.sin(q));h=r>Math.min(l.len/2,m.len/2)?Math.abs((r=Math.min(l.len/2,m.len/2))*Math.sin(q)/Math.cos(q)):j;let s=i.x+m.nx*r+-m.ny*h*o,t=i.y+m.ny*r+m.nx*h*o,u=Math.atan2(l.ny,l.nx)+Math.PI/2*o,v=Math.atan2(m.ny,m.nx)-Math.PI/2*o;0===g&&a.moveTo(s+Math.cos(u)*h,t+Math.sin(u)*h),a.arc(s,t,h,u,v,p),f=i}}function E(a,b,c,d){let e=(a,b)=>Math.sqrt((a.x-b.x)**2+(a.y-b.y)**2),f=(a,b,c)=>({x:a.x+(b.x-a.x)*c,y:a.y+(b.y-a.y)*c}),g=b.length;for(let h=0;h<g;h++){let i,j,k=b[(h+1)%g],l=k.radius??c;if(l<=0){0===h?a.moveTo(k.x,k.y):a.lineTo(k.x,k.y);continue}let m=b[h],n=b[(h+2)%g],o=e(m,k);i=o<1e-4?k:f(k,m,Math.min(o/2,l)/o);let p=e(n,k);j=p<1e-4?k:f(k,n,Math.min(p/2,l)/p),0===h?a.moveTo(i.x,i.y):a.lineTo(i.x,i.y),a.quadraticCurveTo(k.x,k.y,j.x,j.y,d)}}a.s(["buildArcToSvg",()=>C],59038),a.s(["roundedShapeArc",()=>D,"roundedShapeQuadraticCurve",()=>E],83005);let F=new r.Rectangle;class G{constructor(a){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new m.Bounds,this._graphicsPath2D=a,this.signed=a.checkForHoles}moveTo(a,b){return this.startPoly(a,b),this}lineTo(a,b){this._ensurePoly();let c=this._currentPoly.points,d=c[c.length-2],e=c[c.length-1];return(d!==a||e!==b)&&c.push(a,b),this}arc(a,b,c,d,e,f){return this._ensurePoly(!1),w(this._currentPoly.points,a,b,c,d,e,f),this}arcTo(a,b,c,d,e){return this._ensurePoly(),x(this._currentPoly.points,a,b,c,d,e),this}arcToSvg(a,b,c,d,e,f,g){return C(this._currentPoly.points,this._currentPoly.lastX,this._currentPoly.lastY,f,g,a,b,c,d,e),this}bezierCurveTo(a,b,c,d,e,f,g){this._ensurePoly();let h=this._currentPoly;return u(this._currentPoly.points,h.lastX,h.lastY,a,b,c,d,e,f,g),this}quadraticCurveTo(a,b,c,d,e){this._ensurePoly();let f=this._currentPoly;return v(this._currentPoly.points,f.lastX,f.lastY,a,b,c,d,e),this}closePath(){return this.endPoly(!0),this}addPath(a,b){this.endPoly(),b&&!b.isIdentity()&&(a=a.clone(!0)).transform(b);let c=this.shapePrimitives,d=c.length;for(let b=0;b<a.instructions.length;b++){let c=a.instructions[b];this[c.action](...c.data)}if(a.checkForHoles&&c.length-d>1){let a=null;for(let b=d;b<c.length;b++){let d=c[b];if("polygon"===d.shape.type){let e=d.shape,f=a?.shape;f&&f.containsPolygon(e)?(a.holes||(a.holes=[]),a.holes.push(d),c.copyWithin(b,b+1),c.length--,b--):a=d}}}return this}finish(a=!1){this.endPoly(a)}rect(a,b,c,d,e){return this.drawShape(new r.Rectangle(a,b,c,d),e),this}circle(a,b,c,d){return this.drawShape(new o.Circle(a,b,c),d),this}poly(a,b,c){let d=new q.Polygon(a);return d.closePath=b,this.drawShape(d,c),this}regularPoly(a,b,c,d,e=0,f){let g=-1*Math.PI/2+e,h=2*Math.PI/(d=Math.max(0|d,3)),i=[];for(let e=0;e<d;e++){let d=g-e*h;i.push(a+c*Math.cos(d),b+c*Math.sin(d))}return this.poly(i,!0,f),this}roundPoly(a,b,c,d,e,f=0,g){if(d=Math.max(0|d,3),e<=0)return this.regularPoly(a,b,c,d,f);e=Math.min(e,c*Math.sin(Math.PI/d)-.001);let h=-1*Math.PI/2+f,i=2*Math.PI/d,j=(d-2)*Math.PI/d/2;for(let f=0;f<d;f++){let d=f*i+h,k=a+c*Math.cos(d),l=b+c*Math.sin(d),m=d+Math.PI+j,n=d-Math.PI-j,o=k+e*Math.cos(m),p=l+e*Math.sin(m),q=k+e*Math.cos(n),r=l+e*Math.sin(n);0===f?this.moveTo(o,p):this.lineTo(o,p),this.quadraticCurveTo(k,l,q,r,g)}return this.closePath()}roundShape(a,b,c=!1,d){return a.length<3?this:(c?E(this,a,b,d):D(this,a,b),this.closePath())}filletRect(a,b,c,d,e){if(0===e)return this.rect(a,b,c,d);let f=Math.min(c,d)/2,g=Math.min(f,Math.max(-f,e)),h=a+c,i=b+d,j=g<0?-g:0,k=Math.abs(g);return this.moveTo(a,b+k).arcTo(a+j,b+j,a+k,b,k).lineTo(h-k,b).arcTo(h-j,b+j,h,b+k,k).lineTo(h,i-k).arcTo(h-j,i-j,a+c-k,i,k).lineTo(a+k,i).arcTo(a+j,i-j,a,i-k,k).closePath()}chamferRect(a,b,c,d,e,f){if(e<=0)return this.rect(a,b,c,d);let g=Math.min(e,Math.min(c,d)/2),h=a+c,i=b+d,j=[a+g,b,h-g,b,h,b+g,h,i-g,h-g,i,a+g,i,a,i-g,a,b+g];for(let a=j.length-1;a>=2;a-=2)j[a]===j[a-2]&&j[a-1]===j[a-3]&&j.splice(a-1,2);return this.poly(j,!0,f)}ellipse(a,b,c,d,e){return this.drawShape(new p.Ellipse(a,b,c,d),e),this}roundRect(a,b,c,d,e,f){return this.drawShape(new s.RoundedRectangle(a,b,c,d,e),f),this}drawShape(a,b){return this.endPoly(),this.shapePrimitives.push({shape:a,transform:b}),this}startPoly(a,b){let c=this._currentPoly;return c&&this.endPoly(),(c=new q.Polygon).points.push(a,b),this._currentPoly=c,this}endPoly(a=!1){let b=this._currentPoly;return b&&b.points.length>2&&(b.closePath=a,this.shapePrimitives.push({shape:b})),this._currentPoly=null,this}_ensurePoly(a=!0){if(!this._currentPoly&&(this._currentPoly=new q.Polygon,a)){let a=this.shapePrimitives[this.shapePrimitives.length-1];if(a){let b=a.shape.x,c=a.shape.y;if(a.transform&&!a.transform.isIdentity()){let d=a.transform,e=b;b=d.a*b+d.c*c+d.tx,c=d.b*e+d.d*c+d.ty}this._currentPoly.points.push(b,c)}else this._currentPoly.points.push(0,0)}}buildPath(){let a=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let b=0;b<a.instructions.length;b++){let c=a.instructions[b];this[c.action](...c.data)}this.finish()}get bounds(){let a=this._bounds;a.clear();let b=this.shapePrimitives;for(let c=0;c<b.length;c++){let d=b[c],e=d.shape.getBounds(F);d.transform?a.addRect(e,d.transform):a.addRect(e)}return a}}a.s(["ShapePath",()=>G],55286);class H{constructor(a,b=!1){this.instructions=[],this.uid=(0,d.uid)("graphicsPath"),this._dirty=!0,this.checkForHoles=b,"string"==typeof a?(0,n.parseSVGPath)(a,this):this.instructions=a?.slice()??[]}get shapePath(){return this._shapePath||(this._shapePath=new G(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(a,b){return a=a.clone(),this.instructions.push({action:"addPath",data:[a,b]}),this._dirty=!0,this}arc(...a){return this.instructions.push({action:"arc",data:a}),this._dirty=!0,this}arcTo(...a){return this.instructions.push({action:"arcTo",data:a}),this._dirty=!0,this}arcToSvg(...a){return this.instructions.push({action:"arcToSvg",data:a}),this._dirty=!0,this}bezierCurveTo(...a){return this.instructions.push({action:"bezierCurveTo",data:a}),this._dirty=!0,this}bezierCurveToShort(a,b,c,d,e){let f=this.instructions[this.instructions.length-1],g=this.getLastPoint(k.Point.shared),h=0,i=0;if(f&&"bezierCurveTo"===f.action){h=f.data[2],i=f.data[3];let a=g.x,b=g.y;h=a+(a-h),i=b+(b-i)}else h=g.x,i=g.y;return this.instructions.push({action:"bezierCurveTo",data:[h,i,a,b,c,d,e]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...a){return this.instructions.push({action:"ellipse",data:a}),this._dirty=!0,this}lineTo(...a){return this.instructions.push({action:"lineTo",data:a}),this._dirty=!0,this}moveTo(...a){return this.instructions.push({action:"moveTo",data:a}),this}quadraticCurveTo(...a){return this.instructions.push({action:"quadraticCurveTo",data:a}),this._dirty=!0,this}quadraticCurveToShort(a,b,c){let d=this.instructions[this.instructions.length-1],e=this.getLastPoint(k.Point.shared),f=0,g=0;if(d&&"quadraticCurveTo"===d.action){f=d.data[0],g=d.data[1];let a=e.x,b=e.y;f=a+(a-f),g=b+(b-g)}else f=e.x,g=e.y;return this.instructions.push({action:"quadraticCurveTo",data:[f,g,a,b,c]}),this._dirty=!0,this}rect(a,b,c,d,e){return this.instructions.push({action:"rect",data:[a,b,c,d,e]}),this._dirty=!0,this}circle(a,b,c,d){return this.instructions.push({action:"circle",data:[a,b,c,d]}),this._dirty=!0,this}roundRect(...a){return this.instructions.push({action:"roundRect",data:a}),this._dirty=!0,this}poly(...a){return this.instructions.push({action:"poly",data:a}),this._dirty=!0,this}regularPoly(...a){return this.instructions.push({action:"regularPoly",data:a}),this._dirty=!0,this}roundPoly(...a){return this.instructions.push({action:"roundPoly",data:a}),this._dirty=!0,this}roundShape(...a){return this.instructions.push({action:"roundShape",data:a}),this._dirty=!0,this}filletRect(...a){return this.instructions.push({action:"filletRect",data:a}),this._dirty=!0,this}chamferRect(...a){return this.instructions.push({action:"chamferRect",data:a}),this._dirty=!0,this}star(a,b,c,d,e,f,g){e||(e=d/2);let h=-1*Math.PI/2+f,i=2*c,j=2*Math.PI/i,k=[];for(let c=0;c<i;c++){let f=c%2?e:d,g=c*j+h;k.push(a+f*Math.cos(g),b+f*Math.sin(g))}return this.poly(k,!0,g),this}clone(a=!1){let b=new H;if(b.checkForHoles=this.checkForHoles,a)for(let a=0;a<this.instructions.length;a++){let c=this.instructions[a];b.instructions.push({action:c.action,data:c.data.slice()})}else b.instructions=this.instructions.slice();return b}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(a){if(a.isIdentity())return this;let b=a.a,c=a.b,d=a.c,e=a.d,g=a.tx,h=a.ty,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0;for(let q=0;q<this.instructions.length;q++){let r=this.instructions[q],s=r.data;switch(r.action){case"moveTo":case"lineTo":i=s[0],j=s[1],s[0]=b*i+d*j+g,s[1]=c*i+e*j+h;break;case"bezierCurveTo":k=s[0],l=s[1],m=s[2],n=s[3],i=s[4],j=s[5],s[0]=b*k+d*l+g,s[1]=c*k+e*l+h,s[2]=b*m+d*n+g,s[3]=c*m+e*n+h,s[4]=b*i+d*j+g,s[5]=c*i+e*j+h;break;case"quadraticCurveTo":k=s[0],l=s[1],i=s[2],j=s[3],s[0]=b*k+d*l+g,s[1]=c*k+e*l+h,s[2]=b*i+d*j+g,s[3]=c*i+e*j+h;break;case"arcToSvg":i=s[5],j=s[6],o=s[0],p=s[1],s[0]=b*o+d*p,s[1]=c*o+e*p,s[5]=b*i+d*j+g,s[6]=c*i+e*j+h;break;case"circle":s[4]=I(s[3],a);break;case"rect":s[4]=I(s[4],a);break;case"ellipse":s[8]=I(s[8],a);break;case"roundRect":s[5]=I(s[5],a);break;case"addPath":s[0].transform(a);break;case"poly":s[2]=I(s[2],a);break;default:(0,f.warn)("unknown transform action",r.action)}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(a){let b=this.instructions.length-1,c=this.instructions[b];if(!c)return a.x=0,a.y=0,a;for(;"closePath"===c.action;){if(--b<0)return a.x=0,a.y=0,a;c=this.instructions[b]}switch(c.action){case"moveTo":case"lineTo":a.x=c.data[0],a.y=c.data[1];break;case"quadraticCurveTo":a.x=c.data[2],a.y=c.data[3];break;case"bezierCurveTo":a.x=c.data[4],a.y=c.data[5];break;case"arc":case"arcToSvg":a.x=c.data[5],a.y=c.data[6];break;case"addPath":c.data[0].getLastPoint(a)}return a}}function I(a,b){return a?a.prepend(b):b.clone()}function J(a,b,c){let d=a.getAttribute(b);return d?Number(d):c}function K(a,b){let d=a.querySelectorAll("defs");for(let a=0;a<d.length;a++){let e=d[a];for(let a=0;a<e.children.length;a++){let d=e.children[a];switch(d.nodeName.toLowerCase()){case"lineargradient":b.defs[d.id]=function(a){let b=J(a,"x1",0),d=J(a,"y1",0),e=J(a,"x2",1),f=J(a,"y2",0),h=a.getAttribute("gradientUnits")||"objectBoundingBox",i=new g.FillGradient(b,d,e,f,"objectBoundingBox"===h?"local":"global");for(let b=0;b<a.children.length;b++){let d=a.children[b],e=J(d,"offset",0),f=c.Color.shared.setValue(d.getAttribute("stop-color")).toNumber();i.addColorStop(e,f)}return i}(d);break;case"radialgradient":b.defs[d.id]=((0,f.warn)("[SVG Parser] Radial gradients are not yet supported"),new g.FillGradient(0,0,1,0))}}}}function L(a){let b=a.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return b?b[1]:""}a.s(["GraphicsPath",()=>H],10586),a.s(["parseSVGFloatAttribute",()=>J],2395),a.s(["parseSVGDefinitions",()=>K],72128),a.s(["extractSvgUrlId",()=>L],3669);let M={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function N(a,b){let c=a.getAttribute("style"),d={},e={},f={strokeStyle:d,fillStyle:e,useFill:!1,useStroke:!1};for(let c in M){let d=a.getAttribute(c);d&&O(b,f,c,d.trim())}if(c){let a=c.split(";");for(let c=0;c<a.length;c++){let[d,e]=a[c].trim().split(":");M[d]&&O(b,f,d,e.trim())}}return{strokeStyle:f.useStroke?d:null,fillStyle:f.useFill?e:null,useFill:f.useFill,useStroke:f.useStroke}}function O(a,b,d,e){switch(d){case"stroke":if("none"!==e){if(e.startsWith("url(")){let c=L(e);b.strokeStyle.fill=a.defs[c]}else b.strokeStyle.color=c.Color.shared.setValue(e).toNumber();b.useStroke=!0}break;case"stroke-width":b.strokeStyle.width=Number(e);break;case"fill":if("none"!==e){if(e.startsWith("url(")){let c=L(e);b.fillStyle.fill=a.defs[c]}else b.fillStyle.color=c.Color.shared.setValue(e).toNumber();b.useFill=!0}break;case"fill-opacity":b.fillStyle.alpha=Number(e);break;case"stroke-opacity":b.strokeStyle.alpha=Number(e);break;case"opacity":b.fillStyle.alpha=Number(e),b.strokeStyle.alpha=Number(e)}}function P(a){if(a.length<=2)return!0;let b=a.map(a=>a.area).sort((a,b)=>b-a),[c,d]=b,e=b[b.length-1];return!(c/d>3)||!(d/e<2)}function Q(a,b=0){let c=a.instructions[b];if(!c||"fill"!==c.action)throw Error(`Expected fill instruction at index ${b}, got ${c?.action||"undefined"}`);return c.data}function R(a){return a.split(/(?=[Mm])/).filter(a=>a.trim().length>0)}function S(a){let b=a.match(/[-+]?[0-9]*\.?[0-9]+/g);if(!b||b.length<4)return 0;let c=b.map(Number),d=[],e=[];for(let a=0;a<c.length;a+=2)a+1<c.length&&(d.push(c[a]),e.push(c[a+1]));if(0===d.length||0===e.length)return 0;let f=Math.min(...d),g=Math.min(...e);return(Math.max(...d)-f)*(Math.max(...e)-g)}function T(a,b){for(let c of new H(a,!1).instructions)b.instructions.push(c)}function U(a,b){if("string"==typeof a){let b=document.createElement("div");b.innerHTML=a.trim(),a=b.querySelector("svg")}let c={context:b,defs:{},path:new H};K(a,c);let d=a.children,{fillStyle:e,strokeStyle:g}=N(a,c);for(let a=0;a<d.length;a++){let b=d[a];"defs"!==b.nodeName.toLowerCase()&&function a(b,c,d,e){let g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=b.children,{fillStyle:x,strokeStyle:y}=N(b,c);x&&d?d={...d,...x}:x&&(d=x),y&&e?e={...e,...y}:y&&(e=y);let z=!d&&!e;switch(z&&(d={color:0}),b.nodeName.toLowerCase()){case"path":{s=b.getAttribute("d");let a=b.getAttribute("fill-rule"),f=R(s),g=f.length>1;if("evenodd"===a&&g){let a=f.map(a=>({path:a,area:S(a)}));if(a.sort((a,b)=>b.area-a.area),f.length>3||!P(a))for(let b=0;b<a.length;b++){let f=a[b],g=0===b;c.context.beginPath();let h=new H(void 0,!0);T(f.path,h),c.context.path(h),g?(d&&c.context.fill(d),e&&c.context.stroke(e)):c.context.cut()}else for(let b=0;b<a.length;b++){let f=a[b],g=b%2==1;c.context.beginPath();let h=new H(void 0,!0);T(f.path,h),c.context.path(h),g?c.context.cut():(d&&c.context.fill(d),e&&c.context.stroke(e))}}else t=new H(s,!a||"evenodd"===a),c.context.path(t),d&&c.context.fill(d),e&&c.context.stroke(e);break}case"circle":m=J(b,"cx",0),n=J(b,"cy",0),o=J(b,"r",0),c.context.ellipse(m,n,o,o),d&&c.context.fill(d),e&&c.context.stroke(e);break;case"rect":g=J(b,"x",0),h=J(b,"y",0),u=J(b,"width",0),v=J(b,"height",0),p=J(b,"rx",0),q=J(b,"ry",0),p||q?c.context.roundRect(g,h,u,v,p||q):c.context.rect(g,h,u,v),d&&c.context.fill(d),e&&c.context.stroke(e);break;case"ellipse":m=J(b,"cx",0),n=J(b,"cy",0),p=J(b,"rx",0),q=J(b,"ry",0),c.context.beginPath(),c.context.ellipse(m,n,p,q),d&&c.context.fill(d),e&&c.context.stroke(e);break;case"line":i=J(b,"x1",0),j=J(b,"y1",0),k=J(b,"x2",0),l=J(b,"y2",0),c.context.beginPath(),c.context.moveTo(i,j),c.context.lineTo(k,l),e&&c.context.stroke(e);break;case"polygon":r=b.getAttribute("points").match(/-?\d+/g).map(a=>parseInt(a,10)),c.context.poly(r,!0),d&&c.context.fill(d),e&&c.context.stroke(e);break;case"polyline":r=b.getAttribute("points").match(/-?\d+/g).map(a=>parseInt(a,10)),c.context.poly(r,!1),e&&c.context.stroke(e);break;case"g":case"svg":break;default:(0,f.warn)(`[SVG parser] <${b.nodeName}> elements unsupported`)}z&&(d=null);for(let b=0;b<w.length;b++)a(w[b],c,d,e)}(b,c,e,g)}return b}function V(a){return a instanceof h.FillPattern}function W(a){return a instanceof g.FillGradient}function X(a,b,c){return a.fill=b,a.color=0xffffff,a.texture=b.texture,a.matrix=b.transform,{...c,...a}}function Y(a,b,c){return b.buildGradient(),a.fill=b,a.color=0xffffff,a.texture=b.texture,a.matrix=b.transform,a.textureSpace=b.textureSpace,{...c,...a}}function Z(a,b){let d,e;if(null==a)return null;let f={};if(c.Color.isColorLike(a)){let d;return f.color=(d=c.Color.shared.setValue(a??0)).toNumber(),f.alpha=1===d.alpha?b.alpha:d.alpha,f.texture=l.Texture.WHITE,{...b,...f}}if(a instanceof l.Texture)return f.texture=a,{...b,...f};if(V(a))return X(f,a,b);if(W(a))return Y(f,a,b);else if(a.fill&&V(a.fill))return X(a,a.fill,b);else if(a.fill&&W(a.fill))return Y(a,a.fill,b);return d={...b,...a},e=c.Color.shared.setValue(d.color),d.alpha*=e.alpha,d.color=e.toNumber(),d}function $(a,b){let{width:c,alignment:d,miterLimit:e,cap:f,join:g,pixelLine:h,...i}=b,j=Z(a,i);return j?{width:c,alignment:d,miterLimit:e,cap:f,join:g,pixelLine:h,...j}:null}a.s(["parseSVGStyle",()=>N,"styleAttributes",()=>M],75128),a.s(["checkForNestedPattern",()=>P,"getFillInstructionData",()=>Q],85550),a.s(["appendSVGPath",()=>T,"calculatePathArea",()=>S,"extractSubpaths",()=>R],11419),a.s(["SVGParser",()=>U],35611),a.s(["toFillStyle",()=>Z,"toStrokeStyle",()=>$],52820);let _=new k.Point,aa=new j.Matrix,ab=class a extends i.default{constructor(){super(...arguments),this._gpuData=Object.create(null),this.autoGarbageCollect=!0,this._gcLastUsed=-1,this.uid=(0,d.uid)("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this.destroyed=!1,this._activePath=new H,this._transform=new j.Matrix,this._fillStyle={...a.defaultFillStyle},this._strokeStyle={...a.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new m.Bounds,this._boundsDirty=!0}clone(){let b=new a;return b.batchMode=this.batchMode,b.instructions=this.instructions.slice(),b._activePath=this._activePath.clone(),b._transform=this._transform.clone(),b._fillStyle={...this._fillStyle},b._strokeStyle={...this._strokeStyle},b._stateStack=this._stateStack.slice(),b._bounds=this._bounds.clone(),b._boundsDirty=!0,b}get fillStyle(){return this._fillStyle}set fillStyle(b){this._fillStyle=Z(b,a.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(b){this._strokeStyle=$(b,a.defaultStrokeStyle)}setFillStyle(b){return this._fillStyle=Z(b,a.defaultFillStyle),this}setStrokeStyle(b){return this._strokeStyle=Z(b,a.defaultStrokeStyle),this}texture(a,b,d,e,f,g){return this.instructions.push({action:"texture",data:{image:a,dx:d||0,dy:e||0,dw:f||a.frame.width,dh:g||a.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:b?c.Color.shared.setValue(b).toNumber():0xffffff}}),this.onUpdate(),this}beginPath(){return this._activePath=new H,this}fill(b,c){let d,f=this.instructions[this.instructions.length-1];return(d=0===this._tick&&f?.action==="stroke"?f.data.path:this._activePath.clone())&&(null!=b&&(void 0!==c&&"number"==typeof b&&((0,e.deprecation)(e.v8_0_0,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),b={color:b,alpha:c}),this._fillStyle=Z(b,a.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:d}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0),this}_initNextPathLocation(){let{x:a,y:b}=this._activePath.getLastPoint(k.Point.shared);this._activePath.clear(),this._activePath.moveTo(a,b)}stroke(b){let c,d=this.instructions[this.instructions.length-1];return(c=0===this._tick&&d?.action==="fill"?d.data.path:this._activePath.clone())&&(null!=b&&(this._strokeStyle=$(b,a.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:c}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0),this}cut(){for(let a=0;a<2;a++){let b=this.instructions[this.instructions.length-1-a],c=this._activePath.clone();if(b&&("stroke"===b.action||"fill"===b.action))if(b.data.hole)b.data.hole.addPath(c);else{b.data.hole=c;break}}return this._initNextPathLocation(),this}arc(a,b,c,d,e,f){this._tick++;let g=this._transform;return this._activePath.arc(g.a*a+g.c*b+g.tx,g.b*a+g.d*b+g.ty,c,d,e,f),this}arcTo(a,b,c,d,e){this._tick++;let f=this._transform;return this._activePath.arcTo(f.a*a+f.c*b+f.tx,f.b*a+f.d*b+f.ty,f.a*c+f.c*d+f.tx,f.b*c+f.d*d+f.ty,e),this}arcToSvg(a,b,c,d,e,f,g){this._tick++;let h=this._transform;return this._activePath.arcToSvg(a,b,c,d,e,h.a*f+h.c*g+h.tx,h.b*f+h.d*g+h.ty),this}bezierCurveTo(a,b,c,d,e,f,g){this._tick++;let h=this._transform;return this._activePath.bezierCurveTo(h.a*a+h.c*b+h.tx,h.b*a+h.d*b+h.ty,h.a*c+h.c*d+h.tx,h.b*c+h.d*d+h.ty,h.a*e+h.c*f+h.tx,h.b*e+h.d*f+h.ty,g),this}closePath(){return this._tick++,this._activePath?.closePath(),this}ellipse(a,b,c,d){return this._tick++,this._activePath.ellipse(a,b,c,d,this._transform.clone()),this}circle(a,b,c){return this._tick++,this._activePath.circle(a,b,c,this._transform.clone()),this}path(a){return this._tick++,this._activePath.addPath(a,this._transform.clone()),this}lineTo(a,b){this._tick++;let c=this._transform;return this._activePath.lineTo(c.a*a+c.c*b+c.tx,c.b*a+c.d*b+c.ty),this}moveTo(a,b){this._tick++;let c=this._transform,d=this._activePath.instructions,e=c.a*a+c.c*b+c.tx,f=c.b*a+c.d*b+c.ty;return 1===d.length&&"moveTo"===d[0].action?(d[0].data[0]=e,d[0].data[1]=f):this._activePath.moveTo(e,f),this}quadraticCurveTo(a,b,c,d,e){this._tick++;let f=this._transform;return this._activePath.quadraticCurveTo(f.a*a+f.c*b+f.tx,f.b*a+f.d*b+f.ty,f.a*c+f.c*d+f.tx,f.b*c+f.d*d+f.ty,e),this}rect(a,b,c,d){return this._tick++,this._activePath.rect(a,b,c,d,this._transform.clone()),this}roundRect(a,b,c,d,e){return this._tick++,this._activePath.roundRect(a,b,c,d,e,this._transform.clone()),this}poly(a,b){return this._tick++,this._activePath.poly(a,b,this._transform.clone()),this}regularPoly(a,b,c,d,e=0,f){return this._tick++,this._activePath.regularPoly(a,b,c,d,e,f),this}roundPoly(a,b,c,d,e,f){return this._tick++,this._activePath.roundPoly(a,b,c,d,e,f),this}roundShape(a,b,c,d){return this._tick++,this._activePath.roundShape(a,b,c,d),this}filletRect(a,b,c,d,e){return this._tick++,this._activePath.filletRect(a,b,c,d,e),this}chamferRect(a,b,c,d,e,f){return this._tick++,this._activePath.chamferRect(a,b,c,d,e,f),this}star(a,b,c,d,e=0,f=0){return this._tick++,this._activePath.star(a,b,c,d,e,f,this._transform.clone()),this}svg(a){return this._tick++,U(a,this),this}restore(){let a=this._stateStack.pop();return a&&(this._transform=a.transform,this._fillStyle=a.fillStyle,this._strokeStyle=a.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(a){return this._transform.rotate(a),this}scale(a,b=a){return this._transform.scale(a,b),this}setTransform(a,b,c,d,e,f){return a instanceof j.Matrix?this._transform.set(a.a,a.b,a.c,a.d,a.tx,a.ty):this._transform.set(a,b,c,d,e,f),this}transform(a,b,c,d,e,f){return a instanceof j.Matrix?this._transform.append(a):(aa.set(a,b,c,d,e,f),this._transform.append(aa)),this}translate(a,b=a){return this._transform.translate(a,b),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this._boundsDirty=!0,this.dirty||(this.emit("update",this,16),this.dirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;this._boundsDirty=!1;let a=this._bounds;a.clear();for(let b=0;b<this.instructions.length;b++){let c=this.instructions[b],d=c.action;if("fill"===d){let b=c.data;a.addBounds(b.path.bounds)}else if("texture"===d){let b=c.data;a.addFrame(b.dx,b.dy,b.dx+b.dw,b.dy+b.dh,b.transform)}if("stroke"===d){let b=c.data,d=b.style.alignment,e=b.style.width*(1-d),f=b.path.bounds;a.addFrame(f.minX-e,f.minY-e,f.maxX+e,f.maxY+e)}}return a}containsPoint(a){if(!this.bounds.containsPoint(a.x,a.y))return!1;let b=this.instructions,c=!1;for(let d=0;d<b.length;d++){let e=b[d],f=e.data,g=f.path;if(!e.action||!g)continue;let h=f.style,i=g.shapePath.shapePrimitives;for(let b=0;b<i.length;b++){let d=i[b].shape;if(!h||!d)continue;let g=i[b].transform,j=g?g.applyInverse(a,_):a;c="fill"===e.action?d.contains(j.x,j.y):d.strokeContains(j.x,j.y,h.width,h.alignment);let k=f.hole;if(k){let a=k.shapePath?.shapePrimitives;if(a)for(let b=0;b<a.length;b++)a[b].shape.contains(j.x,j.y)&&(c=!1)}if(c)return!0}}return c}unload(){for(let a in this.emit("unload",this),this._gpuData)this._gpuData[a]?.destroy();this._gpuData=Object.create(null)}destroy(a=!1){if(!this.destroyed){if(this.destroyed=!0,this._stateStack.length=0,this._transform=null,this.unload(),this.emit("destroy",this),this.removeAllListeners(),"boolean"==typeof a?a:a?.texture){let b="boolean"==typeof a?a:a?.textureSource;this._fillStyle.texture&&(this._fillStyle.fill&&"uid"in this._fillStyle.fill?this._fillStyle.fill.destroy():this._fillStyle.texture.destroy(b)),this._strokeStyle.texture&&(this._strokeStyle.fill&&"uid"in this._strokeStyle.fill?this._strokeStyle.fill.destroy():this._strokeStyle.texture.destroy(b))}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}}};ab.defaultFillStyle={color:0xffffff,alpha:1,texture:l.Texture.WHITE,matrix:null,fill:null,textureSpace:"local"},ab.defaultStrokeStyle={width:1,color:0xffffff,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:l.Texture.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1},a.s(["GraphicsContext",()=>ab],96781);let ac=class a extends b.default{constructor(b={}){super(),this.uid=(0,d.uid)("textStyle"),this._tick=0,function(a){if("boolean"==typeof a.dropShadow&&a.dropShadow){let b=ac.defaultDropShadow;a.dropShadow={alpha:a.dropShadowAlpha??b.alpha,angle:a.dropShadowAngle??b.angle,blur:a.dropShadowBlur??b.blur,color:a.dropShadowColor??b.color,distance:a.dropShadowDistance??b.distance}}if(void 0!==a.strokeThickness){(0,e.deprecation)(e.v8_0_0,"strokeThickness is now a part of stroke");let b=a.stroke,d={};if(c.Color.isColorLike(b))d.color=b;else if(b instanceof g.FillGradient||b instanceof h.FillPattern)d.fill=b;else if(Object.hasOwnProperty.call(b,"color")||Object.hasOwnProperty.call(b,"fill"))d=b;else throw Error("Invalid stroke value.");a.stroke={...d,width:a.strokeThickness}}if(Array.isArray(a.fillGradientStops)){if((0,e.deprecation)(e.v8_0_0,"gradient fill is now a fill pattern: `new FillGradient(...)`"),!Array.isArray(a.fill)||0===a.fill.length)throw Error("Invalid fill value. Expected an array of colors for gradient fill.");a.fill.length!==a.fillGradientStops.length&&(0,f.warn)("The number of fill colors must match the number of fill gradient stops.");let b=new g.FillGradient({start:{x:0,y:0},end:{x:0,y:1},textureSpace:"local"}),d=a.fillGradientStops.slice(),h=a.fill.map(a=>c.Color.shared.setValue(a).toNumber());d.forEach((a,c)=>{b.addColorStop(a,h[c])}),a.fill={fill:b}}}(b);const i={...a.defaultTextStyle,...b};for(const a in i)this[a]=i[a];this.update(),this._tick=0}get align(){return this._align}set align(a){this._align!==a&&(this._align=a,this.update())}get breakWords(){return this._breakWords}set breakWords(a){this._breakWords!==a&&(this._breakWords=a,this.update())}get dropShadow(){return this._dropShadow}set dropShadow(b){this._dropShadow!==b&&(null!==b&&"object"==typeof b?this._dropShadow=this._createProxy({...a.defaultDropShadow,...b}):this._dropShadow=b?this._createProxy({...a.defaultDropShadow}):null,this.update())}get fontFamily(){return this._fontFamily}set fontFamily(a){this._fontFamily!==a&&(this._fontFamily=a,this.update())}get fontSize(){return this._fontSize}set fontSize(a){this._fontSize!==a&&("string"==typeof a?this._fontSize=parseInt(a,10):this._fontSize=a,this.update())}get fontStyle(){return this._fontStyle}set fontStyle(a){this._fontStyle!==a&&(this._fontStyle=a.toLowerCase(),this.update())}get fontVariant(){return this._fontVariant}set fontVariant(a){this._fontVariant!==a&&(this._fontVariant=a,this.update())}get fontWeight(){return this._fontWeight}set fontWeight(a){this._fontWeight!==a&&(this._fontWeight=a,this.update())}get leading(){return this._leading}set leading(a){this._leading!==a&&(this._leading=a,this.update())}get letterSpacing(){return this._letterSpacing}set letterSpacing(a){this._letterSpacing!==a&&(this._letterSpacing=a,this.update())}get lineHeight(){return this._lineHeight}set lineHeight(a){this._lineHeight!==a&&(this._lineHeight=a,this.update())}get padding(){return this._padding}set padding(a){this._padding!==a&&(this._padding=a,this.update())}get filters(){return this._filters}set filters(a){this._filters!==a&&(this._filters=Object.freeze(a),this.update())}get trim(){return this._trim}set trim(a){this._trim!==a&&(this._trim=a,this.update())}get textBaseline(){return this._textBaseline}set textBaseline(a){this._textBaseline!==a&&(this._textBaseline=a,this.update())}get whiteSpace(){return this._whiteSpace}set whiteSpace(a){this._whiteSpace!==a&&(this._whiteSpace=a,this.update())}get wordWrap(){return this._wordWrap}set wordWrap(a){this._wordWrap!==a&&(this._wordWrap=a,this.update())}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(a){this._wordWrapWidth!==a&&(this._wordWrapWidth=a,this.update())}get fill(){return this._originalFill}set fill(a){a!==this._originalFill&&(this._originalFill=a,this._isFillStyle(a)&&(this._originalFill=this._createProxy({...ab.defaultFillStyle,...a},()=>{this._fill=Z({...this._originalFill},ab.defaultFillStyle)})),this._fill=Z(0===a?"black":a,ab.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(a){a!==this._originalStroke&&(this._originalStroke=a,this._isFillStyle(a)&&(this._originalStroke=this._createProxy({...ab.defaultStrokeStyle,...a},()=>{this._stroke=$({...this._originalStroke},ab.defaultStrokeStyle)})),this._stroke=$(a,ab.defaultStrokeStyle),this.update())}update(){this._tick++,this.emit("update",this)}reset(){let b=a.defaultTextStyle;for(let a in b)this[a]=b[a]}get styleKey(){return`${this.uid}-${this._tick}`}clone(){return new a({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,filters:this._filters?[...this._filters]:void 0})}_getFinalPadding(){let a=0;if(this._filters)for(let b=0;b<this._filters.length;b++)a+=this._filters[b].padding;return Math.max(this._padding,a)}destroy(a=!1){if(this.removeAllListeners(),"boolean"==typeof a?a:a?.texture){let b="boolean"==typeof a?a:a?.textureSource;this._fill?.texture&&this._fill.texture.destroy(b),this._originalFill?.texture&&this._originalFill.texture.destroy(b),this._stroke?.texture&&this._stroke.texture.destroy(b),this._originalStroke?.texture&&this._originalStroke.texture.destroy(b)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(a,b){return new Proxy(a,{set:(a,c,d)=>a[c]===d||(a[c]=d,b?.(c,d),this.update(),!0)})}_isFillStyle(a){return(a??null)!==null&&!(c.Color.isColorLike(a)||a instanceof g.FillGradient||a instanceof h.FillPattern)}};ac.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5},ac.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100},a.s(["TextStyle",()=>ac],25974)},38252,a=>{"use strict";var b=a.i(36206);let c=new(a.i(83813)).Bounds;function d(a,d,e,f){c.minX=0,c.minY=0,c.maxX=a.width/f|0,c.maxY=a.height/f|0;let g=b.TexturePool.getOptimalTexture(c.width,c.height,f,!1);return g.source.uploadMethodId="image",g.source.resource=a,g.source.alphaMode="premultiply-alpha-on-upload",g.frame.width=d/f,g.frame.height=e/f,g.source.emit("update",g.source),g.updateUvs(),g}a.s(["getPo2TextureFromSource",()=>d])},4456,a=>{"use strict";var b=a.i(58422),c=a.i(48732),d=a.i(31023);let e=null,f=null;function g(a,b,c){for(let d=0,e=4*c*b;d<b;++d,e+=4)if(0!==a[e+3])return!1;return!0}function h(a,b,c,d,e){let f=4*b;for(let b=d,g=d*f+4*c;b<=e;++b,g+=f)if(0!==a[g+3])return!1;return!0}function i(...a){let j=a[0];j.canvas||(j={canvas:a[0],resolution:a[1]});let{canvas:k}=j,l=Math.min(j.resolution??1,1),m=j.width??k.width,n=j.height??k.height,o=j.output;if(e||((f=(e=b.DOMAdapter.get().createCanvas(256,128)).getContext("2d",{willReadFrequently:!0})).globalCompositeOperation="copy",f.globalAlpha=1),(e.width<m||e.height<n)&&(e.width=(0,c.nextPow2)(m),e.height=(0,c.nextPow2)(n)),!f)throw TypeError("Failed to get canvas 2D context");f.drawImage(k,0,0,m,n,0,0,m*l,n*l);let p=f.getImageData(0,0,m,n).data,q=0,r=0,s=m-1,t=n-1;for(;r<n&&g(p,m,r);)++r;if(r===n)return d.Rectangle.EMPTY;for(;g(p,m,t);)--t;for(;h(p,m,q,r,t);)++q;for(;h(p,m,s,r,t);)--s;return++s,++t,f.globalCompositeOperation="source-over",f.strokeRect(q,r,s-q,t-r),f.globalCompositeOperation="copy",o??(o=new d.Rectangle),o.set(q/l,r/l,(s-q)/l,(t-r)/l),o}a.s(["getCanvasBoundingBox",()=>i])},92158,24126,32631,a=>{"use strict";class b{constructor(a=0,b=0,c=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=a,this.resetTtl=c,this.size=0,this.ttl=b}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(a){if(this.has(a)){let b=this.items[a];delete this.items[a],this.size--,null!==b.prev&&(b.prev.next=b.next),null!==b.next&&(b.next.prev=b.prev),this.first===b&&(this.first=b.next),this.last===b&&(this.last=b.prev)}return this}entries(a=this.keys()){return a.map(a=>[a,this.get(a)])}evict(a=!1){if(a||this.size>0){let a=this.first;delete this.items[a.key],0==--this.size?(this.first=null,this.last=null):(this.first=a.next,this.first.prev=null)}return this}expiresAt(a){let b;return this.has(a)&&(b=this.items[a].expiry),b}get(a){let b=this.items[a];if(void 0!==b)return this.ttl>0&&b.expiry<=Date.now()?void this.delete(a):(this.moveToEnd(b),b.value)}has(a){return a in this.items}moveToEnd(a){this.last!==a&&(null!==a.prev&&(a.prev.next=a.next),null!==a.next&&(a.next.prev=a.prev),this.first===a&&(this.first=a.next),a.prev=this.last,a.next=null,null!==this.last&&(this.last.next=a),this.last=a,null===this.first&&(this.first=a))}keys(){let a=[],b=this.first;for(;null!==b;)a.push(b.key),b=b.next;return a}setWithEvicted(a,b,c=this.resetTtl){let d=null;if(this.has(a))this.set(a,b,!0,c);else{this.max>0&&this.size===this.max&&(d={...this.first},this.evict(!0));let c=this.items[a]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:a,prev:this.last,next:null,value:b};1==++this.size?this.first=c:this.last.next=c,this.last=c}return d}set(a,b,c=!1,d=this.resetTtl){let e=this.items[a];return c||void 0!==e?(e.value=b,!1===c&&d&&(e.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.moveToEnd(e)):(this.max>0&&this.size===this.max&&this.evict(!0),e=this.items[a]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:a,prev:this.last,next:null,value:b},1==++this.size?this.first=e:this.last.next=e,this.last=e),this}values(a=this.keys()){return a.map(a=>this.get(a))}}function c(a=1e3,d=0,e=!1){if(isNaN(a)||a<0)throw TypeError("Invalid max value");if(isNaN(d)||d<0)throw TypeError("Invalid ttl value");if("boolean"!=typeof e)throw TypeError("Invalid resetTtl value");return new b(a,d,e)}a.s(["lru",()=>c],24126);var d=a.i(58422);let e=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function f(a){let b="number"==typeof a.fontSize?`${a.fontSize}px`:a.fontSize,c=a.fontFamily;Array.isArray(a.fontFamily)||(c=a.fontFamily.split(","));for(let a=c.length-1;a>=0;a--){let b=c[a].trim();/([\"\'])[^\'\"]+\1/.test(b)||e.includes(b)||(b=`"${b}"`),c[a]=b}return`${a.fontStyle} ${a.fontVariant} ${a.fontWeight} ${b} ${c.join(",")}`}a.s(["fontStringFromTextStyle",()=>f],32631);let g={willReadFrequently:!0},h=class a{static get experimentalLetterSpacingSupported(){let b=a._experimentalLetterSpacingSupported;if(void 0===b){let c=d.DOMAdapter.get().getCanvasRenderingContext2D().prototype;b=a._experimentalLetterSpacingSupported="letterSpacing"in c||"textLetterSpacing"in c}return b}constructor(a,b,c,d,e,f,g,h,i){this.text=a,this.style=b,this.width=c,this.height=d,this.lines=e,this.lineWidths=f,this.lineHeight=g,this.maxLineWidth=h,this.fontProperties=i}static measureText(b=" ",c,d=a._canvas,e=c.wordWrap){let g=`${b}-${c.styleKey}-wordWrap-${e}`;if(a._measurementCache.has(g))return a._measurementCache.get(g);let h=f(c),i=a.measureFont(h);0===i.fontSize&&(i.fontSize=c.fontSize,i.ascent=c.fontSize);let j=a.__context;j.font=h;let k=(e?a._wordWrap(b,c,d):b).split(/(?:\r\n|\r|\n)/),l=Array(k.length),m=0;for(let b=0;b<k.length;b++){let d=a._measureText(k[b],c.letterSpacing,j);l[b]=d,m=Math.max(m,d)}let n=c._stroke?.width||0,o=m+n;c.dropShadow&&(o+=c.dropShadow.distance);let p=c.lineHeight||i.fontSize,q=Math.max(p,i.fontSize+n)+(k.length-1)*(p+c.leading);c.dropShadow&&(q+=c.dropShadow.distance);let r=new a(b,c,o,q,k,l,p+c.leading,m,i);return a._measurementCache.set(g,r),r}static _measureText(b,c,d){let e=!1;a.experimentalLetterSpacingSupported&&(a.experimentalLetterSpacing?(d.letterSpacing=`${c}px`,d.textLetterSpacing=`${c}px`,e=!0):(d.letterSpacing="0px",d.textLetterSpacing="0px"));let f=d.measureText(b),g=f.width,h=-f.actualBoundingBoxLeft,i=f.actualBoundingBoxRight-h;if(g>0)if(e)g-=c,i-=c;else{let d=(a.graphemeSegmenter(b).length-1)*c;g+=d,i+=d}return Math.max(g,i)}static _wordWrap(b,c,d=a._canvas){let e=d.getContext("2d",g),f=0,h="",i="",j=Object.create(null),{letterSpacing:k,whiteSpace:l}=c,m=a._collapseSpaces(l),n=a._collapseNewlines(l),o=!m,p=c.wordWrapWidth+k,q=a._tokenize(b);for(let b=0;b<q.length;b++){let d=q[b];if(a._isNewline(d)){if(!n){i+=a._addLine(h),o=!m,h="",f=0;continue}d=" "}if(m){let b=a.isBreakingSpace(d),c=a.isBreakingSpace(h[h.length-1]);if(b&&c)continue}let g=a._getFromCache(d,k,j,e);if(g>p)if(""!==h&&(i+=a._addLine(h),h="",f=0),a.canBreakWords(d,c.breakWords)){let b=a.wordWrapSplit(d);for(let g=0;g<b.length;g++){let l=b[g],m=l,n=1;for(;b[g+n];){let e=b[g+n];if(a.canBreakChars(m,e,d,g,c.breakWords))break;l+=e,m=e,n++}g+=n-1;let q=a._getFromCache(l,k,j,e);q+f>p&&(i+=a._addLine(h),o=!1,h="",f=0),h+=l,f+=q}}else{h.length>0&&(i+=a._addLine(h),h="",f=0);let c=b===q.length-1;i+=a._addLine(d,!c),o=!1,h="",f=0}else g+f>p&&(o=!1,i+=a._addLine(h),h="",f=0),(h.length>0||!a.isBreakingSpace(d)||o)&&(h+=d,f+=g)}return i+a._addLine(h,!1)}static _addLine(b,c=!0){return b=a._trimRight(b),b=c?`${b}
`:b}static _getFromCache(b,c,d,e){let f=d[b];return"number"!=typeof f&&(f=a._measureText(b,c,e)+c,d[b]=f),f}static _collapseSpaces(a){return"normal"===a||"pre-line"===a}static _collapseNewlines(a){return"normal"===a}static _trimRight(b){if("string"!=typeof b)return"";for(let c=b.length-1;c>=0;c--){let d=b[c];if(!a.isBreakingSpace(d))break;b=b.slice(0,-1)}return b}static _isNewline(b){return"string"==typeof b&&a._newlines.includes(b.charCodeAt(0))}static isBreakingSpace(b,c){return"string"==typeof b&&a._breakingSpaces.includes(b.charCodeAt(0))}static _tokenize(b){let c=[],d="";if("string"!=typeof b)return c;for(let e=0;e<b.length;e++){let f=b[e],g=b[e+1];if(a.isBreakingSpace(f,g)||a._isNewline(f)){""!==d&&(c.push(d),d=""),"\r"===f&&"\n"===g?(c.push("\r\n"),e++):c.push(f);continue}d+=f}return""!==d&&c.push(d),c}static canBreakWords(a,b){return b}static canBreakChars(a,b,c,d,e){return!0}static wordWrapSplit(b){return a.graphemeSegmenter(b)}static measureFont(b){if(a._fonts[b])return a._fonts[b];let c=a._context;c.font=b;let d=c.measureText(a.METRICS_STRING+a.BASELINE_SYMBOL),e={ascent:d.actualBoundingBoxAscent,descent:d.actualBoundingBoxDescent,fontSize:d.actualBoundingBoxAscent+d.actualBoundingBoxDescent};return a._fonts[b]=e,e}static clearMetrics(b=""){b?delete a._fonts[b]:a._fonts={}}static get _canvas(){if(!a.__canvas){let b;try{let c=new OffscreenCanvas(0,0),e=c.getContext("2d",g);if(e?.measureText)return a.__canvas=c,c;b=d.DOMAdapter.get().createCanvas()}catch(a){b=d.DOMAdapter.get().createCanvas()}b.width=b.height=10,a.__canvas=b}return a.__canvas}static get _context(){return a.__context||(a.__context=a._canvas.getContext("2d",g)),a.__context}};h.METRICS_STRING="|q",h.BASELINE_SYMBOL="M",h.BASELINE_MULTIPLIER=1.4,h.HEIGHT_MULTIPLIER=2,h.graphemeSegmenter=(()=>{if("function"==typeof Intl?.Segmenter){let a=new Intl.Segmenter;return b=>{let c=a.segment(b),d=[],e=0;for(let a of c)d[e++]=a.segment;return d}}return a=>[...a]})(),h.experimentalLetterSpacing=!1,h._fonts={},h._newlines=[10,13],h._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288],h._measurementCache=c(1e3),a.s(["CanvasTextMetrics",()=>h],92158)},98051,a=>{"use strict";var b=a.i(98063),c=a.i(67309),d=a.i(71805),e=a.i(51983),f=a.i(13753),g=a.i(89376);function h(a,i,j,k=0){if(a.texture===d.Texture.WHITE&&!a.fill)return b.Color.shared.setValue(a.color).setAlpha(a.alpha??1).toHexa();if(a.fill){if(a.fill instanceof g.FillPattern){let b=a.fill,d=i.createPattern(b.texture.source.resource,"repeat"),e=b.transform.copyTo(c.Matrix.shared);return e.scale(b.texture.frame.width,b.texture.frame.height),d.setTransform(e),d}else if(a.fill instanceof f.FillGradient){let c,d=a.fill,e="linear"===d.type,f="local"===d.textureSpace,g=1,h=1;f&&j&&(g=j.width+k,h=j.height+k);let l=!1;if(e){let{start:a,end:b}=d;c=i.createLinearGradient(a.x*g,a.y*h,b.x*g,b.y*h),l=Math.abs(b.x-a.x)<Math.abs((b.y-a.y)*.1)}else{let{center:a,innerRadius:b,outerCenter:e,outerRadius:f}=d;c=i.createRadialGradient(a.x*g,a.y*h,b*g,e.x*g,e.y*h,f*g)}if(l&&f&&j){let a=j.lineHeight/h;for(let e=0;e<j.lines.length;e++){let f=(e*j.lineHeight+k/2)/h;d.colorStops.forEach(d=>{let e=f+d.offset*a;c.addColorStop(Math.floor(1e5*e)/1e5,b.Color.shared.setValue(d.color).toHex())})}}else d.colorStops.forEach(a=>{c.addColorStop(a.offset,b.Color.shared.setValue(a.color).toHex())});return c}}else{let b=i.createPattern(a.texture.source.resource,"repeat"),d=a.matrix.copyTo(c.Matrix.shared);return d.scale(a.texture.frame.width,a.texture.frame.height),b.setTransform(d),b}return(0,e.warn)("FillStyle not recognised",a),"red"}a.s(["getCanvasFillStyle",()=>h])},37897,a=>{"use strict";var b=a.i(98063),c=a.i(31023),d=a.i(9124),e=a.i(4456),f=a.i(92158),g=a.i(32631),h=a.i(98051);let i=new c.Rectangle,j=new class{getCanvasAndContext(a){let{text:b,style:c,resolution:g=1}=a,h=c._getFinalPadding(),j=f.CanvasTextMetrics.measureText(b||" ",c),k=Math.ceil(Math.ceil(Math.max(1,j.width)+2*h)*g),l=Math.ceil(Math.ceil(Math.max(1,j.height)+2*h)*g),m=d.CanvasPool.getOptimalCanvasAndContext(k,l);this._renderTextToCanvas(b,c,h,g,m);let n=c.trim?(0,e.getCanvasBoundingBox)({canvas:m.canvas,width:k,height:l,resolution:1,output:i}):i.set(0,0,k,l);return{canvasAndContext:m,frame:n}}returnCanvasAndContext(a){d.CanvasPool.returnCanvasAndContext(a)}_renderTextToCanvas(a,c,d,e,i){let j,k,{canvas:l,context:m}=i,n=(0,g.fontStringFromTextStyle)(c),o=f.CanvasTextMetrics.measureText(a||" ",c),p=o.lines,q=o.lineHeight,r=o.lineWidths,s=o.maxLineWidth,t=o.fontProperties,u=l.height;if(m.resetTransform(),m.scale(e,e),m.textBaseline=c.textBaseline,c._stroke?.width){let a=c._stroke;m.lineWidth=a.width,m.miterLimit=a.miterLimit,m.lineJoin=a.join,m.lineCap=a.cap}m.font=n;let v=c.dropShadow?2:1;for(let a=0;a<v;++a){let f=c.dropShadow&&0===a,g=f?Math.ceil(Math.max(1,u)+2*d):0,l=g*e;if(f){m.fillStyle="black",m.strokeStyle="black";let a=c.dropShadow,d=a.color,f=a.alpha;m.shadowColor=b.Color.shared.setValue(d).setAlpha(f).toRgbaString();let g=a.blur*e,h=a.distance*e;m.shadowBlur=g,m.shadowOffsetX=Math.cos(a.angle)*h,m.shadowOffsetY=Math.sin(a.angle)*h+l}else{if(m.fillStyle=c._fill?(0,h.getCanvasFillStyle)(c._fill,m,o,2*d):null,c._stroke?.width){let a=.5*c._stroke.width+2*d;m.strokeStyle=(0,h.getCanvasFillStyle)(c._stroke,m,o,a)}m.shadowColor="black"}let n=(q-t.fontSize)/2;q-t.fontSize<0&&(n=0);let v=c._stroke?.width??0;for(let a=0;a<p.length;a++)j=v/2,k=v/2+a*q+t.ascent+n,"right"===c.align?j+=s-r[a]:"center"===c.align&&(j+=(s-r[a])/2),c._stroke?.width&&this._drawLetterSpacing(p[a],c,i,j+d,k+d-g,!0),void 0!==c._fill&&this._drawLetterSpacing(p[a],c,i,j+d,k+d-g)}}_drawLetterSpacing(a,b,c,d,e,g=!1){let{context:h}=c,i=b.letterSpacing,j=!1;if(f.CanvasTextMetrics.experimentalLetterSpacingSupported&&(f.CanvasTextMetrics.experimentalLetterSpacing?(h.letterSpacing=`${i}px`,h.textLetterSpacing=`${i}px`,j=!0):(h.letterSpacing="0px",h.textLetterSpacing="0px")),0===i||j)return void(g?h.strokeText(a,d,e):h.fillText(a,d,e));let k=d,l=f.CanvasTextMetrics.graphemeSegmenter(a),m=h.measureText(a).width,n=0;for(let a=0;a<l.length;++a){let b=l[a];g?h.strokeText(b,k,e):h.fillText(b,k,e);let c="";for(let b=a+1;b<l.length;++b)c+=l[b];k+=m-(n=h.measureText(c).width)+i,m=n}}};a.s(["CanvasTextGenerator",()=>j])},79415,a=>{"use strict";var b=a.i(44373),c=a.i(36206),d=a.i(94214),e=a.i(2897),f=a.i(25974),g=a.i(38252),h=a.i(37897);class i{constructor(a){this._activeTextures={},this._renderer=a}getTexture(a,b,c,i){"string"==typeof a&&((0,e.deprecation)("8.0.0","CanvasTextSystem.getTexture: Use object TextOptions instead of separate arguments"),a={text:a,style:c,resolution:b}),a.style instanceof f.TextStyle||(a.style=new f.TextStyle(a.style)),a.textureStyle instanceof d.TextureStyle||(a.textureStyle=new d.TextureStyle(a.textureStyle)),"string"!=typeof a.text&&(a.text=a.text.toString());let{text:j,style:k,textureStyle:l}=a,m=a.resolution??this._renderer.resolution,{frame:n,canvasAndContext:o}=h.CanvasTextGenerator.getCanvasAndContext({text:j,style:k,resolution:m}),p=(0,g.getPo2TextureFromSource)(o.canvas,n.width,n.height,m);if(l&&(p.source.style=l),k.trim&&(n.pad(k.padding),p.frame.copyFrom(n),p.frame.scale(1/m),p.updateUvs()),k.filters){let a=this._applyFilters(p,k.filters);return this.returnTexture(p),h.CanvasTextGenerator.returnCanvasAndContext(o),a}return this._renderer.texture.initSource(p._source),h.CanvasTextGenerator.returnCanvasAndContext(o),p}returnTexture(a){let b=a.source;b.resource=null,b.uploadMethodId="unknown",b.alphaMode="no-premultiply-alpha",c.TexturePool.returnTexture(a,!0)}renderTextToCanvas(){(0,e.deprecation)("8.10.0","CanvasTextSystem.renderTextToCanvas: no longer supported, use CanvasTextSystem.getTexture instead")}getManagedTexture(a){a._resolution=a._autoResolution?this._renderer.resolution:a.resolution;let b=a.styleKey;if(this._activeTextures[b])return this._increaseReferenceCount(b),this._activeTextures[b].texture;let c=this.getTexture({text:a.text,style:a.style,resolution:a._resolution,textureStyle:a.textureStyle});return this._activeTextures[b]={texture:c,usageCount:1},c}decreaseReferenceCount(a){let b=this._activeTextures[a];b.usageCount--,0===b.usageCount&&(this.returnTexture(b.texture),this._activeTextures[a]=null)}getReferenceCount(a){return this._activeTextures[a]?.usageCount??0}_increaseReferenceCount(a){this._activeTextures[a].usageCount++}_applyFilters(a,b){let c=this._renderer.renderTarget.renderTarget,d=this._renderer.filter.generateFilteredTexture({texture:a,filters:b});return this._renderer.renderTarget.bind(c,!1),d}destroy(){for(let a in this._renderer=null,this._activeTextures)this._activeTextures[a]&&this.returnTexture(this._activeTextures[a].texture);this._activeTextures=null}}i.extension={type:[b.ExtensionType.WebGLSystem,b.ExtensionType.WebGPUSystem,b.ExtensionType.CanvasSystem],name:"canvasText"},a.s(["CanvasTextSystem",()=>i])},28136,a=>{"use strict";var b=a.i(2897),c=a.i(13998),d=a.i(96781);class e extends c.ViewContainer{constructor(a){a instanceof d.GraphicsContext&&(a={context:a});const{context:b,roundPixels:c,...e}=a||{};super({label:"Graphics",...e}),this.renderPipeId="graphics",b?this.context=b:(this.context=this._ownedContext=new d.GraphicsContext,this.context.autoGarbageCollect=this.autoGarbageCollect),this.didViewUpdate=!0,this.allowChildren=!1,this.roundPixels=c??!1}set context(a){a!==this._context&&(this._context&&(this._context.off("update",this.onViewUpdate,this),this._context.off("unload",this.unload,this)),this._context=a,this._context.on("update",this.onViewUpdate,this),this._context.on("unload",this.unload,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(a){return this._context.containsPoint(a)}destroy(a){this._ownedContext&&!a?this._ownedContext.destroy(a):(!0===a||a?.context===!0)&&this._context.destroy(a),this._ownedContext=null,this._context=null,super.destroy(a)}_onTouch(a){this._gcLastUsed=a,this._context._gcLastUsed=a}_callContextMethod(a,b){return this.context[a](...b),this}setFillStyle(...a){return this._callContextMethod("setFillStyle",a)}setStrokeStyle(...a){return this._callContextMethod("setStrokeStyle",a)}fill(...a){return this._callContextMethod("fill",a)}stroke(...a){return this._callContextMethod("stroke",a)}texture(...a){return this._callContextMethod("texture",a)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...a){return this._callContextMethod("arc",a)}arcTo(...a){return this._callContextMethod("arcTo",a)}arcToSvg(...a){return this._callContextMethod("arcToSvg",a)}bezierCurveTo(...a){return this._callContextMethod("bezierCurveTo",a)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...a){return this._callContextMethod("ellipse",a)}circle(...a){return this._callContextMethod("circle",a)}path(...a){return this._callContextMethod("path",a)}lineTo(...a){return this._callContextMethod("lineTo",a)}moveTo(...a){return this._callContextMethod("moveTo",a)}quadraticCurveTo(...a){return this._callContextMethod("quadraticCurveTo",a)}rect(...a){return this._callContextMethod("rect",a)}roundRect(...a){return this._callContextMethod("roundRect",a)}poly(...a){return this._callContextMethod("poly",a)}regularPoly(...a){return this._callContextMethod("regularPoly",a)}roundPoly(...a){return this._callContextMethod("roundPoly",a)}roundShape(...a){return this._callContextMethod("roundShape",a)}filletRect(...a){return this._callContextMethod("filletRect",a)}chamferRect(...a){return this._callContextMethod("chamferRect",a)}star(...a){return this._callContextMethod("star",a)}svg(...a){return this._callContextMethod("svg",a)}restore(...a){return this._callContextMethod("restore",a)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...a){return this._callContextMethod("rotate",a)}scaleTransform(...a){return this._callContextMethod("scale",a)}setTransform(...a){return this._callContextMethod("setTransform",a)}transform(...a){return this._callContextMethod("transform",a)}translateTransform(...a){return this._callContextMethod("translate",a)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(a){this._context.fillStyle=a}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(a){this._context.strokeStyle=a}clone(a=!1){return a?new e(this._context.clone()):(this._ownedContext=null,new e(this._context))}lineStyle(a,c,d){(0,b.deprecation)(b.v8_0_0,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");let e={};return a&&(e.width=a),c&&(e.color=c),d&&(e.alpha=d),this.context.strokeStyle=e,this}beginFill(a,c){(0,b.deprecation)(b.v8_0_0,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");let d={};return void 0!==a&&(d.color=a),void 0!==c&&(d.alpha=c),this.context.fillStyle=d,this}endFill(){(0,b.deprecation)(b.v8_0_0,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();let a=this.context.strokeStyle;return(a.width!==d.GraphicsContext.defaultStrokeStyle.width||a.color!==d.GraphicsContext.defaultStrokeStyle.color||a.alpha!==d.GraphicsContext.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...a){return(0,b.deprecation)(b.v8_0_0,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",a)}drawEllipse(...a){return(0,b.deprecation)(b.v8_0_0,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",a)}drawPolygon(...a){return(0,b.deprecation)(b.v8_0_0,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",a)}drawRect(...a){return(0,b.deprecation)(b.v8_0_0,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",a)}drawRoundedRect(...a){return(0,b.deprecation)(b.v8_0_0,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",a)}drawStar(...a){return(0,b.deprecation)(b.v8_0_0,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",a)}}a.s(["Graphics",()=>e])},17101,5920,8537,a=>{"use strict";let b,c;var d=a.i(67309),e=a.i(35235),f=a.i(10232),g=a.i(28012),h=a.i(586),i=a.i(90074),j=a.i(56312),k=a.i(96335);let l={name:"local-uniform-msdf-bit",vertex:{header:`
            struct LocalUniforms {
                uColor:vec4<f32>,
                uTransformMatrix:mat3x3<f32>,
                uDistance: f32,
                uRound:f32,
            }

            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;
        `,main:`
            vColor *= localUniforms.uColor;
            modelMatrix *= localUniforms.uTransformMatrix;
        `,end:`
            if(localUniforms.uRound == 1)
            {
                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
            }
        `},fragment:{header:`
            struct LocalUniforms {
                uColor:vec4<f32>,
                uTransformMatrix:mat3x3<f32>,
                uDistance: f32
            }

            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;
         `,main:`
            outColor = vec4<f32>(calculateMSDFAlpha(outColor, localUniforms.uColor, localUniforms.uDistance));
        `}},m={name:"local-uniform-msdf-bit",vertex:{header:`
            uniform mat3 uTransformMatrix;
            uniform vec4 uColor;
            uniform float uRound;
        `,main:`
            vColor *= uColor;
            modelMatrix *= uTransformMatrix;
        `,end:`
            if(uRound == 1.)
            {
                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
            }
        `},fragment:{header:`
            uniform float uDistance;
         `,main:`
            outColor = vec4(calculateMSDFAlpha(outColor, vColor, uDistance));
        `}};a.s(["localUniformMSDFBit",()=>l,"localUniformMSDFBitGl",()=>m],5920);let n={name:"msdf-bit",fragment:{header:`
            fn calculateMSDFAlpha(msdfColor:vec4<f32>, shapeColor:vec4<f32>, distance:f32) -> f32 {

                // MSDF
                var median = msdfColor.r + msdfColor.g + msdfColor.b -
                    min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -
                    max(msdfColor.r, max(msdfColor.g, msdfColor.b));

                // SDF
                median = min(median, msdfColor.a);

                var screenPxDistance = distance * (median - 0.5);
                var alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
                if (median < 0.01) {
                    alpha = 0.0;
                } else if (median > 0.99) {
                    alpha = 1.0;
                }

                // Gamma correction for coverage-like alpha
                var luma: f32 = dot(shapeColor.rgb, vec3<f32>(0.299, 0.587, 0.114));
                var gamma: f32 = mix(1.0, 1.0 / 2.2, luma);
                var coverage: f32 = pow(shapeColor.a * alpha, gamma);

                return coverage;

            }
        `}},o={name:"msdf-bit",fragment:{header:`
            float calculateMSDFAlpha(vec4 msdfColor, vec4 shapeColor, float distance) {

                // MSDF
                float median = msdfColor.r + msdfColor.g + msdfColor.b -
                                min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -
                                max(msdfColor.r, max(msdfColor.g, msdfColor.b));

                // SDF
                median = min(median, msdfColor.a);

                float screenPxDistance = distance * (median - 0.5);
                float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);

                if (median < 0.01) {
                    alpha = 0.0;
                } else if (median > 0.99) {
                    alpha = 1.0;
                }

                // Gamma correction for coverage-like alpha
                float luma = dot(shapeColor.rgb, vec3(0.299, 0.587, 0.114));
                float gamma = mix(1.0, 1.0 / 2.2, luma);
                float coverage = pow(shapeColor.a * alpha, gamma);

                return coverage;
            }
        `}};a.s(["mSDFBit",()=>n,"mSDFBitGl",()=>o],8537);class p extends j.Shader{constructor(a){const j=new k.UniformGroup({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new d.Matrix,type:"mat3x3<f32>"},uDistance:{value:4,type:"f32"},uRound:{value:0,type:"f32"}});b??(b=(0,e.compileHighShaderGpuProgram)({name:"sdf-shader",bits:[f.colorBit,(0,g.generateTextureBatchBit)(a),l,n,h.roundPixelsBit]})),c??(c=(0,e.compileHighShaderGlProgram)({name:"sdf-shader",bits:[f.colorBitGl,(0,g.generateTextureBatchBitGl)(a),m,o,h.roundPixelsBitGl]})),super({glProgram:c,gpuProgram:b,resources:{localUniforms:j,batchSamplers:(0,i.getBatchSamplersUniformGroup)(a)}})}}a.s(["SdfShader",()=>p],17101)},434,a=>{"use strict";var b=a.i(61607),c=a.i(2897);class d extends b.default{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return(0,c.deprecation)(c.v8_0_0,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return(0,c.deprecation)(c.v8_0_0,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return(0,c.deprecation)(c.v8_0_0,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return(0,c.deprecation)(c.v8_0_0,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return(0,c.deprecation)(c.v8_0_0,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(a=!1){for(let a in this.emit("destroy",this),this.removeAllListeners(),this.chars)this.chars[a].texture?.destroy();this.chars=null,a&&(this.pages.forEach(a=>a.texture.destroy(!0)),this.pages=null)}}a.s(["AbstractBitmapFont",()=>d])},24213,24299,3117,97794,a=>{"use strict";var b=a.i(24126),c=a.i(33221),d=a.i(2897),e=a.i(51983),f=a.i(92158),g=a.i(25974),h=a.i(98063),i=a.i(31023),j=a.i(9124),k=a.i(19548),l=a.i(71805),m=a.i(94214),n=a.i(32631),o=a.i(98051),p=a.i(434);let q=class a extends p.AbstractBitmapFont{constructor(b){super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentMaxCharHeight=0,this._currentPageIndex=-1,this._skipKerning=!1;const c={...a.defaultOptions,...b};this._textureSize=c.textureSize,this._mipmap=c.mipmap;const d=c.style.clone();c.overrideFill&&(d._fill.color=0xffffff,d._fill.alpha=1,d._fill.texture=l.Texture.WHITE,d._fill.fill=null),this.applyFillAsTint=c.overrideFill;const e=d.fontSize;d.fontSize=this.baseMeasurementFontSize;const g=(0,n.fontStringFromTextStyle)(d);c.overrideSize?d._stroke&&(d._stroke.width*=this.baseRenderedFontSize/e):d.fontSize=this.baseRenderedFontSize=e,this._style=d,this._skipKerning=c.skipKerning??!1,this.resolution=c.resolution??1,this._padding=c.padding??4,c.textureStyle&&(this._textureStyle=c.textureStyle instanceof m.TextureStyle?c.textureStyle:new m.TextureStyle(c.textureStyle)),this.fontMetrics=f.CanvasTextMetrics.measureFont(g),this.lineHeight=d.lineHeight||this.fontMetrics.fontSize||d.fontSize}ensureCharacters(a){let b,c=f.CanvasTextMetrics.graphemeSegmenter(a).filter(a=>!this._currentChars.includes(a)).filter((a,b,c)=>c.indexOf(a)===b);if(!c.length)return;this._currentChars=[...this._currentChars,...c];let{canvas:d,context:e}=(b=-1===this._currentPageIndex?this._nextPage():this.pages[this._currentPageIndex]).canvasAndContext,g=b.texture.source,h=this._style,j=this._currentX,k=this._currentY,m=this._currentMaxCharHeight,n=this.baseRenderedFontSize/this.baseMeasurementFontSize,o=this._padding*n,p=!1,q=d.width/this.resolution,r=d.height/this.resolution;for(let a=0;a<c.length;a++){let b=c[a],s=f.CanvasTextMetrics.measureText(b,h,d,!1);s.lineHeight=s.height;let t=s.width*n,u=Math.ceil(("italic"===h.fontStyle?2:1)*t),v=s.height*n,w=u+2*o,x=v+2*o;if(p=!1,"\n"!==b&&"\r"!==b&&"	"!==b&&" "!==b&&(p=!0,m=Math.ceil(Math.max(x,m))),j+w>q&&(j=0,(k+=m)+(m=x)>r)){g.update();let a=this._nextPage();d=a.canvasAndContext.canvas,e=a.canvasAndContext.context,g=a.texture.source,j=0,k=0,m=0}let y=t/n-(h.dropShadow?.distance??0)-(h._stroke?.width??0);if(this.chars[b]={id:b.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:y,kerning:{}},p){this._drawGlyph(e,s,j+o,k+o,n,h);let a=g.width*n,c=g.height*n,d=new i.Rectangle(j/a*g.width,k/c*g.height,w/a*g.width,x/c*g.height);this.chars[b].texture=new l.Texture({source:g,frame:d}),j+=Math.ceil(w)}}g.update(),this._currentX=j,this._currentY=k,this._currentMaxCharHeight=m,this._skipKerning&&this._applyKerning(c,e)}get pageTextures(){return(0,d.deprecation)(d.v8_0_0,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(a,b){let c=this._measureCache;for(let d=0;d<a.length;d++){let e=a[d];for(let a=0;a<this._currentChars.length;a++){let d=this._currentChars[a],f=c[e];f||(f=c[e]=b.measureText(e).width);let g=c[d];g||(g=c[d]=b.measureText(d).width);let h=b.measureText(e+d).width,i=h-(f+g);i&&(this.chars[e].kerning[d]=i),(i=(h=b.measureText(e+d).width)-(f+g))&&(this.chars[d].kerning[e]=i)}}}_nextPage(){this._currentPageIndex++;let a=this.resolution,b=j.CanvasPool.getOptimalCanvasAndContext(this._textureSize,this._textureSize,a);this._setupContext(b.context,this._style,a);let c=a*(this.baseRenderedFontSize/this.baseMeasurementFontSize),d=new l.Texture({source:new k.ImageSource({resource:b.canvas,resolution:c,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})});this._textureStyle&&(d.source.style=this._textureStyle);let e={canvasAndContext:b,texture:d};return this.pages[this._currentPageIndex]=e,e}_setupContext(a,b,c){b.fontSize=this.baseRenderedFontSize,a.scale(c,c),a.font=(0,n.fontStringFromTextStyle)(b),b.fontSize=this.baseMeasurementFontSize,a.textBaseline=b.textBaseline;let d=b._stroke,e=d?.width??0;if(d&&(a.lineWidth=e,a.lineJoin=d.join,a.miterLimit=d.miterLimit,a.strokeStyle=(0,o.getCanvasFillStyle)(d,a)),b._fill&&(a.fillStyle=(0,o.getCanvasFillStyle)(b._fill,a)),b.dropShadow){let d=b.dropShadow,e=h.Color.shared.setValue(d.color).toArray(),f=d.blur*c,g=d.distance*c;a.shadowColor=`rgba(${255*e[0]},${255*e[1]},${255*e[2]},${d.alpha})`,a.shadowBlur=f,a.shadowOffsetX=Math.cos(d.angle)*g,a.shadowOffsetY=Math.sin(d.angle)*g}else a.shadowColor="black",a.shadowBlur=0,a.shadowOffsetX=0,a.shadowOffsetY=0}_drawGlyph(a,b,c,d,e,f){let g=b.text,h=b.fontProperties,i=f._stroke,j=(i?.width??0)*e,k=c+j/2,l=d-j/2,m=h.descent*e,n=b.lineHeight*e,o=!1;f.stroke&&j&&(o=!0,a.strokeText(g,k,l+n-m));let{shadowBlur:p,shadowOffsetX:q,shadowOffsetY:r}=a;f._fill&&(o&&(a.shadowBlur=0,a.shadowOffsetX=0,a.shadowOffsetY=0),a.fillText(g,k,l+n-m)),o&&(a.shadowBlur=p,a.shadowOffsetX=q,a.shadowOffsetY=r)}destroy(){super.destroy();for(let a=0;a<this.pages.length;a++){let{canvasAndContext:b,texture:c}=this.pages[a];j.CanvasPool.returnCanvasAndContext(b),c.destroy(!0)}this.pages=null}};function r(a,b,c,d){let e={width:0,height:0,offsetY:0,scale:b.fontSize/c.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};e.offsetY=c.baseLineOffset;let f=e.lines[0],g=null,h=!0,i={spaceWord:!1,width:0,start:0,index:0,positions:[],chars:[]},j=c.baseMeasurementFontSize/b.fontSize,k=b.letterSpacing*j,l=b.wordWrapWidth*j,m=b.lineHeight?b.lineHeight*j:c.lineHeight,n=b.wordWrap&&b.breakWords,o=a=>{let b=f.width;for(let c=0;c<i.index;c++){let d=a.positions[c];f.chars.push(a.chars[c]),f.charPositions.push(d+b)}f.width+=a.width,h=!1,i.width=0,i.index=0,i.chars.length=0},p=()=>{let a=f.chars.length-1;if(d){let b=f.chars[a];for(;" "===b;)f.width-=c.chars[b].xAdvance,b=f.chars[--a]}e.width=Math.max(e.width,f.width),f={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},h=!0,e.lines.push(f),e.height+=m},q=a=>a-k>l;for(let d=0;d<a.length+1;d++){let e,j=d===a.length;j||(e=a[d]);let l=c.chars[e]||c.chars[" "];if(/(?:\s)/.test(e)||"\r"===e||"\n"===e||j){if(!h&&b.wordWrap&&q(f.width+i.width)?p():i.start=f.width,o(i),j||f.charPositions.push(0),"\r"===e||"\n"===e)p();else if(!j){let a=l.xAdvance+(l.kerning[g]||0)+k;f.width+=a,f.spaceWidth=a,f.spacesIndex.push(f.charPositions.length),f.chars.push(e)}}else{let a=l.kerning[g]||0,b=l.xAdvance+a+k;n&&q(f.width+i.width+b)&&(o(i),p()),i.positions[i.index++]=i.width+a,i.chars.push(e),i.width+=b}g=e}return p(),"center"===b.align?function(a){for(let b=0;b<a.lines.length;b++){let c=a.lines[b],d=a.width/2-c.width/2;for(let a=0;a<c.charPositions.length;a++)c.charPositions[a]+=d}}(e):"right"===b.align?function(a){for(let b=0;b<a.lines.length;b++){let c=a.lines[b],d=a.width-c.width;for(let a=0;a<c.charPositions.length;a++)c.charPositions[a]+=d}}(e):"justify"===b.align&&function(a){let b=a.width;for(let c=0;c<a.lines.length;c++){let d=a.lines[c],e=0,f=d.spacesIndex[e++],g=0,h=d.spacesIndex.length,i=(b-d.width)/h;for(let a=0;a<d.charPositions.length;a++)a===f&&(f=d.spacesIndex[e++],g+=i),d.charPositions[a]+=g}}(e),e}function s(a){if(""===a)return[];"string"==typeof a&&(a=[a]);let b=[];for(let c=0,d=a.length;c<d;c++){let d=a[c];if(Array.isArray(d)){if(2!==d.length)throw Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${d.length}.`);if(0===d[0].length||0===d[1].length)throw Error("[BitmapFont]: Invalid character delimiter.");let a=d[0].charCodeAt(0),c=d[1].charCodeAt(0);if(c<a)throw Error("[BitmapFont]: Invalid character range.");for(let d=a;d<=c;d++)b.push(String.fromCharCode(d))}else b.push(...Array.from(d))}if(0===b.length)throw Error("[BitmapFont]: Empty set when resolving characters.");return b}q.defaultOptions={textureSize:512,style:new g.TextStyle,mipmap:!0},a.s(["DynamicBitmapFont",()=>q],24299),a.s(["getBitmapTextLayout",()=>r],3117),a.s(["resolveCharacters",()=>s],97794);let t=0,u=new class{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1,textureStyle:null},this.measureCache=(0,b.lru)(1e3)}getFont(a,b){let d=`${b.fontFamily}-bitmap`,f=!0;if(b._fill.fill&&!b._stroke?(d+=b._fill.fill.styleKey,f=!1):(b._stroke||b.dropShadow)&&(d=`${b.styleKey}-bitmap`,f=!1),!c.Cache.has(d)){let a=Object.create(b);a.lineHeight=0;let g=new q({style:a,overrideFill:f,overrideSize:!0,...this.defaultOptions});++t>50&&(0,e.warn)("BitmapText",`You have dynamically created ${t} bitmap fonts, this can be inefficient. Try pre installing your font styles using \`BitmapFont.install({name:"style1", style})\``),g.once("destroy",()=>{t--,c.Cache.remove(d)}),c.Cache.set(d,g)}let g=c.Cache.get(d);return g.ensureCharacters?.(a),g}getLayout(a,b,c=!0){let d=this.getFont(a,b),e=`${a}-${b.styleKey}-${c}`;if(this.measureCache.has(e))return this.measureCache.get(e);let g=r(f.CanvasTextMetrics.graphemeSegmenter(a),b,d,c);return this.measureCache.set(e,g),g}measureText(a,b,c=!0){return this.getLayout(a,b,c)}install(...a){let b=a[0];"string"==typeof b&&(b={name:b,style:a[1],chars:a[2]?.chars,resolution:a[2]?.resolution,padding:a[2]?.padding,skipKerning:a[2]?.skipKerning},(0,d.deprecation)(d.v8_0_0,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));let e=b?.name;if(!e)throw Error("[BitmapFontManager] Property `name` is required.");let f=(b={...this.defaultOptions,...b}).style,h=f instanceof g.TextStyle?f:new g.TextStyle(f),i=b.dynamicFill??this._canUseTintForStyle(h),j=new q({style:h,overrideFill:i,skipKerning:b.skipKerning,padding:b.padding,resolution:b.resolution,overrideSize:!1,textureStyle:b.textureStyle}),k=s(b.chars);return j.ensureCharacters(k.join("")),c.Cache.set(`${e}-bitmap`,j),j.once("destroy",()=>c.Cache.remove(`${e}-bitmap`)),j}uninstall(a){let b=`${a}-bitmap`,d=c.Cache.get(b);d&&d.destroy()}_canUseTintForStyle(a){return!a._stroke&&(!a.dropShadow||0===a.dropShadow.color)&&!a._fill.fill&&0xffffff===a._fill.color}};a.s(["BitmapFontManager",()=>u],24213)},55875,44487,a=>{"use strict";var b=a.i(33221),c=a.i(44373),d=a.i(46629),e=a.i(28136),f=a.i(92158),g=a.i(17101),h=a.i(24213),i=a.i(3117);class j extends e.Graphics{destroy(){this.context.customShader&&this.context.customShader.destroy(),super.destroy()}}class k{constructor(a){this._renderer=a,this._managedBitmapTexts=new d.GCManagedHash({renderer:a,type:"renderable",priority:-2,name:"bitmapText"})}validateRenderable(a){let b=this._getGpuBitmapText(a);return this._renderer.renderPipes.graphics.validateRenderable(b)}addRenderable(a,b){let c=this._getGpuBitmapText(a);l(a,c),a._didTextUpdate&&(a._didTextUpdate=!1,this._updateContext(a,c)),this._renderer.renderPipes.graphics.addRenderable(c,b),c.context.customShader&&this._updateDistanceField(a)}updateRenderable(a){let b=this._getGpuBitmapText(a);l(a,b),this._renderer.renderPipes.graphics.updateRenderable(b),b.context.customShader&&this._updateDistanceField(a)}_updateContext(a,b){let{context:c}=b,d=h.BitmapFontManager.getFont(a.text,a._style);c.clear(),"none"===d.distanceField.type||c.customShader||(c.customShader=new g.SdfShader(this._renderer.limits.maxBatchableTextures));let e=f.CanvasTextMetrics.graphemeSegmenter(a.text),j=a._style,k=d.baseLineOffset,l=(0,i.getBitmapTextLayout)(e,j,d,!0),m=j.padding,n=l.scale,o=l.width,p=l.height+l.offsetY;j._stroke&&(o+=j._stroke.width/n,p+=j._stroke.width/n),c.translate(-a._anchor._x*o-m,-a._anchor._y*p-m).scale(n,n);let q=d.applyFillAsTint?j._fill.color:0xffffff,r=d.fontMetrics.fontSize,s=d.lineHeight;j.lineHeight&&(r=j.fontSize/n,s=j.lineHeight/n);let t=(s-r)/2;t-d.baseLineOffset<0&&(t=0);for(let a=0;a<l.lines.length;a++){let b=l.lines[a];for(let a=0;a<b.charPositions.length;a++){let e=b.chars[a],f=d.chars[e];if(f?.texture){let d=f.texture;c.texture(d,q||"black",Math.round(b.charPositions[a]+f.xOffset),Math.round(k+f.yOffset+t),d.orig.width,d.orig.height)}}k+=s}}_getGpuBitmapText(a){return a._gpuData[this._renderer.uid]||this.initGpuText(a)}initGpuText(a){let b=new j;return a._gpuData[this._renderer.uid]=b,this._updateContext(a,b),this._managedBitmapTexts.add(a),b}_updateDistanceField(a){let c=this._getGpuBitmapText(a).context,d=a._style.fontFamily,e=b.Cache.get(`${d}-bitmap`),{a:f,b:g,c:h,d:i}=a.groupTransform,j=(Math.abs(Math.sqrt(f*f+g*g))+Math.abs(Math.sqrt(h*h+i*i)))/2,k=e.baseRenderedFontSize/a._style.fontSize,l=j*e.distanceField.range*(1/k);c.customShader.resources.localUniforms.uniforms.uDistance=l}destroy(){this._managedBitmapTexts.destroy(),this._renderer=null,this._managedBitmapTexts=null}}function l(a,b){b.groupTransform=a.groupTransform,b.groupColorAlpha=a.groupColorAlpha,b.groupColor=a.groupColor,b.groupBlendMode=a.groupBlendMode,b.globalDisplayStatus=a.globalDisplayStatus,b.groupTransform=a.groupTransform,b.localDisplayStatus=a.localDisplayStatus,b.groupAlpha=a.groupAlpha,b._roundPixels=a._roundPixels}k.extension={type:[c.ExtensionType.WebGLPipes,c.ExtensionType.WebGPUPipes,c.ExtensionType.CanvasPipes],name:"bitmapText"},a.s(["BitmapTextGraphics",()=>j,"BitmapTextPipe",()=>k],55875);var m=a.i(28343);class n extends m.BatchableSprite{constructor(){super(...arguments),this.generatingTexture=!1,this.currentKey="--"}destroy(){this.texturePromise=null,this.generatingTexture=!1,this.currentKey="--",super.destroy()}}a.s(["BatchableHTMLText",()=>n],44487)},95442,91685,a=>{"use strict";var b=a.i(44373),c=a.i(71805),d=a.i(46629),e=a.i(55937),f=a.i(44487);class g{constructor(a){this._renderer=a,a.runners.resolutionChange.add(this),this._managedTexts=new d.GCManagedHash({renderer:a,type:"renderable",onUnload:this.onTextUnload.bind(this),name:"htmlText"})}resolutionChange(){for(let a in this._managedTexts.items){let b=this._managedTexts.items[a];b?._autoResolution&&b.onViewUpdate()}}validateRenderable(a){let b=this._getGpuText(a),c=a.styleKey;return b.currentKey!==c}addRenderable(a,b){let c=this._getGpuText(a);if(a._didTextUpdate){let b=a._autoResolution?this._renderer.resolution:a.resolution;(c.currentKey!==a.styleKey||a.resolution!==b)&&this._updateGpuText(a).catch(a=>{console.error(a)}),a._didTextUpdate=!1,(0,e.updateTextBounds)(c,a)}this._renderer.renderPipes.batch.addToBatch(c,b)}updateRenderable(a){let b=this._getGpuText(a);b._batcher.updateElement(b)}async _updateGpuText(a){a._didTextUpdate=!1;let b=this._getGpuText(a);if(b.generatingTexture)return;let c=b.texturePromise;b.texturePromise=null,b.generatingTexture=!0,a._resolution=a._autoResolution?this._renderer.resolution:a.resolution;let d=this._renderer.htmlText.getTexturePromise(a);c&&(d=d.finally(()=>{this._renderer.htmlText.decreaseReferenceCount(b.currentKey),this._renderer.htmlText.returnTexturePromise(c)})),b.texturePromise=d,b.currentKey=a.styleKey,b.texture=await d;let f=a.renderGroup||a.parentRenderGroup;f&&(f.structureDidChange=!0),b.generatingTexture=!1,(0,e.updateTextBounds)(b,a)}_getGpuText(a){return a._gpuData[this._renderer.uid]||this.initGpuText(a)}initGpuText(a){let b=new f.BatchableHTMLText;return b.renderable=a,b.transform=a.groupTransform,b.texture=c.Texture.EMPTY,b.bounds={minX:0,maxX:1,minY:0,maxY:0},b.roundPixels=this._renderer._roundPixels|a._roundPixels,a._resolution=a._autoResolution?this._renderer.resolution:a.resolution,a._gpuData[this._renderer.uid]=b,this._managedTexts.add(a),b}onTextUnload(a){let b=a._gpuData[this._renderer.uid];if(!b)return;let{htmlText:c}=this._renderer;null===c.getReferenceCount(b.currentKey)?c.returnTexturePromise(b.texturePromise):c.decreaseReferenceCount(b.currentKey)}destroy(){this._managedTexts.destroy(),this._renderer=null}}g.extension={type:[b.ExtensionType.WebGLPipes,b.ExtensionType.WebGPUPipes,b.ExtensionType.CanvasPipes],name:"htmlText"},a.s(["HTMLTextPipe",()=>g],95442);var h=a.i(58422);function i(){let{userAgent:a}=h.DOMAdapter.get().getNavigator();return/^((?!chrome|android).)*safari/i.test(a)}a.s(["isSafari",()=>i],91685)},48181,a=>{"use strict";var b=a.i(58422);let c="http://www.w3.org/2000/svg",d="http://www.w3.org/1999/xhtml";class e{constructor(){this.svgRoot=document.createElementNS(c,"svg"),this.foreignObject=document.createElementNS(c,"foreignObject"),this.domElement=document.createElementNS(d,"div"),this.styleElement=document.createElementNS(d,"style");const{foreignObject:a,svgRoot:e,styleElement:f,domElement:g}=this;a.setAttribute("width","10000"),a.setAttribute("height","10000"),a.style.overflow="hidden",e.appendChild(a),a.appendChild(f),a.appendChild(g),this.image=b.DOMAdapter.get().createImage()}destroy(){this.svgRoot.remove(),this.foreignObject.remove(),this.styleElement.remove(),this.domElement.remove(),this.image.src="",this.image.remove(),this.svgRoot=null,this.foreignObject=null,this.styleElement=null,this.domElement=null,this.image=null,this.canvasAndContext=null}}a.s(["HTMLTextRenderData",()=>e])},63187,76058,86205,68859,71704,23026,99403,a=>{"use strict";function b(a,b){let c=b.fontFamily,d=[],e={},f=a.match(/font-family:([^;"\s]+)/g);function g(a){e[a]||(d.push(a),e[a]=!0)}if(Array.isArray(c))for(let a=0;a<c.length;a++)g(c[a]);else g(c);for(let a in f&&f.forEach(a=>{g(a.split(":")[1].trim())}),b.tagStyles)g(b.tagStyles[a].fontFamily);return d}a.s(["extractFontFamilies",()=>b],63187);var c=a.i(33221),d=a.i(58422);async function e(a){let b=await d.DOMAdapter.get().fetch(a),c=await b.blob(),e=new FileReader;return await new Promise((a,b)=>{e.onloadend=()=>a(e.result),e.onerror=b,e.readAsDataURL(c)})}async function f(a,b){let c=await e(b);return`@font-face {
        font-family: "${a.fontFamily}";
        font-weight: ${a.fontWeight};
        font-style: ${a.fontStyle};
        src: url('${c}');
    }`}a.s(["loadFontAsBase64",()=>e],76058),a.s(["loadFontCSS",()=>f],86205);let g=new Map;async function h(a){let b=a.filter(a=>c.Cache.has(`${a}-and-url`)).map(a=>{if(!g.has(a)){let{entries:b}=c.Cache.get(`${a}-and-url`),d=[];b.forEach(b=>{let c=b.url,e=b.faces.map(a=>({weight:a.weight,style:a.style}));d.push(...e.map(b=>f({fontWeight:b.weight,fontStyle:b.style,fontFamily:a},c)))}),g.set(a,Promise.all(d).then(a=>a.join("\n")))}return g.get(a)});return(await Promise.all(b)).join("\n")}function i(a,b,c,d,e){let{domElement:f,styleElement:g,svgRoot:h}=e;f.innerHTML=`<style>${b.cssStyle}</style><div style='padding:0;'>${a}</div>`,f.setAttribute("style",`transform: scale(${c});transform-origin: top left; display: inline-block`),g.textContent=d;let{width:i,height:j}=e.image;return h.setAttribute("width",i.toString()),h.setAttribute("height",j.toString()),new XMLSerializer().serializeToString(h)}a.s(["FontStylePromiseCache",()=>g,"getFontCss",()=>h],68859),a.s(["getSVGUrl",()=>i],71704);var j=a.i(9124);function k(a,b){let c=j.CanvasPool.getOptimalCanvasAndContext(a.width,a.height,b),{context:d}=c;return d.clearRect(0,0,a.width,a.height),d.drawImage(a,0,0),c}function l(a,b,c){return new Promise(async d=>{c&&await new Promise(a=>setTimeout(a,100)),a.onload=()=>{d()},a.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(b)}`,a.crossOrigin="anonymous"})}a.s(["getTemporaryCanvasFromImage",()=>k],23026),a.s(["loadSVGImage",()=>l],99403)},23301,a=>{"use strict";let b;var c=a.i(48181);function d(a,d,e,f){f||(f=b||(b=new c.HTMLTextRenderData));let{domElement:g,styleElement:h,svgRoot:i}=f;g.innerHTML=`<style>${d.cssStyle};</style><div style='padding:0'>${a}</div>`,g.setAttribute("style","transform-origin: top left; display: inline-block"),e&&(h.textContent=e),document.body.appendChild(i);let j=g.getBoundingClientRect();i.remove();let k=2*d.padding;return{width:j.width-k,height:j.height-k}}a.s(["measureHtmlText",()=>d])},52857,a=>{"use strict";var b=a.i(44373),c=a.i(9124),d=a.i(36206),e=a.i(53507),f=a.i(91685),g=a.i(51983),h=a.i(3832),i=a.i(38252),j=a.i(48181),k=a.i(63187),l=a.i(68859),m=a.i(71704),n=a.i(23026),o=a.i(99403),p=a.i(23301);class q{constructor(a){this._activeTextures={},this._renderer=a,this._createCanvas=a.type===e.RendererType.WEBGPU}getTexture(a){return this.getTexturePromise(a)}getManagedTexture(a){let b=a.styleKey;if(this._activeTextures[b])return this._increaseReferenceCount(b),this._activeTextures[b].promise;let c=this._buildTexturePromise(a).then(a=>(this._activeTextures[b].texture=a,a));return this._activeTextures[b]={texture:null,promise:c,usageCount:1},c}getReferenceCount(a){return this._activeTextures[a]?.usageCount??null}_increaseReferenceCount(a){this._activeTextures[a].usageCount++}decreaseReferenceCount(a){let b=this._activeTextures[a];b&&(b.usageCount--,0===b.usageCount&&(b.texture?this._cleanUp(b.texture):b.promise.then(a=>{b.texture=a,this._cleanUp(b.texture)}).catch(()=>{(0,g.warn)("HTMLTextSystem: Failed to clean texture")}),this._activeTextures[a]=null))}getTexturePromise(a){return this._buildTexturePromise(a)}async _buildTexturePromise(a){let b,{text:d,style:e,resolution:g,textureStyle:q}=a,r=h.BigPool.get(j.HTMLTextRenderData),s=(0,k.extractFontFamilies)(d,e),t=await (0,l.getFontCss)(s),u=(0,p.measureHtmlText)(d,e,t,r),v=Math.ceil(Math.ceil(Math.max(1,u.width)+2*e.padding)*g),w=Math.ceil(Math.ceil(Math.max(1,u.height)+2*e.padding)*g),x=r.image;x.width=(0|v)+2,x.height=(0|w)+2;let y=(0,m.getSVGUrl)(d,e,g,t,r);await (0,o.loadSVGImage)(x,y,(0,f.isSafari)()&&s.length>0),this._createCanvas&&(b=(0,n.getTemporaryCanvasFromImage)(x,g));let z=(0,i.getPo2TextureFromSource)(b?b.canvas:x,x.width-2,x.height-2,g);return q&&(z.source.style=q),this._createCanvas&&(this._renderer.texture.initSource(z.source),c.CanvasPool.returnCanvasAndContext(b)),h.BigPool.return(r),z}returnTexturePromise(a){a.then(a=>{this._cleanUp(a)}).catch(()=>{(0,g.warn)("HTMLTextSystem: Failed to clean texture")})}_cleanUp(a){d.TexturePool.returnTexture(a,!0),a.source.resource=null,a.source.uploadMethodId="unknown"}destroy(){for(let a in this._renderer=null,this._activeTextures)this._activeTextures[a]&&this.returnTexturePromise(this._activeTextures[a].promise);this._activeTextures=null}}q.extension={type:[b.ExtensionType.WebGLSystem,b.ExtensionType.WebGPUSystem,b.ExtensionType.CanvasSystem],name:"htmlText"},a.s(["HTMLTextSystem",()=>q])},52075,a=>{"use strict";var b=a.i(42682),c=a.i(52776),d=a.i(54676),e=a.i(2897);let f=class a extends d.Geometry{constructor(...d){let f=d[0]??{};f instanceof Float32Array&&((0,e.deprecation)(e.v8_0_0,"use new MeshGeometry({ positions, uvs, indices }) instead"),f={positions:f,uvs:d[1],indices:d[2]});const g=(f={...a.defaultOptions,...f}).positions||new Float32Array([0,0,1,0,1,1,0,1]);let h=f.uvs;h||(h=new Float32Array(f.positions?g.length:[0,0,1,0,1,1,0,1]));const i=f.indices||new Uint32Array([0,1,2,0,2,3]),j=f.shrinkBuffersToFit,k=new b.Buffer({data:g,label:"attribute-mesh-positions",shrinkToFit:j,usage:c.BufferUsage.VERTEX|c.BufferUsage.COPY_DST});super({attributes:{aPosition:{buffer:k,format:"float32x2",stride:8,offset:0},aUV:{buffer:new b.Buffer({data:h,label:"attribute-mesh-uvs",shrinkToFit:j,usage:c.BufferUsage.VERTEX|c.BufferUsage.COPY_DST}),format:"float32x2",stride:8,offset:0}},indexBuffer:new b.Buffer({data:i,label:"index-mesh-buffer",shrinkToFit:j,usage:c.BufferUsage.INDEX|c.BufferUsage.COPY_DST}),topology:f.topology}),this.batchMode="auto"}get positions(){return this.attributes.aPosition.buffer.data}set positions(a){this.attributes.aPosition.buffer.data=a}get uvs(){return this.attributes.aUV.buffer.data}set uvs(a){this.attributes.aUV.buffer.data=a}get indices(){return this.indexBuffer.data}set indices(a){this.indexBuffer.data=a}};f.defaultOptions={topology:"triangle-list",shrinkBuffersToFit:!1},a.s(["MeshGeometry",()=>f])},61446,62845,29528,83930,24246,50015,69100,a=>{"use strict";let b,c;var d=a.i(44373),e=a.i(11276),f=a.i(45287),g=a.i(53507),h=a.i(46629),i=a.i(12874),j=a.i(58346),k=a.i(52075),l=a.i(67309),m=a.i(35235),n=a.i(77686),o=a.i(586),p=a.i(56312),q=a.i(96335),r=a.i(71805);let s={name:"tiling-bit",vertex:{header:`
            struct TilingUniforms {
                uMapCoord:mat3x3<f32>,
                uClampFrame:vec4<f32>,
                uClampOffset:vec2<f32>,
                uTextureTransform:mat3x3<f32>,
                uSizeAnchor:vec4<f32>
            };

            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;
            @group(2) @binding(1) var uTexture: texture_2d<f32>;
            @group(2) @binding(2) var uSampler: sampler;
        `,main:`
            uv = (tilingUniforms.uTextureTransform * vec3(uv, 1.0)).xy;

            position = (position - tilingUniforms.uSizeAnchor.zw) * tilingUniforms.uSizeAnchor.xy;
        `},fragment:{header:`
            struct TilingUniforms {
                uMapCoord:mat3x3<f32>,
                uClampFrame:vec4<f32>,
                uClampOffset:vec2<f32>,
                uTextureTransform:mat3x3<f32>,
                uSizeAnchor:vec4<f32>
            };

            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;
            @group(2) @binding(1) var uTexture: texture_2d<f32>;
            @group(2) @binding(2) var uSampler: sampler;
        `,main:`

            var coord = vUV + ceil(tilingUniforms.uClampOffset - vUV);
            coord = (tilingUniforms.uMapCoord * vec3(coord, 1.0)).xy;
            var unclamped = coord;
            coord = clamp(coord, tilingUniforms.uClampFrame.xy, tilingUniforms.uClampFrame.zw);

            var bias = 0.;

            if(unclamped.x == coord.x && unclamped.y == coord.y)
            {
                bias = -32.;
            }

            outColor = textureSampleBias(uTexture, uSampler, coord, bias);
        `}},t={name:"tiling-bit",vertex:{header:`
            uniform mat3 uTextureTransform;
            uniform vec4 uSizeAnchor;

        `,main:`
            uv = (uTextureTransform * vec3(aUV, 1.0)).xy;

            position = (position - uSizeAnchor.zw) * uSizeAnchor.xy;
        `},fragment:{header:`
            uniform sampler2D uTexture;
            uniform mat3 uMapCoord;
            uniform vec4 uClampFrame;
            uniform vec2 uClampOffset;
        `,main:`

        vec2 coord = vUV + ceil(uClampOffset - vUV);
        coord = (uMapCoord * vec3(coord, 1.0)).xy;
        vec2 unclamped = coord;
        coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

        outColor = texture(uTexture, coord, unclamped == coord ? 0.0 : -32.0);// lod-bias very negative to force lod 0

        `}};a.s(["tilingBit",()=>s,"tilingBitGl",()=>t],62845);class u extends p.Shader{constructor(){b??(b=(0,m.compileHighShaderGpuProgram)({name:"tiling-sprite-shader",bits:[n.localUniformBit,s,o.roundPixelsBit]})),c??(c=(0,m.compileHighShaderGlProgram)({name:"tiling-sprite-shader",bits:[n.localUniformBitGl,t,o.roundPixelsBitGl]})),super({glProgram:c,gpuProgram:b,resources:{localUniforms:new q.UniformGroup({uTransformMatrix:{value:new l.Matrix,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),tilingUniforms:new q.UniformGroup({uMapCoord:{value:new l.Matrix,type:"mat3x3<f32>"},uClampFrame:{value:new Float32Array([0,0,1,1]),type:"vec4<f32>"},uClampOffset:{value:new Float32Array([0,0]),type:"vec2<f32>"},uTextureTransform:{value:new l.Matrix,type:"mat3x3<f32>"},uSizeAnchor:{value:new Float32Array([100,100,.5,.5]),type:"vec4<f32>"}}),uTexture:r.Texture.EMPTY.source,uSampler:r.Texture.EMPTY.source.style}})}updateUniforms(a,b,c,d,e,f){let g=this.resources.tilingUniforms,h=f.width,i=f.height,j=f.textureMatrix,k=g.uniforms.uTextureTransform;k.set(c.a*h/a,c.b*h/b,c.c*i/a,c.d*i/b,c.tx/a,c.ty/b),k.invert(),g.uniforms.uMapCoord=j.mapCoord,g.uniforms.uClampFrame=j.uClampFrame,g.uniforms.uClampOffset=j.uClampOffset,g.uniforms.uTextureTransform=k,g.uniforms.uSizeAnchor[0]=a,g.uniforms.uSizeAnchor[1]=b,g.uniforms.uSizeAnchor[2]=d,g.uniforms.uSizeAnchor[3]=e,f&&(this.resources.uTexture=f.source,this.resources.uSampler=f.source.style)}}a.s(["TilingSpriteShader",()=>u],29528);var v=k;class w extends v.MeshGeometry{constructor(){super({positions:new Float32Array([0,0,1,0,1,1,0,1]),uvs:new Float32Array([0,0,1,0,1,1,0,1]),indices:new Uint32Array([0,1,2,0,2,3])})}}function x(a,b){let c=a.anchor.x,d=a.anchor.y;b[0]=-c*a.width,b[1]=-d*a.height,b[2]=(1-c)*a.width,b[3]=-d*a.height,b[4]=(1-c)*a.width,b[5]=(1-d)*a.height,b[6]=-c*a.width,b[7]=(1-d)*a.height}function y(a,b,c,d){let e=0,f=a.length/(b||2),g=d.a,h=d.b,i=d.c,j=d.d,k=d.tx,l=d.ty;for(c*=b;e<f;){let d=a[c],f=a[c+1];a[c]=g*d+i*f+k,a[c+1]=h*d+j*f+l,c+=b,e++}}function z(a,b){let c=a.texture,d=c.frame.width,e=c.frame.height,f=0,g=0;a.applyAnchorToTexture&&(f=a.anchor.x,g=a.anchor.y),b[0]=b[6]=-f,b[2]=b[4]=1-f,b[1]=b[3]=-g,b[5]=b[7]=1-g;let h=l.Matrix.shared;h.copyFrom(a._tileTransform.matrix),h.tx/=a.width,h.ty/=a.height,h.invert(),h.scale(a.width/d,a.height/e),y(b,2,0,h)}a.s(["QuadGeometry",()=>w],83930),a.s(["setPositions",()=>x],24246),a.s(["applyMatrix",()=>y],50015),a.s(["setUvs",()=>z],69100);let A=new w;class B{constructor(){this.canBatch=!0,this.geometry=new k.MeshGeometry({indices:A.indices.slice(),positions:A.positions.slice(),uvs:A.uvs.slice()})}destroy(){this.geometry.destroy(),this.shader?.destroy()}}class C{constructor(a){this._state=f.State.default2d,this._renderer=a,this._managedTilingSprites=new h.GCManagedHash({renderer:a,type:"renderable",name:"tilingSprite"})}validateRenderable(a){let b=this._getTilingSpriteData(a),c=b.canBatch;this._updateCanBatch(a);let d=b.canBatch;if(d&&d===c){let{batchableMesh:c}=b;return!c._batcher.checkAndUpdateTexture(c,a.texture)}return c!==d}addRenderable(a,b){let c=this._renderer.renderPipes.batch;this._updateCanBatch(a);let d=this._getTilingSpriteData(a),{geometry:e,canBatch:f}=d;if(f){d.batchableMesh||(d.batchableMesh=new j.BatchableMesh);let f=d.batchableMesh;a.didViewUpdate&&(this._updateBatchableMesh(a),f.geometry=e,f.renderable=a,f.transform=a.groupTransform,f.setTexture(a._texture)),f.roundPixels=this._renderer._roundPixels|a._roundPixels,c.addToBatch(f,b)}else c.break(b),d.shader||(d.shader=new u),this.updateRenderable(a),b.add(a)}execute(a){let{shader:b}=this._getTilingSpriteData(a);b.groups[0]=this._renderer.globalUniforms.bindGroup;let c=b.resources.localUniforms.uniforms;c.uTransformMatrix=a.groupTransform,c.uRound=this._renderer._roundPixels|a._roundPixels,(0,i.color32BitToUniform)(a.groupColorAlpha,c.uColor,0),this._state.blendMode=(0,e.getAdjustedBlendModeBlend)(a.groupBlendMode,a.texture._source),this._renderer.encoder.draw({geometry:A,shader:b,state:this._state})}updateRenderable(a){let b=this._getTilingSpriteData(a),{canBatch:c}=b;if(c){let{batchableMesh:c}=b;a.didViewUpdate&&this._updateBatchableMesh(a),c._batcher.updateElement(c)}else if(a.didViewUpdate){let{shader:c}=b;c.updateUniforms(a.width,a.height,a._tileTransform.matrix,a.anchor.x,a.anchor.y,a.texture)}}_getTilingSpriteData(a){return a._gpuData[this._renderer.uid]||this._initTilingSpriteData(a)}_initTilingSpriteData(a){let b=new B;return b.renderable=a,a._gpuData[this._renderer.uid]=b,this._managedTilingSprites.add(a),b}_updateBatchableMesh(a){let{geometry:b}=this._getTilingSpriteData(a),c=a.texture.source.style;"repeat"!==c.addressMode&&(c.addressMode="repeat",c.update()),z(a,b.uvs),x(a,b.positions)}destroy(){this._managedTilingSprites.destroy(),this._renderer=null}_updateCanBatch(a){let b=this._getTilingSpriteData(a),c=a.texture,d=!0;return this._renderer.type===g.RendererType.WEBGL&&(d=this._renderer.context.supports.nonPowOf2wrapping),b.canBatch=c.textureMatrix.isSimple&&(d||c.source.isPowerOfTwo),b.canBatch}}C.extension={type:[d.ExtensionType.WebGLPipes,d.ExtensionType.WebGPUPipes,d.ExtensionType.CanvasPipes],name:"tilingSprite"},a.s(["TilingSpriteGpuData",()=>B,"TilingSpritePipe",()=>C],61446)},29393,a=>{"use strict";var b=a.i(2897),c=a.i(52075);let d=class a extends c.MeshGeometry{constructor(...a){super({});let c=a[0]??{};"number"==typeof c&&((0,b.deprecation)(b.v8_0_0,"PlaneGeometry constructor changed please use { width, height, verticesX, verticesY } instead"),c={width:c,height:a[1],verticesX:a[2],verticesY:a[3]}),this.build(c)}build(b){b={...a.defaultOptions,...b},this.verticesX=this.verticesX??b.verticesX,this.verticesY=this.verticesY??b.verticesY,this.width=this.width??b.width,this.height=this.height??b.height;let c=this.verticesX*this.verticesY,d=[],e=[],f=[],g=this.verticesX-1,h=this.verticesY-1,i=this.width/g,j=this.height/h;for(let a=0;a<c;a++){let b=a%this.verticesX,c=a/this.verticesX|0;d.push(b*i,c*j),e.push(b/g,c/h)}let k=g*h;for(let a=0;a<k;a++){let b=a%g,c=a/g|0,d=c*this.verticesX+b,e=c*this.verticesX+b+1,h=(c+1)*this.verticesX+b,i=(c+1)*this.verticesX+b+1;f.push(d,e,h,e,i,h)}this.buffers[0].data=new Float32Array(d),this.buffers[1].data=new Float32Array(e),this.indexBuffer.data=new Uint32Array(f),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}};d.defaultOptions={width:100,height:100,verticesX:10,verticesY:10},a.s(["PlaneGeometry",()=>d])},98687,56888,a=>{"use strict";var b=a.i(44373),c=a.i(46629),d=a.i(58346),e=a.i(29393);let f=class a extends e.PlaneGeometry{constructor(b={}){b={...a.defaultOptions,...b},super({width:b.width,height:b.height,verticesX:4,verticesY:4}),this.update(b)}update(a){this.width=a.width??this.width,this.height=a.height??this.height,this._originalWidth=a.originalWidth??this._originalWidth,this._originalHeight=a.originalHeight??this._originalHeight,this._leftWidth=a.leftWidth??this._leftWidth,this._rightWidth=a.rightWidth??this._rightWidth,this._topHeight=a.topHeight??this._topHeight,this._bottomHeight=a.bottomHeight??this._bottomHeight,this._anchorX=a.anchor?.x,this._anchorY=a.anchor?.y,this.updateUvs(),this.updatePositions()}updatePositions(){let a=this.positions,{width:b,height:c,_leftWidth:d,_rightWidth:e,_topHeight:f,_bottomHeight:g,_anchorX:h,_anchorY:i}=this,j=d+e,k=f+g,l=Math.min(b>j?1:b/j,c>k?1:c/k),m=h*b,n=i*c;a[0]=a[8]=a[16]=a[24]=-m,a[2]=a[10]=a[18]=a[26]=d*l-m,a[4]=a[12]=a[20]=a[28]=b-e*l-m,a[6]=a[14]=a[22]=a[30]=b-m,a[1]=a[3]=a[5]=a[7]=-n,a[9]=a[11]=a[13]=a[15]=f*l-n,a[17]=a[19]=a[21]=a[23]=c-g*l-n,a[25]=a[27]=a[29]=a[31]=c-n,this.getBuffer("aPosition").update()}updateUvs(){let a=this.uvs;a[0]=a[8]=a[16]=a[24]=0,a[1]=a[3]=a[5]=a[7]=0,a[6]=a[14]=a[22]=a[30]=1,a[25]=a[27]=a[29]=a[31]=1;let b=1/this._originalWidth,c=1/this._originalHeight;a[2]=a[10]=a[18]=a[26]=b*this._leftWidth,a[9]=a[11]=a[13]=a[15]=c*this._topHeight,a[4]=a[12]=a[20]=a[28]=1-b*this._rightWidth,a[17]=a[19]=a[21]=a[23]=1-c*this._bottomHeight,this.getBuffer("aUV").update()}};f.defaultOptions={width:100,height:100,leftWidth:10,topHeight:10,rightWidth:10,bottomHeight:10,originalWidth:100,originalHeight:100},a.s(["NineSliceGeometry",()=>f],56888);class g extends d.BatchableMesh{constructor(){super(),this.geometry=new f}destroy(){this.geometry.destroy()}}class h{constructor(a){this._renderer=a,this._managedSprites=new c.GCManagedHash({renderer:a,type:"renderable",name:"nineSliceSprite"})}addRenderable(a,b){let c=this._getGpuSprite(a);a.didViewUpdate&&this._updateBatchableSprite(a,c),this._renderer.renderPipes.batch.addToBatch(c,b)}updateRenderable(a){let b=this._getGpuSprite(a);a.didViewUpdate&&this._updateBatchableSprite(a,b),b._batcher.updateElement(b)}validateRenderable(a){let b=this._getGpuSprite(a);return!b._batcher.checkAndUpdateTexture(b,a._texture)}_updateBatchableSprite(a,b){b.geometry.update(a),b.setTexture(a._texture)}_getGpuSprite(a){return a._gpuData[this._renderer.uid]||this._initGPUSprite(a)}_initGPUSprite(a){let b=a._gpuData[this._renderer.uid]=new g;return b.renderable=a,b.transform=a.groupTransform,b.texture=a._texture,b.roundPixels=this._renderer._roundPixels|a._roundPixels,this._managedSprites.add(a),a.didViewUpdate||this._updateBatchableSprite(a,b),b}destroy(){this._managedSprites.destroy(),this._renderer=null}}h.extension={type:[b.ExtensionType.WebGLPipes,b.ExtensionType.WebGPUPipes,b.ExtensionType.CanvasPipes],name:"nineSliceSprite"},a.s(["NineSliceSpriteGpuData",()=>g,"NineSliceSpritePipe",()=>h],98687)},4209,a=>{"use strict";var b=a.i(44373);class c{constructor(a){this._renderer=a}push(a,b,c){this._renderer.renderPipes.batch.break(c),c.add({renderPipeId:"filter",canBundle:!1,action:"pushFilter",container:b,filterEffect:a})}pop(a,b,c){this._renderer.renderPipes.batch.break(c),c.add({renderPipeId:"filter",action:"popFilter",canBundle:!1})}execute(a){"pushFilter"===a.action?this._renderer.filter.push(a):"popFilter"===a.action&&this._renderer.filter.pop()}destroy(){this._renderer=null}}c.extension={type:[b.ExtensionType.WebGLPipes,b.ExtensionType.WebGPUPipes,b.ExtensionType.CanvasPipes],name:"filter"},a.s(["FilterPipe",()=>c])},33636,18285,50097,29636,a=>{"use strict";var b=a.i(53229),c=a.i(66722),d=a.i(21437),e="in vec2 aPosition;\nout vec2 vTextureCoord;\n\nuniform vec4 uInputSize;\nuniform vec4 uOutputFrame;\nuniform vec4 uOutputTexture;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;\n    \n    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aPosition * (uOutputFrame.zw * uInputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";a.s(["default",()=>e],18285);var f="in vec2 vTextureCoord;\nout vec4 finalColor;\nuniform sampler2D uTexture;\nvoid main() {\n    finalColor = texture(uTexture, vTextureCoord);\n}\n";a.s(["default",()=>f],50097);var g="struct GlobalFilterUniforms {\n  uInputSize: vec4<f32>,\n  uInputPixel: vec4<f32>,\n  uInputClamp: vec4<f32>,\n  uOutputFrame: vec4<f32>,\n  uGlobalFrame: vec4<f32>,\n  uOutputTexture: vec4<f32>,\n};\n\n@group(0) @binding(0) var <uniform> gfu: GlobalFilterUniforms;\n@group(0) @binding(1) var uTexture: texture_2d<f32>;\n@group(0) @binding(2) var uSampler: sampler;\n\nstruct VSOutput {\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv: vec2<f32>\n};\n\nfn filterVertexPosition(aPosition: vec2<f32>) -> vec4<f32>\n{\n    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0 * gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nfn filterTextureCoord(aPosition: vec2<f32>) -> vec2<f32>\n{\n    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);\n}\n\n@vertex\nfn mainVertex(\n  @location(0) aPosition: vec2<f32>,\n) -> VSOutput {\n  return VSOutput(\n   filterVertexPosition(aPosition),\n   filterTextureCoord(aPosition)\n  );\n}\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n) -> @location(0) vec4<f32> {\n    return textureSample(uTexture, uSampler, uv);\n}\n";a.s(["default",()=>g],29636);class h extends d.Filter{constructor(){super({gpuProgram:c.GpuProgram.from({vertex:{source:g,entryPoint:"mainVertex"},fragment:{source:g,entryPoint:"mainFragment"},name:"passthrough-filter"}),glProgram:b.GlProgram.from({vertex:e,fragment:f,name:"passthrough-filter"})})}}a.s(["PassthroughFilter",()=>h],33636)},31344,12797,a=>{"use strict";var b=a.i(44373),c=a.i(33636),d=a.i(67309),e=a.i(74395),f=a.i(54676),g=a.i(96335),h=a.i(71805),i=a.i(36206),j=a.i(53507),k=a.i(83813);let l=new d.Matrix;function m(a,b){b.clear();let c=b.matrix;for(let c=0;c<a.length;c++){let d=a[c];if(d.globalDisplayStatus<7)continue;let e=d.renderGroup??d.parentRenderGroup;e?.isCachedAsTexture?b.matrix=l.copyFrom(e.textureOffsetInverseTransform).append(d.worldTransform):e?._parentCacheAsTextureRenderGroup?b.matrix=l.copyFrom(e._parentCacheAsTextureRenderGroup.inverseWorldTransform).append(d.groupTransform):b.matrix=d.worldTransform,b.addBounds(d.bounds)}return b.matrix=c,b}a.s(["getGlobalRenderableBounds",()=>m],12797);var n=a.i(51983);let o=new f.Geometry({attributes:{aPosition:{buffer:new Float32Array([0,0,1,0,1,1,0,1]),format:"float32x2",stride:8,offset:0}},indexBuffer:new Uint32Array([0,1,2,0,2,3])});class p{constructor(){this.skip=!1,this.inputTexture=null,this.backTexture=null,this.filters=null,this.bounds=new k.Bounds,this.container=null,this.blendRequired=!1,this.outputRenderSurface=null,this.globalFrame={x:0,y:0,width:0,height:0},this.firstEnabledIndex=-1,this.lastEnabledIndex=-1}}class q{constructor(a){this._filterStackIndex=0,this._filterStack=[],this._filterGlobalUniforms=new g.UniformGroup({uInputSize:{value:new Float32Array(4),type:"vec4<f32>"},uInputPixel:{value:new Float32Array(4),type:"vec4<f32>"},uInputClamp:{value:new Float32Array(4),type:"vec4<f32>"},uOutputFrame:{value:new Float32Array(4),type:"vec4<f32>"},uGlobalFrame:{value:new Float32Array(4),type:"vec4<f32>"},uOutputTexture:{value:new Float32Array(4),type:"vec4<f32>"}}),this._globalFilterBindGroup=new e.BindGroup({}),this.renderer=a}get activeBackTexture(){return this._activeFilterData?.backTexture}push(a){let b=this.renderer,c=a.filterEffect.filters,d=this._pushFilterData();d.skip=!1,d.filters=c,d.container=a.container,d.outputRenderSurface=b.renderTarget.renderSurface;let e=b.renderTarget.renderTarget.colorTexture.source,f=e.resolution,g=e.antialias;if(c.every(a=>!a.enabled)){d.skip=!0;return}let h=d.bounds;if(this._calculateFilterArea(a,h),this._calculateFilterBounds(d,b.renderTarget.rootViewPort,g,f,1),d.skip)return;let i=this._getPreviousFilterData(),j=this._findFilterResolution(f),k=0,l=0;i&&(k=i.bounds.minX,l=i.bounds.minY),this._calculateGlobalFrame(d,k,l,j,e.width,e.height),this._setupFilterTextures(d,h,b,i)}generateFilteredTexture({texture:a,filters:b}){let c=this._pushFilterData();this._activeFilterData=c,c.skip=!1,c.filters=b;let d=a.source,e=d.resolution,f=d.antialias;if(b.every(a=>!a.enabled))return c.skip=!0,a;let g=c.bounds;if(g.addRect(a.frame),this._calculateFilterBounds(c,g.rectangle,f,e,0),c.skip)return a;this._calculateGlobalFrame(c,0,0,e,d.width,d.height),c.outputRenderSurface=i.TexturePool.getOptimalTexture(g.width,g.height,c.resolution,c.antialias),c.backTexture=h.Texture.EMPTY,c.inputTexture=a,this.renderer.renderTarget.finishRenderPass(),this._applyFiltersToTexture(c,!0);let j=c.outputRenderSurface;return j.source.alphaMode="premultiplied-alpha",j}pop(){let a=this.renderer,b=this._popFilterData();b.skip||(a.globalUniforms.pop(),a.renderTarget.finishRenderPass(),this._activeFilterData=b,this._applyFiltersToTexture(b,!1),b.blendRequired&&i.TexturePool.returnTexture(b.backTexture),i.TexturePool.returnTexture(b.inputTexture))}getBackTexture(a,b,c){let d=a.colorTexture.source._resolution,e=i.TexturePool.getOptimalTexture(b.width,b.height,d,!1),f=b.minX,g=b.minY;c&&(f-=c.minX,g-=c.minY),f=Math.floor(f*d),g=Math.floor(g*d);let h=Math.ceil(b.width*d),j=Math.ceil(b.height*d);return this.renderer.renderTarget.copyToTexture(a,e,{x:f,y:g},{width:h,height:j},{x:0,y:0}),e}applyFilter(a,b,c,d){let e=this.renderer,f=this._activeFilterData,g=f.outputRenderSurface===c,h=e.renderTarget.rootRenderTarget.colorTexture.source._resolution,i=this._findFilterResolution(h),j=0,k=0;if(g){let a=this._findPreviousFilterOffset();j=a.x,k=a.y}this._updateFilterUniforms(b,c,f,j,k,i,g,d);let l=a.enabled?a:this._getPassthroughFilter();this._setupBindGroupsAndRender(l,b,e)}calculateSpriteMatrix(a,b){let c=this._activeFilterData,e=a.set(c.inputTexture._source.width,0,0,c.inputTexture._source.height,c.bounds.minX,c.bounds.minY),f=b.worldTransform.copyTo(d.Matrix.shared),g=b.renderGroup||b.parentRenderGroup;return g&&g.cacheToLocalTransform&&f.prepend(g.cacheToLocalTransform),f.invert(),e.prepend(f),e.scale(1/b.texture.orig.width,1/b.texture.orig.height),e.translate(b.anchor.x,b.anchor.y),e}destroy(){this._passthroughFilter?.destroy(!0),this._passthroughFilter=null}_getPassthroughFilter(){return this._passthroughFilter??(this._passthroughFilter=new c.PassthroughFilter),this._passthroughFilter}_setupBindGroupsAndRender(a,b,c){if(c.renderPipes.uniformBatch){let a=c.renderPipes.uniformBatch.getUboResource(this._filterGlobalUniforms);this._globalFilterBindGroup.setResource(a,0)}else this._globalFilterBindGroup.setResource(this._filterGlobalUniforms,0);this._globalFilterBindGroup.setResource(b.source,1),this._globalFilterBindGroup.setResource(b.source.style,2),a.groups[0]=this._globalFilterBindGroup,c.encoder.draw({geometry:o,shader:a,state:a._state,topology:"triangle-list"}),c.type===j.RendererType.WEBGL&&c.renderTarget.finishRenderPass()}_setupFilterTextures(a,b,c,d){if(a.backTexture=h.Texture.EMPTY,a.inputTexture=i.TexturePool.getOptimalTexture(b.width,b.height,a.resolution,a.antialias),a.blendRequired){c.renderTarget.finishRenderPass();let e=c.renderTarget.getRenderTarget(a.outputRenderSurface);a.backTexture=this.getBackTexture(e,b,d?.bounds)}c.renderTarget.bind(a.inputTexture,!0),c.globalUniforms.push({offset:b})}_calculateGlobalFrame(a,b,c,d,e,f){let g=a.globalFrame;g.x=b*d,g.y=c*d,g.width=e*d,g.height=f*d}_updateFilterUniforms(a,b,c,d,e,f,g,i){let j=this._filterGlobalUniforms.uniforms,k=j.uOutputFrame,l=j.uInputSize,m=j.uInputPixel,n=j.uInputClamp,o=j.uGlobalFrame,p=j.uOutputTexture;g?(k[0]=c.bounds.minX-d,k[1]=c.bounds.minY-e):(k[0]=0,k[1]=0),k[2]=a.frame.width,k[3]=a.frame.height,l[0]=a.source.width,l[1]=a.source.height,l[2]=1/l[0],l[3]=1/l[1],m[0]=a.source.pixelWidth,m[1]=a.source.pixelHeight,m[2]=1/m[0],m[3]=1/m[1],n[0]=.5*m[2],n[1]=.5*m[3],n[2]=a.frame.width*l[2]-.5*m[2],n[3]=a.frame.height*l[3]-.5*m[3];let q=this.renderer.renderTarget.rootRenderTarget.colorTexture;o[0]=d*f,o[1]=e*f,o[2]=q.source.width*f,o[3]=q.source.height*f,b instanceof h.Texture&&(b.source.resource=null);let r=this.renderer.renderTarget.getRenderTarget(b);this.renderer.renderTarget.bind(b,!!i),b instanceof h.Texture?(p[0]=b.frame.width,p[1]=b.frame.height):(p[0]=r.width,p[1]=r.height),p[2]=r.isRoot?-1:1,this._filterGlobalUniforms.update()}_findFilterResolution(a){let b=this._filterStackIndex-1;for(;b>0&&this._filterStack[b].skip;)--b;return b>0&&this._filterStack[b].inputTexture?this._filterStack[b].inputTexture.source._resolution:a}_findPreviousFilterOffset(){let a=0,b=0,c=this._filterStackIndex;for(;c>0;){c--;let d=this._filterStack[c];if(!d.skip){a=d.bounds.minX,b=d.bounds.minY;break}}return{x:a,y:b}}_calculateFilterArea(a,b){if(a.renderables?m(a.renderables,b):a.filterEffect.filterArea?(b.clear(),b.addRect(a.filterEffect.filterArea),b.applyMatrix(a.container.worldTransform)):a.container.getFastGlobalBounds(!0,b),a.container){let c=(a.container.renderGroup||a.container.parentRenderGroup).cacheToLocalTransform;c&&b.applyMatrix(c)}}_applyFiltersToTexture(a,b){let c=a.inputTexture,d=a.bounds,e=a.filters,f=a.firstEnabledIndex,g=a.lastEnabledIndex;if(this._globalFilterBindGroup.setResource(c.source.style,2),this._globalFilterBindGroup.setResource(a.backTexture.source,3),f===g)e[f].apply(this,c,a.outputRenderSurface,b);else{let c=a.inputTexture,h=i.TexturePool.getOptimalTexture(d.width,d.height,c.source._resolution,!1),j=h;for(let a=f;a<g;a++){let b=e[a];if(!b.enabled)continue;b.apply(this,c,j,!0);let d=c;c=j,j=d}e[g].apply(this,c,a.outputRenderSurface,b),i.TexturePool.returnTexture(h)}}_calculateFilterBounds(a,b,c,d,e){let f=this.renderer,g=a.bounds,h=a.filters,i=1/0,j=0,k=!0,l=!1,m=!1,o=!0,p=-1,q=-1;for(let a=0;a<h.length;a++){let b=h[a];if(b.enabled){if(-1===p&&(p=a),q=a,i=Math.min(i,"inherit"===b.resolution?d:b.resolution),j+=b.padding,"off"===b.antialias?k=!1:"inherit"===b.antialias&&k&&(k=c),b.clipToViewport||(o=!1),!(b.compatibleRenderers&f.type)){m=!1;break}if(b.blendRequired&&!(f.backBuffer?.useBackBuffer??!0)){(0,n.warn)("Blend filter requires backBuffer on WebGL renderer to be enabled. Set `useBackBuffer: true` in the renderer options."),m=!1;break}m=!0,l||(l=b.blendRequired)}}if(!m||(o&&g.fitBounds(0,b.width/d,0,b.height/d),g.scale(i).ceil().scale(1/i).pad((0|j)*e),!g.isPositive)){a.skip=!0;return}a.antialias=k,a.resolution=i,a.blendRequired=l,a.firstEnabledIndex=p,a.lastEnabledIndex=q}_popFilterData(){return this._filterStackIndex--,this._filterStack[this._filterStackIndex]}_getPreviousFilterData(){let a,b=this._filterStackIndex-1;for(;b>0&&(b--,(a=this._filterStack[b]).skip););return a}_pushFilterData(){let a=this._filterStack[this._filterStackIndex];return a||(a=this._filterStack[this._filterStackIndex]=new p),this._filterStackIndex++,a}}q.extension={type:[b.ExtensionType.WebGLSystem,b.ExtensionType.WebGPUSystem],name:"filter"},a.s(["FilterSystem",()=>q],31344)}];

//# sourceMappingURL=node_modules_d368c0d8._.js.map